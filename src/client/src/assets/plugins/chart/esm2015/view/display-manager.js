import { Inject, Injectable } from '@angular/core';
import { PANEL_TOKEN } from 'common';
import { AXIS_Y_LEFT, AXIS_Y_RIGHT, DataPointNullValueOption } from '../chart.m';
import { ColorHelper } from 'uilib';
import * as i0 from "@angular/core";
import * as i1 from "common";
export class DisplayManager {
    constructor(panel) {
        this.panel = panel;
    }
    get display() {
        return this
            .panel
            .widget
            .display;
    }
    get options() {
        return this
            .panel
            .widget
            .component
            .control
            .chart
            .options;
    }
    setup(ds) {
        this.setupLines(ds);
        this.setupPoints(ds);
        this.setupNullValue(ds);
    }
    setupLines(ds) {
        const showLines = this.getShowLines(ds);
        const lineWidth = this.getLineWidth(ds);
        const fill = this.getFill(ds);
        let opacity = (fill / 10);
        ds.fill = ( /*showLines &&*/fill > 0);
        ds.backgroundColor = this.getLineColor(ds, opacity);
        opacity = (showLines && lineWidth) ? 1 : 0;
        ds.borderColor = this.getLineColor(ds, opacity);
        ds.borderWidth = lineWidth;
        ds.steppedLine = this.getStaircase(ds);
        if (this.getDashes(ds)) {
            const len = this.getDashLength(ds);
            const space = this.getDashSpace(ds);
            ds.borderDash = [len, space];
        }
        else {
            ds.borderDash = undefined;
        }
        ds.order = this.getZIndex(ds);
        ds.legend = this.getLegend(ds);
        ds.yAxisID = (1 == this.getYAxis(ds)) ? AXIS_Y_LEFT : AXIS_Y_RIGHT;
    }
    setupPoints(ds) {
        const showPoints = this.getShowPoints(ds);
        const opacity = showPoints ? 1 : 0;
        const color = this.getLineColor(ds, opacity);
        ds.pointBorderColor = `${color}`;
        ds.pointBackgroundColor = `${color}`;
        ds.pointRadius = showPoints ? this.getPointRadius(ds) : 0;
    }
    setupNullValue(ds) {
        switch (this.display.nullValue) {
            case DataPointNullValueOption.Connected:
                this.options.spanGaps = true;
                ds.data.forEach(p => p.y = p.isNull ? null : p.y);
                break;
            case DataPointNullValueOption.Null:
                this.options.spanGaps = false;
                ds.data.forEach(p => p.y = p.isNull ? null : p.y);
                break;
            case DataPointNullValueOption.NullAsZero:
                this.options.spanGaps = false;
                ds.data.forEach(p => p.y = p.isNull ? 0 : p.y);
                break;
        }
    }
    getShowLines(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.lines) ? o.lines : this.display.showLines;
    }
    getLineWidth(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.lineWidth) ? o.lineWidth : this.display.lineWidth;
    }
    getLineColor(ds, opacity) {
        const o = this.getOverride(ds);
        const color = ColorHelper.colors[ds.index % ColorHelper.colors.length];
        const defaultColor = ColorHelper.hexToRgbString(color, opacity);
        const useOverride = (o && undefined != o.color);
        let overrideColor;
        if (useOverride) {
            overrideColor = ColorHelper.hexToRgbString(o.color, opacity);
        }
        return (useOverride) ? overrideColor : defaultColor;
    }
    getFill(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.lineFill) ? o.lineFill : this.display.fill;
    }
    getStaircase(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.staircase) ? o.staircase : this.display.staircase;
    }
    getDashes(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.dashes) ? o.dashes : false;
    }
    getDashLength(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.dashLength) ? o.dashLength : 1;
    }
    getDashSpace(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.dashSpace) ? o.dashSpace : 1;
    }
    getShowPoints(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.points) ? o.points : this.display.showPoints;
    }
    getPointRadius(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.pointRadius) ? o.pointRadius : this.display.pointRadius;
    }
    getLegend(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.legend) ? o.legend : true;
    }
    getZIndex(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.zIndex) ? o.zIndex : 0;
    }
    getYAxis(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.yAxis) ? o.yAxis : 1;
    }
    getOverride(ds) {
        return this.getOverrideByLabel(ds.label);
    }
    getOverrideByLabel(label) {
        var _a;
        return (_a = this
            .display
            .overrides) === null || _a === void 0 ? void 0 : _a.find(x => x.alias && new RegExp(x.alias).test(label));
    }
}
DisplayManager.ɵfac = function DisplayManager_Factory(t) { return new (t || DisplayManager)(i0.ɵɵinject(PANEL_TOKEN)); };
DisplayManager.ɵprov = i0.ɵɵdefineInjectable({ token: DisplayManager, factory: DisplayManager.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(DisplayManager, [{
        type: Injectable
    }], function () { return [{ type: i1.Panel, decorators: [{
                type: Inject,
                args: [PANEL_TOKEN]
            }] }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzcGxheS1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vYXBwL3BsdWdpbnMvd2lkZ2V0cy9jaGFydC9zcmMvdmlldy9kaXNwbGF5LW1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFTLFdBQVcsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUM1QyxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSx3QkFBd0IsRUFBVyxNQUFNLFlBQVksQ0FBQztBQUMxRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sT0FBTyxDQUFDOzs7QUFJcEMsTUFBTSxPQUFPLGNBQWM7SUFtQjFCLFlBQTZDLEtBQVk7UUFBWixVQUFLLEdBQUwsS0FBSyxDQUFPO0lBRXpELENBQUM7SUFuQkQsSUFBWSxPQUFPO1FBQ2xCLE9BQU8sSUFBSTthQUNULEtBQUs7YUFDTCxNQUFNO2FBQ04sT0FBTyxDQUFDO0lBQ1gsQ0FBQztJQUVELElBQVksT0FBTztRQUNsQixPQUFPLElBQUk7YUFDVCxLQUFLO2FBQ0wsTUFBTTthQUNOLFNBQVM7YUFDVCxPQUFPO2FBQ1AsS0FBSzthQUNMLE9BQU8sQ0FBQztJQUNYLENBQUM7SUFNRCxLQUFLLENBQUMsRUFBVztRQUNoQixJQUFJLENBQUMsVUFBVSxDQUFFLEVBQUUsQ0FBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxXQUFXLENBQUUsRUFBRSxDQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLGNBQWMsQ0FBRSxFQUFFLENBQUUsQ0FBQztJQUMzQixDQUFDO0lBRU8sVUFBVSxDQUFFLEVBQVc7UUFDOUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUMxQyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFFLEVBQUUsQ0FBRSxD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LFNBQVMsQ0FBQztJQUNqRixDQUFDO0lBRUQsU0FBUyxDQUFFLEVBQVc7UUFDckIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUUsQ0FBQyxJQUFJLFNBQVMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUMxRCxDQUFDO0lBRUQsYUFBYSxDQUFFLEVBQVc7UUFDekIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUUsQ0FBQyxJQUFJLFNBQVMsSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQsWUFBWSxDQUFFLEVBQVc7UUFDeEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUUsQ0FBQyxJQUFJLFNBQVMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsYUFBYSxDQUFFLEVBQVc7UUFDekIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUUsQ0FBQyxJQUFJLFNBQVMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO0lBQzVFLENBQUM7SUFFRCxjQUFjLENBQUUsRUFBVztRQUMxQixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFFLEVBQUUsQ0FBRSxDQUFDO1FBRWpDLE9BQU8sQ0FBRSxDQUFDLElBQUksU0FBUyxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7SUFDdkYsQ0FBQztJQUVELFNBQVMsQ0FBRSxFQUFXO1FBQ3JCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUUsRUFBRSxDQUFFLENBQUM7UUFFakMsT0FBTyxDQUFFLENBQUMsSUFBSSxTQUFTLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDekQsQ0FBQztJQUVELFNBQVMsQ0FBRSxFQUFXO1FBQ3JCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUUsRUFBRSxDQUFFLENBQUM7UUFFakMsT0FBTyxDQUFFLENBQUMsSUFBSSxTQUFTLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVELFFBQVEsQ0FBRSxFQUFXO1FBQ3BCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUUsRUFBRSxDQUFFLENBQUM7UUFFakMsT0FBTyxDQUFFLENBQUMsSUFBSSxTQUFTLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVELFdBQVcsQ0FBRSxFQUFXO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUUsQ0FBQztJQUM1QyxDQUFDO0lBRUQsa0JBQWtCLENBQUUsS0FBYTs7UUFDaEMsYUFBTyxJQUFJO2FBQ1QsT0FBTzthQUNQLFNBQVMsMENBQ1IsSUFBSSxDQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLE1BQU0sQ0FBRSxDQUFDLENBQUMsS0FBSyxDQUFFLENBQUMsSUFBSSxDQUFFLEtBQUssQ0FBRSxFQUFHO0lBQ2hFLENBQUM7OzRFQTNMVyxjQUFjLGNBbUJILFdBQVc7c0RBbkJ0QixjQUFjLFdBQWQsY0FBYztrREFBZCxjQUFjO2NBRDFCLFVBQVU7O3NCQW9CSyxNQUFNO3VCQUFFLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUGFuZWwsIFBBTkVMX1RPS0VOIH0gZnJvbSAnY29tbW9uJztcclxuaW1wb3J0IHsgQVhJU19ZX0xFRlQsIEFYSVNfWV9SSUdIVCwgRGF0YVBvaW50TnVsbFZhbHVlT3B0aW9uLCBEYXRhU2V0IH0gZnJvbSAnLi4vY2hhcnQubSc7XHJcbmltcG9ydCB7IENvbG9ySGVscGVyIH0gZnJvbSAndWlsaWInO1xyXG5pbXBvcnQgeyBPcHRpb25zUHJvdmlkZXIgfSBmcm9tICcuL29wdGlvbnMtcHJvdmlkZXInO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGlzcGxheU1hbmFnZXIge1xyXG5cclxuXHRwcml2YXRlIGdldCBkaXNwbGF5KCkge1xyXG5cdFx0cmV0dXJuIHRoaXNcclxuXHRcdFx0LnBhbmVsXHJcblx0XHRcdC53aWRnZXRcclxuXHRcdFx0LmRpc3BsYXk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldCBvcHRpb25zKCl7XHJcblx0XHRyZXR1cm4gdGhpc1xyXG5cdFx0XHQucGFuZWxcclxuXHRcdFx0LndpZGdldFxyXG5cdFx0XHQuY29tcG9uZW50XHJcblx0XHRcdC5jb250cm9sXHJcblx0XHRcdC5jaGFydFxyXG5cdFx0XHQub3B0aW9ucztcclxuXHR9XHJcblxyXG5cdGNvbnN0cnVjdG9yICggQEluamVjdCggUEFORUxfVE9LRU4gKSBwcml2YXRlIHBhbmVsOiBQYW5lbCApIHtcclxuXHJcblx0fVxyXG5cclxuXHRzZXR1cChkczogRGF0YVNldCkge1xyXG5cdFx0dGhpcy5zZXR1cExpbmVzKCBkcyApO1xyXG5cdFx0dGhpcy5zZXR1cFBvaW50cyggZHMgKTtcclxuXHRcdHRoaXMuc2V0dXBOdWxsVmFsdWUoIGRzICk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHNldHVwTGluZXMoIGRzOiBEYXRhU2V0ICkge1xyXG5cdFx0Y29uc3Qgc2hvd0xpbmVzID0gdGhpcy5nZXRTaG93TGluZXMoIGRzICk7XHJcblx0XHRjb25zdCBsaW5lV2lkdGggPSB0aGlzLmdldExpbmVXaWR0aCggZHMgKTtcclxuXHRcdGNvbnN0IGZpbGwgPSB0aGlzLmdldEZpbGwoIGRzICk7XHJcblxyXG5cdFx0bGV0IG9wYWNpdHkgPSAoIGZpbGwgLyAxMCk7XHJcblx0XHRkcy5maWxsID0gKC8qc2hvd0xpbmVzICYmKi8gZmlsbCA+IDApO1xyXG5cdFx0ZHMuYmFja2dyb3VuZENvbG9yID0gdGhpcy5nZXRMaW5lQ29sb3IoIGRzLCBvcGFjaXR5ICk7XHJcblxyXG5cdFx0b3BhY2l0eSA9IChzaG93TGluZXMgJiYgbGluZVdpZHRoKSA/IDEgOiAwO1xyXG5cdFx0ZHMuYm9yZGVyQ29sb3IgPSB0aGlzLmdldExpbmVDb2xvciggZHMsIG9wYWNpdHkgKTtcclxuXHRcdGRzLmJvcmRlcldpZHRoID0gbGluZVdpZHRoO1xyXG5cclxuXHRcdCBkcy5zdGVwcGVkTGluZSA9IHRoaXMuZ2V0U3RhaXJjYXNlKCBkcyApO1xyXG5cclxuXHRcdGlmKCB0aGlzLmdldERhc2hlcyggZHMgKSApe1xyXG5cdFx0XHRjb25zdCBsZW4gPSB0aGlzLmdldERhc2hMZW5ndGgoIGRzICk7XHJcblx0XHRcdGNvbnN0IHNwYWNlID0gdGhpcy5nZXREYXNoU3BhY2UoIGRzICk7XHJcblx0XHRcdGRzLmJvcmRlckRhc2ggPSBbIGxlbiwgc3BhY2UgXVxyXG5cdFx0fVxyXG5cdFx0ZWxzZXtcclxuXHRcdFx0ZHMuYm9yZGVyRGFzaCA9IHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHJcblx0XHRkcy5vcmRlciA9IHRoaXMuZ2V0WkluZGV4KCBkcyApO1xyXG5cdFx0ZHMubGVnZW5kID0gdGhpcy5nZXRMZWdlbmQoIGRzICk7XHJcblxyXG5cdFx0ZHMueUF4aXNJRCA9ICggMSA9PSB0aGlzLmdldFlBeGlzKCBkcyApICkgP1x0QVhJU19ZX0xFRlQ6IEFYSVNfWV9SSUdIVDtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgc2V0dXBQb2ludHMoIGRzOiBEYXRhU2V0ICkge1xyXG5cdFx0Y29uc3Qgc2hvd1BvaW50cyA9IHRoaXMuZ2V0U2hvd1BvaW50cyggZHMgKTtcclxuXHJcblx0XHRjb25zdCBvcGFjaXR5ID0gc2hvd1BvaW50cyA/IDEgOiAwXHJcblx0XHRjb25zdCBjb2xvciA9IHRoaXMuZ2V0TGluZUNvbG9yKCBkcywgb3BhY2l0eSApO1xyXG5cclxuXHRcdGRzLnBvaW50Qm9yZGVyQ29sb3IgPSBgJHtjb2xvcn1gO1xyXG5cdFx0ZHMucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPSBgJHtjb2xvcn1gO1xyXG5cclxuXHRcdGRzLnBvaW50UmFkaXVzID0gc2hvd1BvaW50cyA/IHRoaXMuZ2V0UG9pbnRSYWRpdXMoIGRzICkgOiAwO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBzZXR1cE51bGxWYWx1ZSggZHM6IERhdGFTZXQgKSB7XHJcblx0XHRzd2l0Y2ggKCB0aGlzLmRpc3BsYXkubnVsbFZhbHVlKSB7XHJcblx0XHRcdGNhc2UgRGF0YVBvaW50TnVsbFZhbHVlT3B0aW9uLkNvbm5lY3RlZDpcclxuXHRcdFx0XHR0aGlzLm9wdGlvbnMuc3BhbkdhcHMgPSB0cnVlO1xyXG5cdFx0XHRcdGRzLmRhdGEuZm9yRWFjaCggcCA9PiBwLnkgPSBwLmlzTnVsbCA/IG51bGwgOiBwLnkgKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgRGF0YVBvaW50TnVsbFZhbHVlT3B0aW9uLk51bGw6XHJcblx0XHRcdFx0dGhpcy5vcHRpb25zLnNwYW5HYXBzID0gZmFsc2U7XHJcblx0XHRcdFx0ZHMuZGF0YS5mb3JFYWNoKCBwID0+IHAueSA9IHAuaXNOdWxsID8gbnVsbCA6IHAueSApO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBEYXRhUG9pbnROdWxsVmFsdWVPcHRpb24uTnVsbEFzWmVybzpcclxuXHRcdFx0XHR0aGlzLm9wdGlvbnMuc3BhbkdhcHMgPSBmYWxzZTtcclxuXHRcdFx0XHRkcy5kYXRhLmZvckVhY2goIHAgPT4gcC55ID0gcC5pc051bGwgPyAwIDogcC55ICk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRnZXRTaG93TGluZXMoZHM6IERhdGFTZXQpOiBib29sZWFue1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5saW5lcyApID8gby5saW5lcyA6IHRoaXMuZGlzcGxheS5zaG93TGluZXM7XHJcblx0fVxyXG5cdFxyXG5cdGdldExpbmVXaWR0aChkczogRGF0YVNldCk6IG51bWJlcntcclxuXHRcdGNvbnN0IG8gPSB0aGlzLmdldE92ZXJyaWRlKCBkcyApO1xyXG5cclxuXHRcdHJldHVybiAoIG8gJiYgdW5kZWZpbmVkICE9IG8ubGluZVdpZHRoICkgPyBvLmxpbmVXaWR0aCA6IHRoaXMuZGlzcGxheS5saW5lV2lkdGg7XHJcblx0fVxyXG5cclxuXHRnZXRMaW5lQ29sb3IoZHM6IERhdGFTZXQsIG9wYWNpdHk6IG51bWJlcikgOiBzdHJpbmd7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRjb25zdCBjb2xvciA9IENvbG9ySGVscGVyLmNvbG9yc1tkcy5pbmRleCAlIENvbG9ySGVscGVyLmNvbG9ycy5sZW5ndGhdO1xyXG5cdFx0Y29uc3QgZGVmYXVsdENvbG9yID0gQ29sb3JIZWxwZXIuaGV4VG9SZ2JTdHJpbmcoIGNvbG9yLCBvcGFjaXR5ICk7XHJcblxyXG5cdFx0Y29uc3QgdXNlT3ZlcnJpZGUgPSAoIG8gJiYgdW5kZWZpbmVkICE9IG8uY29sb3IgKVxyXG5cdFx0bGV0IG92ZXJyaWRlQ29sb3I6IHN0cmluZztcclxuXHJcblx0XHRpZiggdXNlT3ZlcnJpZGUgKXtcclxuXHRcdFx0b3ZlcnJpZGVDb2xvciA9IENvbG9ySGVscGVyLmhleFRvUmdiU3RyaW5nKCBvLmNvbG9yLCBvcGFjaXR5ICk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuICggdXNlT3ZlcnJpZGUgKSA/IG92ZXJyaWRlQ29sb3IgOiBkZWZhdWx0Q29sb3I7XHJcblx0fVxyXG5cclxuXHRnZXRGaWxsKCBkczogRGF0YVNldCApOiBudW1iZXJ7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLmxpbmVGaWxsICkgPyBvLmxpbmVGaWxsIDogdGhpcy5kaXNwbGF5LmZpbGw7XHJcblx0fVxyXG5cclxuXHRnZXRTdGFpcmNhc2UoIGRzOiBEYXRhU2V0ICk6IGJvb2xlYW57XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLnN0YWlyY2FzZSApID8gby5zdGFpcmNhc2UgOiB0aGlzLmRpc3BsYXkuc3RhaXJjYXNlO1xyXG5cdH1cclxuXHJcblx0Z2V0RGFzaGVzKCBkczogRGF0YVNldCApe1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5kYXNoZXMgKSA/IG8uZGFzaGVzIDogZmFsc2U7XHJcblx0fVxyXG5cclxuXHRnZXREYXNoTGVuZ3RoKCBkczogRGF0YVNldCApOiBudW1iZXJ7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLmRhc2hMZW5ndGggKSA/IG8uZGFzaExlbmd0aCA6IDE7XHJcblx0fVxyXG5cclxuXHRnZXREYXNoU3BhY2UoIGRzOiBEYXRhU2V0ICk6IG51bWJlcntcclxuXHRcdGNvbnN0IG8gPSB0aGlzLmdldE92ZXJyaWRlKCBkcyApO1xyXG5cclxuXHRcdHJldHVybiAoIG8gJiYgdW5kZWZpbmVkICE9IG8uZGFzaFNwYWNlICkgPyBvLmRhc2hTcGFjZSA6IDE7XHJcblx0fVxyXG5cclxuXHRnZXRTaG93UG9pbnRzKCBkczogRGF0YVNldCApIDogYm9vbGVhbiB7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLnBvaW50cyApID8gby5wb2ludHMgOiB0aGlzLmRpc3BsYXkuc2hvd1BvaW50cztcclxuXHR9XHJcblxyXG5cdGdldFBvaW50UmFkaXVzKCBkczogRGF0YVNldCApIDogbnVtYmVye1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5wb2ludFJhZGl1cyApID8gby5wb2ludFJhZGl1cyA6IHRoaXMuZGlzcGxheS5wb2ludFJhZGl1cztcclxuXHR9XHJcblxyXG5cdGdldExlZ2VuZCggZHM6IERhdGFTZXQgKSA6IGJvb2xlYW57XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLmxlZ2VuZCApID8gby5sZWdlbmQgOiB0cnVlO1xyXG5cdH1cclxuXHJcblx0Z2V0WkluZGV4KCBkczogRGF0YVNldCApOiBudW1iZXJ7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLnpJbmRleCApID8gby56SW5kZXggOiAwO1xyXG5cdH1cclxuXHJcblx0Z2V0WUF4aXMoIGRzOiBEYXRhU2V0ICl7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLnlBeGlzICkgPyBvLnlBeGlzIDogMTtcclxuXHR9XHJcblxyXG5cdGdldE92ZXJyaWRlKCBkczogRGF0YVNldCApe1xyXG5cdFx0cmV0dXJuIHRoaXMuZ2V0T3ZlcnJpZGVCeUxhYmVsKCBkcy5sYWJlbCApO1xyXG5cdH1cclxuXHJcblx0Z2V0T3ZlcnJpZGVCeUxhYmVsKCBsYWJlbDogc3RyaW5nICl7XHJcblx0XHRyZXR1cm4gdGhpc1xyXG5cdFx0XHQuZGlzcGxheVxyXG5cdFx0XHQub3ZlcnJpZGVzXHJcblx0XHRcdD8uZmluZCggeCA9PiB4LmFsaWFzICYmIG5ldyBSZWdFeHAoIHguYWxpYXMgKS50ZXN0KCBsYWJlbCApICApXHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiJdfQ==