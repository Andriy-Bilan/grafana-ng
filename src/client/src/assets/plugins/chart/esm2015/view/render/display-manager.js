import { Inject, Injectable } from '@angular/core';
import { PANEL_TOKEN } from '../../chart.m';
import { ColorHelper } from './color-helper';
import * as i0 from "@angular/core";
export class DisplayManager {
    constructor(panel) {
        this.panel = panel;
    }
    get display() {
        return this.panel.widget.display;
    }
    setup(ds) {
        //this.setupSecondaryYAxis();					
        this.setupLines(ds);
        this.setupPoints(ds);
        this.setupNullValue(ds);
        //this.chart.options.scales.yAxes[ 0 ].stacked = this.chart.widget.display.stack;
    }
    setupLines(ds) {
        const showLines = this.getShowLines(ds);
        const lineWidth = this.getLineWidth(ds);
        const fill = this.getFill(ds);
        let opacity = (fill / 10);
        ds.fill = ( /*showLines &&*/fill > 0);
        ds.backgroundColor = this.getLineColor(ds, opacity);
        opacity = (showLines && lineWidth) ? 1 : 0;
        ds.borderColor = this.getLineColor(ds, opacity);
        ds.borderWidth = lineWidth;
        ds.steppedLine = this.getStaircase(ds);
        if (this.getDashes(ds)) {
            const len = this.getDashLength(ds);
            const space = this.getDashSpace(ds);
            ds.borderDash = [len, space];
        }
        else {
            ds.borderDash = undefined;
        }
        ds.order = this.getZIndex(ds);
        ds.legend = this.getLegend(ds);
        // ds.yAxisID = ( 1 == this.getYAxis( ds ) ) ? 'A': 'B';
    }
    setupPoints(ds) {
        const showPoints = this.getShowPoints(ds);
        const opacity = showPoints ? 1 : 0;
        const color = this.getLineColor(ds, opacity);
        ds.pointBorderColor = `${color}`;
        ds.pointBackgroundColor = `${color}`;
        ds.pointRadius = showPoints ? this.getPointRadius(ds) : 0;
    }
    setupNullValue(ds) {
        switch (parseInt(this.display.nullValue)) {
            // case CartesianChart.NullValue.Connected:
            // 	this.chart.options.spanGaps = true;
            // 	ds.data.forEach( p => p.y = p.isNull ? null : p.y );
            // 	break;
            // case CartesianChart.NullValue.Null:
            // 	this.chart.options.spanGaps = false;
            // 	ds.data.forEach( p => p.y = p.isNull ? null : p.y );
            // 	break;
            // case CartesianChart.NullValue.NullAsZero:
            // 	this.chart.options.spanGaps = false;
            // 	ds.data.forEach( p => p.y = p.isNull ? 0 : p.y );
            // 	break;
        }
    }
    setupOverrides() {
        // const needSecondaryYAxis = AxesManager.needSecondaryYAxis( this.chart.widget );
        // const actualSecondaryYAxisUsers = this
        // 	.datasets
        // 	.filter( x => x.yAxisID == 'B' )
        // 	.length
        // const yAxesCount = this.chart.options.scales.yAxes.length;
        // if( 2 == yAxesCount && !needSecondaryYAxis ){
        // 	this.chart.options.scales.yAxes.splice( 1, 1 );
        // } else if( /*1 == yAxesCount && needSecondaryYAxis*/ actualSecondaryYAxisUsers != needSecondaryYAxis ){
        // 	this.chart.destroy();
        // 	this.chart.needRebuild.emit();
        // 	this.chart = undefined;
        // 	return;
        // }
        // this.datasets.forEach(x => this.setup(x));
    }
    getShowLines(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.lines) ? o.lines : this.display.showLines;
    }
    getLineWidth(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.lineWidth) ? o.lineWidth : this.display.lineWidth;
    }
    getLineColor(ds, opacity) {
        const o = this.getOverride(ds);
        const defaultColor = ColorHelper.getColorAsArgbFunc(ds, opacity);
        const useOverride = (o && undefined != o.color);
        let overrideColor;
        if (useOverride) {
            var color = ColorHelper.parse(o.color);
            overrideColor = `rgba(${color.r},${color.g},${color.b},${opacity})`;
        }
        return (useOverride) ? overrideColor : defaultColor;
    }
    getFill(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.lineFill) ? o.lineFill : this.display.fill;
    }
    getStaircase(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.staircase) ? o.staircase : this.display.staircase;
    }
    getDashes(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.dashes) ? o.dashes : false;
    }
    getDashLength(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.dashLength) ? o.dashLength : 1;
    }
    getDashSpace(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.dashSpace) ? o.dashSpace : 1;
    }
    getShowPoints(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.points) ? o.points : this.display.showPoints;
    }
    getPointRadius(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.pointRadius) ? o.pointRadius : this.display.pointRadius;
    }
    getLegend(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.legend) ? o.legend : true;
    }
    getZIndex(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.zIndex) ? o.zIndex : 0;
    }
    getYAxis(ds) {
        const o = this.getOverride(ds);
        return (o && undefined != o.yAxis) ? o.yAxis : 1;
    }
    getOverride(ds) {
        return this
            .display
            .overrides
            .find(x => x.alias && new RegExp(x.alias).test(ds.label));
    }
}
DisplayManager.ɵfac = function DisplayManager_Factory(t) { return new (t || DisplayManager)(i0.ɵɵinject(PANEL_TOKEN)); };
DisplayManager.ɵprov = i0.ɵɵdefineInjectable({ token: DisplayManager, factory: DisplayManager.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(DisplayManager, [{
        type: Injectable
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [PANEL_TOKEN]
            }] }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzcGxheS1tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vYXBwL3BsdWdpbnMvd2lkZ2V0cy9jaGFydC9zcmMvdmlldy9yZW5kZXIvZGlzcGxheS1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRW5ELE9BQU8sRUFBVyxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQUc3QyxNQUFNLE9BQU8sY0FBYztJQU0xQixZQUE2QyxLQUFZO1FBQVosVUFBSyxHQUFMLEtBQUssQ0FBTztJQUV6RCxDQUFDO0lBTkQsSUFBWSxPQUFPO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ2xDLENBQUM7SUFNRCxLQUFLLENBQUMsRUFBVztRQUNoQixrQ0FBa0M7UUFFbEMsSUFBSSxDQUFDLFVBQVUsQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsV0FBVyxDQUFFLEVBQUUsQ0FBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxjQUFjLENBQUUsRUFBRSxDQUFFLENBQUM7UUFFMUIsaUZBQWlGO0lBQ2xGLENBQUM7SUFFTyxVQUFVLENBQUUsRUFBVztRQUM5QixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFFLEVBQUUsQ0FBRSxDQUFDO1FBQzFDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUUsRUFBRSxDQUFFLENBQUM7UUFDMUMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUVoQyxJQUFJLE9BQU8sR0FBRyxDQUFFLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQztRQUMzQixFQUFFLENBQUMsSUFBSSxH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SSxDQUFDLFdBQVcsQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUUsQ0FBQyxJQUFJLFNBQVMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsV0FBVyxDQUFFLEVBQVc7UUFDdkIsT0FBTyxJQUFJO2FBQ1QsT0FBTzthQUNQLFNBQVM7YUFDVCxJQUFJLENBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksTUFBTSxDQUFFLENBQUMsQ0FBQyxLQUFLLENBQUUsQ0FBQyxJQUFJLENBQUUsRUFBRSxDQUFDLEtBQUssQ0FBRSxDQUFHLENBQUE7SUFDbEUsQ0FBQzs7NEVBcE1XLGNBQWMsY0FNSCxXQUFXO3NEQU50QixjQUFjLFdBQWQsY0FBYztrREFBZCxjQUFjO2NBRDFCLFVBQVU7O3NCQU9LLE1BQU07dUJBQUUsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQYW5lbCB9IGZyb20gJ2NvbW1vbic7XHJcbmltcG9ydCB7IERhdGFTZXQsIFBBTkVMX1RPS0VOIH0gZnJvbSAnLi4vLi4vY2hhcnQubSc7XHJcbmltcG9ydCB7IENvbG9ySGVscGVyIH0gZnJvbSAnLi9jb2xvci1oZWxwZXInO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGlzcGxheU1hbmFnZXIge1xyXG5cclxuXHRwcml2YXRlIGdldCBkaXNwbGF5KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMucGFuZWwud2lkZ2V0LmRpc3BsYXk7XHJcblx0fVxyXG5cclxuXHRjb25zdHJ1Y3RvciAoIEBJbmplY3QoIFBBTkVMX1RPS0VOICkgcHJpdmF0ZSBwYW5lbDogUGFuZWwgKSB7XHJcblxyXG5cdH1cclxuXHJcblx0c2V0dXAoZHM6IERhdGFTZXQpIHtcclxuXHRcdC8vdGhpcy5zZXR1cFNlY29uZGFyeVlBeGlzKCk7XHRcdFx0XHRcdFxyXG5cclxuXHRcdHRoaXMuc2V0dXBMaW5lcyggZHMgKTtcclxuXHRcdHRoaXMuc2V0dXBQb2ludHMoIGRzICk7XHJcblx0XHR0aGlzLnNldHVwTnVsbFZhbHVlKCBkcyApO1xyXG5cclxuXHRcdC8vdGhpcy5jaGFydC5vcHRpb25zLnNjYWxlcy55QXhlc1sgMCBdLnN0YWNrZWQgPSB0aGlzLmNoYXJ0LndpZGdldC5kaXNwbGF5LnN0YWNrO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBzZXR1cExpbmVzKCBkczogRGF0YVNldCApIHtcclxuXHRcdGNvbnN0IHNob3dMaW5lcyA9IHRoaXMuZ2V0U2hvd0xpbmVzKCBkcyApO1xyXG5cdFx0Y29uc3QgbGluZVdpZHRoID0gdGhpcy5nZXRMaW5lV2lkdGgoIGRzICk7XHJcblx0XHRjb25zdCBmaWxsID0gdGhpcy5nZXRGaWxsKCBkcyApO1xyXG5cclxuXHRcdGxldCBvcGFjaXR5ID0gKCBmaWxsIC8gMTApO1xyXG5cdFx0ZHMuZmlsbCA9ICgvKnNob3dMaW5lcyAmJiovIGZpbGwgPiAwKTtcclxuXHRcdGRzLmJhY2tncm91bmRDb2xvciA9IHRoaXMuZ2V0TGluZUNvbG9yKCBkcywgb3BhY2l0eSApO1xyXG5cclxuXHRcdG9wYWNpdHkgPSAoc2hvd0xpbmVzICYmIGxpbmVXaWR0aCkgPyAxIDogMDtcclxuXHRcdGRzLmJvcmRlckNvbG9yID0gdGhpcy5nZXRMaW5lQ29sb3IoIGRzLCBvcGFjaXR5ICk7XHJcblx0XHRkcy5ib3JkZXJXaWR0aCA9IGxpbmVXaWR0aDtcclxuXHJcblx0XHQgZHMuc3RlcHBlZExpbmUgPSB0aGlzLmdldFN0YWlyY2FzZSggZHMgKTtcclxuXHJcblx0XHRpZiggdGhpcy5nZXREYXNoZXMoIGRzICkgKXtcclxuXHRcdFx0Y29uc3QgbGVuID0gdGhpcy5nZXREYXNoTGVuZ3RoKCBkcyApO1xyXG5cdFx0XHRjb25zdCBzcGFjZSA9IHRoaXMuZ2V0RGFzaFNwYWNlKCBkcyApO1xyXG5cdFx0XHRkcy5ib3JkZXJEYXNoID0gWyBsZW4sIHNwYWNlIF1cclxuXHRcdH1cclxuXHRcdGVsc2V7XHJcblx0XHRcdGRzLmJvcmRlckRhc2ggPSB1bmRlZmluZWQ7XHJcblx0XHR9XHJcblxyXG5cdFx0ZHMub3JkZXIgPSB0aGlzLmdldFpJbmRleCggZHMgKTtcclxuXHRcdGRzLmxlZ2VuZCA9IHRoaXMuZ2V0TGVnZW5kKCBkcyApO1xyXG5cclxuXHRcdC8vIGRzLnlBeGlzSUQgPSAoIDEgPT0gdGhpcy5nZXRZQXhpcyggZHMgKSApID8gJ0EnOiAnQic7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHNldHVwUG9pbnRzKCBkczogRGF0YVNldCApIHtcclxuXHRcdGNvbnN0IHNob3dQb2ludHMgPSB0aGlzLmdldFNob3dQb2ludHMoIGRzICk7XHJcblxyXG5cdFx0Y29uc3Qgb3BhY2l0eSA9IHNob3dQb2ludHMgPyAxIDogMFxyXG5cdFx0Y29uc3QgY29sb3IgPSB0aGlzLmdldExpbmVDb2xvciggZHMsIG9wYWNpdHkgKTtcclxuXHJcblx0XHRkcy5wb2ludEJvcmRlckNvbG9yID0gYCR7Y29sb3J9YDtcclxuXHRcdGRzLnBvaW50QmFja2dyb3VuZENvbG9yID0gYCR7Y29sb3J9YDtcclxuXHJcblx0XHRkcy5wb2ludFJhZGl1cyA9IHNob3dQb2ludHMgPyB0aGlzLmdldFBvaW50UmFkaXVzKCBkcyApIDogMDtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgc2V0dXBOdWxsVmFsdWUoIGRzOiBEYXRhU2V0ICkge1xyXG5cdFx0c3dpdGNoIChwYXJzZUludCggdGhpcy5kaXNwbGF5Lm51bGxWYWx1ZSApKSB7XHJcblx0XHRcdC8vIGNhc2UgQ2FydGVzaWFuQ2hhcnQuTnVsbFZhbHVlLkNvbm5lY3RlZDpcclxuXHRcdFx0Ly8gXHR0aGlzLmNoYXJ0Lm9wdGlvbnMuc3BhbkdhcHMgPSB0cnVlO1xyXG5cdFx0XHQvLyBcdGRzLmRhdGEuZm9yRWFjaCggcCA9PiBwLnkgPSBwLmlzTnVsbCA/IG51bGwgOiBwLnkgKTtcclxuXHRcdFx0Ly8gXHRicmVhaztcclxuXHJcblx0XHRcdC8vIGNhc2UgQ2FydGVzaWFuQ2hhcnQuTnVsbFZhbHVlLk51bGw6XHJcblx0XHRcdC8vIFx0dGhpcy5jaGFydC5vcHRpb25zLnNwYW5HYXBzID0gZmFsc2U7XHJcblx0XHRcdC8vIFx0ZHMuZGF0YS5mb3JFYWNoKCBwID0+IHAueSA9IHAuaXNOdWxsID8gbnVsbCA6IHAueSApO1xyXG5cdFx0XHQvLyBcdGJyZWFrO1xyXG5cclxuXHRcdFx0Ly8gY2FzZSBDYXJ0ZXNpYW5DaGFydC5OdWxsVmFsdWUuTnVsbEFzWmVybzpcclxuXHRcdFx0Ly8gXHR0aGlzLmNoYXJ0Lm9wdGlvbnMuc3BhbkdhcHMgPSBmYWxzZTtcclxuXHRcdFx0Ly8gXHRkcy5kYXRhLmZvckVhY2goIHAgPT4gcC55ID0gcC5pc051bGwgPyAwIDogcC55ICk7XHJcblx0XHRcdC8vIFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHNldHVwT3ZlcnJpZGVzKCl7XHJcblx0XHQvLyBjb25zdCBuZWVkU2Vjb25kYXJ5WUF4aXMgPSBBeGVzTWFuYWdlci5uZWVkU2Vjb25kYXJ5WUF4aXMoIHRoaXMuY2hhcnQud2lkZ2V0ICk7XHJcblxyXG5cdFx0Ly8gY29uc3QgYWN0dWFsU2Vjb25kYXJ5WUF4aXNVc2VycyA9IHRoaXNcclxuXHRcdC8vIFx0LmRhdGFzZXRzXHJcblx0XHQvLyBcdC5maWx0ZXIoIHggPT4geC55QXhpc0lEID09ICdCJyApXHJcblx0XHQvLyBcdC5sZW5ndGhcclxuIFxyXG5cdFx0Ly8gY29uc3QgeUF4ZXNDb3VudCA9IHRoaXMuY2hhcnQub3B0aW9ucy5zY2FsZXMueUF4ZXMubGVuZ3RoO1xyXG5cdFx0XHJcblx0XHQvLyBpZiggMiA9PSB5QXhlc0NvdW50ICYmICFuZWVkU2Vjb25kYXJ5WUF4aXMgKXtcclxuXHRcdC8vIFx0dGhpcy5jaGFydC5vcHRpb25zLnNjYWxlcy55QXhlcy5zcGxpY2UoIDEsIDEgKTtcclxuXHRcdC8vIH0gZWxzZSBpZiggLyoxID09IHlBeGVzQ291bnQgJiYgbmVlZFNlY29uZGFyeVlBeGlzKi8gYWN0dWFsU2Vjb25kYXJ5WUF4aXNVc2VycyAhPSBuZWVkU2Vjb25kYXJ5WUF4aXMgKXtcclxuXHRcdC8vIFx0dGhpcy5jaGFydC5kZXN0cm95KCk7XHJcblx0XHQvLyBcdHRoaXMuY2hhcnQubmVlZFJlYnVpbGQuZW1pdCgpO1xyXG5cdFx0Ly8gXHR0aGlzLmNoYXJ0ID0gdW5kZWZpbmVkO1xyXG5cdFx0Ly8gXHRyZXR1cm47XHJcblx0XHQvLyB9XHJcblxyXG5cdFx0Ly8gdGhpcy5kYXRhc2V0cy5mb3JFYWNoKHggPT4gdGhpcy5zZXR1cCh4KSk7XHJcblx0fVxyXG5cclxuXHRnZXRTaG93TGluZXMoZHM6IERhdGFTZXQpOiBib29sZWFue1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5saW5lcyApID8gby5saW5lcyA6IHRoaXMuZGlzcGxheS5zaG93TGluZXM7XHJcblx0fVxyXG5cdFxyXG5cdGdldExpbmVXaWR0aChkczogRGF0YVNldCk6IG51bWJlcntcclxuXHRcdGNvbnN0IG8gPSB0aGlzLmdldE92ZXJyaWRlKCBkcyApO1xyXG5cclxuXHRcdHJldHVybiAoIG8gJiYgdW5kZWZpbmVkICE9IG8ubGluZVdpZHRoICkgPyBvLmxpbmVXaWR0aCA6IHRoaXMuZGlzcGxheS5saW5lV2lkdGg7XHJcblx0fVxyXG5cclxuXHRnZXRMaW5lQ29sb3IoZHM6IERhdGFTZXQsIG9wYWNpdHk6IG51bWJlcikgOiBzdHJpbmd7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRjb25zdCBkZWZhdWx0Q29sb3IgPSBDb2xvckhlbHBlci5nZXRDb2xvckFzQXJnYkZ1bmMoZHMsIG9wYWNpdHkpXHJcblxyXG5cdFx0Y29uc3QgdXNlT3ZlcnJpZGUgPSAoIG8gJiYgdW5kZWZpbmVkICE9IG8uY29sb3IgKVxyXG5cdFx0bGV0IG92ZXJyaWRlQ29sb3I6IHN0cmluZztcclxuXHJcblx0XHRpZiggdXNlT3ZlcnJpZGUgKXtcclxuXHRcdFx0dmFyIGNvbG9yID0gQ29sb3JIZWxwZXIucGFyc2UoIG8uY29sb3IgKTtcclxuXHRcdFx0b3ZlcnJpZGVDb2xvciA9IGByZ2JhKCR7Y29sb3Iucn0sJHtjb2xvci5nfSwke2NvbG9yLmJ9LCR7b3BhY2l0eX0pYFxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiAoIHVzZU92ZXJyaWRlICkgPyBvdmVycmlkZUNvbG9yIDogZGVmYXVsdENvbG9yO1xyXG5cdH1cclxuXHJcblx0Z2V0RmlsbCggZHM6IERhdGFTZXQgKTogbnVtYmVye1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5saW5lRmlsbCApID8gby5saW5lRmlsbCA6IHRoaXMuZGlzcGxheS5maWxsO1xyXG5cdH1cclxuXHJcblx0Z2V0U3RhaXJjYXNlKCBkczogRGF0YVNldCApOiBib29sZWFue1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5zdGFpcmNhc2UgKSA/IG8uc3RhaXJjYXNlIDogdGhpcy5kaXNwbGF5LnN0YWlyY2FzZTtcclxuXHR9XHJcblxyXG5cdGdldERhc2hlcyggZHM6IERhdGFTZXQgKXtcclxuXHRcdGNvbnN0IG8gPSB0aGlzLmdldE92ZXJyaWRlKCBkcyApO1xyXG5cclxuXHRcdHJldHVybiAoIG8gJiYgdW5kZWZpbmVkICE9IG8uZGFzaGVzICkgPyBvLmRhc2hlcyA6IGZhbHNlO1xyXG5cdH1cclxuXHJcblx0Z2V0RGFzaExlbmd0aCggZHM6IERhdGFTZXQgKTogbnVtYmVye1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5kYXNoTGVuZ3RoICkgPyBvLmRhc2hMZW5ndGggOiAxO1xyXG5cdH1cclxuXHJcblx0Z2V0RGFzaFNwYWNlKCBkczogRGF0YVNldCApOiBudW1iZXJ7XHJcblx0XHRjb25zdCBvID0gdGhpcy5nZXRPdmVycmlkZSggZHMgKTtcclxuXHJcblx0XHRyZXR1cm4gKCBvICYmIHVuZGVmaW5lZCAhPSBvLmRhc2hTcGFjZSApID8gby5kYXNoU3BhY2UgOiAxO1xyXG5cdH1cclxuXHJcblx0Z2V0U2hvd1BvaW50cyggZHM6IERhdGFTZXQgKSA6IGJvb2xlYW4ge1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5wb2ludHMgKSA/IG8ucG9pbnRzIDogdGhpcy5kaXNwbGF5LnNob3dQb2ludHM7XHJcblx0fVxyXG5cclxuXHRnZXRQb2ludFJhZGl1cyggZHM6IERhdGFTZXQgKSA6IG51bWJlcntcclxuXHRcdGNvbnN0IG8gPSB0aGlzLmdldE92ZXJyaWRlKCBkcyApO1xyXG5cclxuXHRcdHJldHVybiAoIG8gJiYgdW5kZWZpbmVkICE9IG8ucG9pbnRSYWRpdXMgKSA/IG8ucG9pbnRSYWRpdXMgOiB0aGlzLmRpc3BsYXkucG9pbnRSYWRpdXM7XHJcblx0fVxyXG5cclxuXHRnZXRMZWdlbmQoIGRzOiBEYXRhU2V0ICkgOiBib29sZWFue1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby5sZWdlbmQgKSA/IG8ubGVnZW5kIDogdHJ1ZTtcclxuXHR9XHJcblxyXG5cdGdldFpJbmRleCggZHM6IERhdGFTZXQgKTogbnVtYmVye1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby56SW5kZXggKSA/IG8uekluZGV4IDogMDtcclxuXHR9XHJcblxyXG5cdGdldFlBeGlzKCBkczogRGF0YVNldCApe1xyXG5cdFx0Y29uc3QgbyA9IHRoaXMuZ2V0T3ZlcnJpZGUoIGRzICk7XHJcblxyXG5cdFx0cmV0dXJuICggbyAmJiB1bmRlZmluZWQgIT0gby55QXhpcyApID8gby55QXhpcyA6IDE7XHJcblx0fVxyXG5cclxuXHRnZXRPdmVycmlkZSggZHM6IERhdGFTZXQgKXtcclxuXHRcdHJldHVybiB0aGlzXHJcblx0XHRcdC5kaXNwbGF5XHJcblx0XHRcdC5vdmVycmlkZXNcclxuXHRcdFx0LmZpbmQoIHggPT4geC5hbGlhcyAmJiBuZXcgUmVnRXhwKCB4LmFsaWFzICkudGVzdCggZHMubGFiZWwgKSAgKVxyXG5cdH1cclxuXHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl19