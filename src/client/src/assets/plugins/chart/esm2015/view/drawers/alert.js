import { Injectable } from '@angular/core';
import { AlertEvalType } from 'common';
import { ColorHelper } from 'uilib';
import { BaseChartExtension } from '../../base/chart-base-extension';
import { AXIS_X, AXIS_Y_LEFT } from '../../chart.m';
import * as i0 from "@angular/core";
import * as i1 from "../../base/chart.store";
export class AlertDrawerPlugin extends BaseChartExtension {
    constructor(store) {
        super(store);
    }
    afterDatasetsDraw(chart, _) {
        var _a, _b;
        const conditions = (_b = (_a = this
            .widget) === null || _a === void 0 ? void 0 : _a.alert) === null || _b === void 0 ? void 0 : _b.conditions;
        if (conditions === null || conditions === void 0 ? void 0 : conditions.length) {
            new AlertDrawer(chart, conditions[0].evaluator).draw();
        }
    }
}
AlertDrawerPlugin.ɵfac = function AlertDrawerPlugin_Factory(t) { return new (t || AlertDrawerPlugin)(i0.ɵɵinject(i1.ChartStore)); };
AlertDrawerPlugin.ɵprov = i0.ɵɵdefineInjectable({ token: AlertDrawerPlugin, factory: AlertDrawerPlugin.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AlertDrawerPlugin, [{
        type: Injectable
    }], function () { return [{ type: i1.ChartStore }]; }, null); })();
class AlertDrawer {
    constructor(chart, evaluator) {
        this.chart = chart;
        this.evaluator = evaluator;
    }
    get context() {
        return this.chart.chart.ctx;
    }
    get scaleY() {
        return this.chart.scales[AXIS_Y_LEFT];
    }
    get scaleX() {
        return this.chart.scales[AXIS_X];
    }
    draw() {
        const offset1 = this.scaleY.getPixelForValue(+this.evaluator.params[0]);
        const offset2 = this.scaleY.getPixelForValue(+this.evaluator.params[1]);
        const topY = this.scaleY.getPixelForValue(this.scaleY.max);
        const bottomY = this.scaleY.getPixelForValue(this.scaleY.min);
        switch (+this.evaluator.type) {
            case AlertEvalType.IsAbove:
                if (!(topY > offset1 || bottomY < offset1)) {
                    this.renderLine(offset1);
                    this.renderRectangle(offset1, true);
                }
                break;
            case AlertEvalType.IsBelow:
                if (!(topY > offset1 || bottomY < offset1)) {
                    this.renderLine(offset1);
                    this.renderRectangle(offset1, false);
                }
                break;
            case AlertEvalType.IsWithinRange:
                if (!(topY > offset1 || bottomY < offset1 || topY > offset2 || bottomY < offset2)) {
                    this.renderLine(offset1);
                    this.renderLine(offset2);
                    this.renderRectangleBetween(offset1, offset2);
                }
                break;
            case AlertEvalType.IsOutsideRange:
                if (!(topY > offset1 || bottomY < offset1 || topY > offset2 || bottomY < offset2)) {
                    this.renderLine(offset1);
                    this.renderLine(offset2);
                    this.renderRectangle(offset1, false);
                    this.renderRectangle(offset2, true);
                }
                break;
        }
    }
    renderLine(offset) {
        this.context.beginPath();
        this.context.strokeStyle = AlertDrawer.LINE_COLOR;
        this.context.lineWidth = 2;
        this.context.moveTo(this.scaleX.left, offset);
        this.context.lineTo(this.scaleX.right, offset);
        this.context.stroke();
    }
    renderRectangle(offset, gt) {
        this.context.fillStyle = AlertDrawer.FILL_COLOR;
        const x = this.scaleX.left;
        const w = this.scaleX.width;
        const topY = this.scaleY.getPixelForValue(this.scaleY.max);
        const bottomY = this.scaleY.getPixelForValue(this.scaleY.min);
        const y = gt ? topY : Math.max(topY, offset);
        let h = gt ? offset - this.scaleY.top : this.scaleY.bottom - offset;
        h = Math.min(bottomY - topY, h);
        this.context.fillRect(x, y, w, h);
    }
    renderRectangleBetween(offset1, offset2) {
        this.context.fillStyle = AlertDrawer.FILL_COLOR;
        const x = this.scaleX.left;
        const w = this.scaleX.width;
        this.context.fillRect(x, offset1, w, offset2 - offset1);
    }
}
AlertDrawer.LINE_COLOR = ColorHelper.hexToRgbString(ColorHelper.ALERTING_COLOR, 0.6);
AlertDrawer.FILL_COLOR = ColorHelper.hexToRgbString(ColorHelper.ALERTING_COLOR, ColorHelper.REGION_FILL_ALPHA);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9hcHAvcGx1Z2lucy93aWRnZXRzL2NoYXJ0L3NyYy92aWV3L2RyYXdlcnMvYWxlcnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsYUFBYSxFQUFrQixNQUFNLFFBQVEsQ0FBQztBQUN2RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBRXJFLE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFHcEQsTUFBTSxPQUFPLGlCQUFrQixTQUFRLGtCQUFrQjtJQUV4RCxZQUFhLEtBQWlCO1FBQzdCLEtBQUssQ0FBRSxLQUFLLENBQUUsQ0FBQztJQUNoQixDQUFDO0lBRUQsaUJBQWlCLENBQUMsS0FBSyxFQUFFLENBQUM7O1FBQ3pCLE1BQU0sVUFBVSxlQUFHLElBQUk7YUFDckIsTUFBTSwwQ0FDTCxLQUFLLDBDQUNMLFVBQVUsQ0FBQztRQUVkLElBQUksVUFBVSxhQUFWLFVBQVUsdUJBQVYsVUFBVSxDQUFFLE1BQU0sRUFBRTtZQUN2QixJQUFJLFdBQVcsQ0FBRSxLQUFLLEVBQUUsVUFBVSxDQUFFLENBQUMsQ0FBRSxDQUFDLFNBQVMsQ0FBRSxDQUFDLElBQUksRUFBRSxDQUFBO1NBQzFEO0lBQ0YsQ0FBQzs7a0ZBZlcsaUJBQWlCO3lEQUFqQixpQkFBaUIsV0FBakIsaUJBQWlCO2tEQUFqQixpQkFBaUI7Y0FEN0IsVUFBVTs7QUFtQlgsTUFBTSxXQUFXO0lBb0JoQixZQUFxQixLQUFVLEVBQVUsU0FBeUI7UUFBN0MsVUFBSyxHQUFMLEtBQUssQ0FBSztRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWdCO0lBRWxFLENBQUM7SUFkRCxJ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TSxDQUFDO1FBRXBFLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFFLE9BQU8sR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFFLENBQUE7UUFFakMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFLENBQUM7SUFDckMsQ0FBQztJQUVPLHNCQUFzQixDQUFFLE9BQU8sRUFBRSxPQUFPO1FBQy9DLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUM7UUFFaEQsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDM0IsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFFNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsT0FBTyxHQUFHLE9BQU8sQ0FBRSxDQUFDO0lBQzNELENBQUM7O0FBakdlLHNCQUFVLEdBQUcsV0FBVyxDQUFDLGNBQWMsQ0FDdEQsV0FBVyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUUsQ0FBQTtBQUVsQixzQkFBVSxHQUFHLFdBQVcsQ0FBQyxjQUFjLENBQ3RELFdBQVcsQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLGlCQUFpQixDQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFsZXJ0RXZhbFR5cGUsIEFsZXJ0RXZhbHVhdG9yIH0gZnJvbSAnY29tbW9uJztcclxuaW1wb3J0IHsgQ29sb3JIZWxwZXIgfSBmcm9tICd1aWxpYic7XHJcbmltcG9ydCB7IEJhc2VDaGFydEV4dGVuc2lvbiB9IGZyb20gJy4uLy4uL2Jhc2UvY2hhcnQtYmFzZS1leHRlbnNpb24nO1xyXG5pbXBvcnQgeyBDaGFydFN0b3JlIH0gZnJvbSAnLi4vLi4vYmFzZS9jaGFydC5zdG9yZSc7XHJcbmltcG9ydCB7IEFYSVNfWCwgQVhJU19ZX0xFRlQgfSBmcm9tICcuLi8uLi9jaGFydC5tJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEFsZXJ0RHJhd2VyUGx1Z2luIGV4dGVuZHMgQmFzZUNoYXJ0RXh0ZW5zaW9uIHtcclxuXHJcblx0Y29uc3RydWN0b3IoIHN0b3JlOiBDaGFydFN0b3JlICl7XHJcblx0XHRzdXBlciggc3RvcmUgKTtcclxuXHR9XHJcblxyXG5cdGFmdGVyRGF0YXNldHNEcmF3KGNoYXJ0LCBfKSB7XHJcblx0XHRjb25zdCBjb25kaXRpb25zID0gdGhpc1xyXG5cdFx0XHQud2lkZ2V0XHJcblx0XHRcdD8uYWxlcnRcclxuXHRcdFx0Py5jb25kaXRpb25zO1xyXG5cclxuXHRcdGlmKCBjb25kaXRpb25zPy5sZW5ndGggKXtcclxuXHRcdFx0bmV3IEFsZXJ0RHJhd2VyKCBjaGFydCwgY29uZGl0aW9uc1sgMCBdLmV2YWx1YXRvciApLmRyYXcoKVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQWxlcnREcmF3ZXJ7XHJcblxyXG5cdHN0YXRpYyByZWFkb25seSBMSU5FX0NPTE9SID0gQ29sb3JIZWxwZXIuaGV4VG9SZ2JTdHJpbmcoIFxyXG5cdFx0Q29sb3JIZWxwZXIuQUxFUlRJTkdfQ09MT1IsIDAuNiApXHJcblxyXG5cdHN0YXRpYyByZWFkb25seSBGSUxMX0NPTE9SID0gQ29sb3JIZWxwZXIuaGV4VG9SZ2JTdHJpbmcoIFxyXG5cdFx0Q29sb3JIZWxwZXIuQUxFUlRJTkdfQ09MT1IsIENvbG9ySGVscGVyLlJFR0lPTl9GSUxMX0FMUEhBIClcclxuXHJcblx0Z2V0IGNvbnRleHQoKXtcclxuXHRcdHJldHVybiB0aGlzLmNoYXJ0LmNoYXJ0LmN0eDtcclxuXHR9XHJcblxyXG5cdGdldCBzY2FsZVkoKXtcclxuXHRcdHJldHVybiB0aGlzLmNoYXJ0LnNjYWxlc1sgQVhJU19ZX0xFRlQgXTtcclxuXHR9XHJcblxyXG5cdGdldCBzY2FsZVgoKXtcclxuXHRcdHJldHVybiB0aGlzLmNoYXJ0LnNjYWxlc1sgQVhJU19YIF07XHJcblx0fVxyXG5cclxuXHRjb25zdHJ1Y3RvciggcHJpdmF0ZSBjaGFydDogYW55LCBwcml2YXRlIGV2YWx1YXRvcjogQWxlcnRFdmFsdWF0b3IgKXtcclxuXHRcdFxyXG5cdH1cclxuXHJcblx0ZHJhdygpe1xyXG5cdFx0Y29uc3Qgb2Zmc2V0MSA9IHRoaXMuc2NhbGVZLmdldFBpeGVsRm9yVmFsdWUoK3RoaXMuZXZhbHVhdG9yLnBhcmFtc1sgMCBdKTtcclxuXHRcdGNvbnN0IG9mZnNldDIgPSB0aGlzLnNjYWxlWS5nZXRQaXhlbEZvclZhbHVlKCt0aGlzLmV2YWx1YXRvci5wYXJhbXNbIDEgXSk7XHJcblxyXG5cdFx0Y29uc3QgdG9wWSA9IHRoaXMuc2NhbGVZLmdldFBpeGVsRm9yVmFsdWUodGhpcy5zY2FsZVkubWF4KTtcclxuXHRcdGNvbnN0IGJvdHRvbVkgPSB0aGlzLnNjYWxlWS5nZXRQaXhlbEZvclZhbHVlKHRoaXMuc2NhbGVZLm1pbik7XHJcblxyXG5cdFx0c3dpdGNoKCArdGhpcy5ldmFsdWF0b3IudHlwZSApe1xyXG5cdFx0XHRjYXNlIEFsZXJ0RXZhbFR5cGUuSXNBYm92ZTpcclxuXHRcdFx0XHRpZiggISggdG9wWSA+IG9mZnNldDEgfHwgYm90dG9tWSA8IG9mZnNldDEgKSApe1xyXG5cdFx0XHRcdFx0dGhpcy5yZW5kZXJMaW5lKCBvZmZzZXQxICk7XHJcblx0XHRcdFx0XHR0aGlzLnJlbmRlclJlY3RhbmdsZSggb2Zmc2V0MSwgdHJ1ZSApO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgQWxlcnRFdmFsVHlwZS5Jc0JlbG93OlxyXG5cdFx0XHRcdGlmKCAhKCB0b3BZID4gb2Zmc2V0MSB8fCBib3R0b21ZIDwgb2Zmc2V0MSApICl7XHJcblx0XHRcdFx0XHR0aGlzLnJlbmRlckxpbmUoIG9mZnNldDEgKTtcclxuXHRcdFx0XHRcdHRoaXMucmVuZGVyUmVjdGFuZ2xlKCBvZmZzZXQxLCBmYWxzZSApO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgQWxlcnRFdmFsVHlwZS5Jc1dpdGhpblJhbmdlOlxyXG5cdFx0XHRcdGlmKCAhKCB0b3BZID4gb2Zmc2V0MSB8fCBib3R0b21ZIDwgb2Zmc2V0MSB8fCB0b3BZID4gb2Zmc2V0MiB8fCBib3R0b21ZIDwgb2Zmc2V0MiApICl7XHJcblx0XHRcdFx0XHR0aGlzLnJlbmRlckxpbmUoIG9mZnNldDEgKTtcclxuXHRcdFx0XHRcdHRoaXMucmVuZGVyTGluZSggb2Zmc2V0MiApO1xyXG5cdFx0XHRcdFx0dGhpcy5yZW5kZXJSZWN0YW5nbGVCZXR3ZWVuKCBvZmZzZXQxLCBvZmZzZXQyICk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0XHRjYXNlIEFsZXJ0RXZhbFR5cGUuSXNPdXRzaWRlUmFuZ2U6XHJcblx0XHRcdFx0XHRpZiggISggdG9wWSA+IG9mZnNldDEgfHwgYm90dG9tWSA8IG9mZnNldDEgfHwgdG9wWSA+IG9mZnNldDIgfHwgYm90dG9tWSA8IG9mZnNldDIgKSApe1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJlbmRlckxpbmUoIG9mZnNldDEgKTtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJMaW5lKCBvZmZzZXQyICk7XHJcblx0XHRcdFx0XHRcdHRoaXMucmVuZGVyUmVjdGFuZ2xlKCBvZmZzZXQxLCBmYWxzZSApO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJlbmRlclJlY3RhbmdsZSggb2Zmc2V0MiwgdHJ1ZSApO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlckxpbmUoIG9mZnNldDogbnVtYmVyICl7XHJcblx0XHR0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XHJcblx0XHRcdHRoaXMuY29udGV4dC5zdHJva2VTdHlsZSA9IEFsZXJ0RHJhd2VyLkxJTkVfQ09MT1I7XHJcblx0XHRcclxuXHRcdHRoaXMuY29udGV4dC5saW5lV2lkdGggPSAyO1xyXG5cdFx0dGhpcy5jb250ZXh0Lm1vdmVUbyggdGhpcy5zY2FsZVgubGVmdCwgb2Zmc2V0KTtcclxuXHRcdHRoaXMuY29udGV4dC5saW5lVG8oIHRoaXMuc2NhbGVYLnJpZ2h0LCBvZmZzZXQpO1xyXG5cdFx0dGhpcy5jb250ZXh0LnN0cm9rZSgpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSByZW5kZXJSZWN0YW5nbGUoIG9mZnNldDogbnVtYmVyLCBndDogYm9vbGVhbiApe1xyXG5cdFx0dGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IEFsZXJ0RHJhd2VyLkZJTExfQ09MT1IgXHJcblxyXG5cdFx0Y29uc3QgeCA9IHRoaXMuc2NhbGVYLmxlZnQ7XHJcblx0XHRjb25zdCB3ID0gdGhpcy5zY2FsZVgud2lkdGg7XHJcblxyXG5cdFx0Y29uc3QgdG9wWSA9IHRoaXMuc2NhbGVZLmdldFBpeGVsRm9yVmFsdWUodGhpcy5zY2FsZVkubWF4KTtcclxuXHRcdGNvbnN0IGJvdHRvbVkgPSB0aGlzLnNjYWxlWS5nZXRQaXhlbEZvclZhbHVlKHRoaXMuc2NhbGVZLm1pbik7XHJcblxyXG5cdFx0Y29uc3QgeSA9IGd0ID8gdG9wWSA6IE1hdGgubWF4KCB0b3BZLCBvZmZzZXQgKTtcclxuXHRcdGxldCBoID0gZ3QgPyBvZmZzZXQgLSB0aGlzLnNjYWxlWS50b3AgOiB0aGlzLnNjYWxlWS5ib3R0b20gLSBvZmZzZXQ7XHJcblxyXG5cdFx0aCA9IE1hdGgubWluKCBib3R0b21ZIC0gdG9wWSwgaCApXHJcblxyXG5cdFx0dGhpcy5jb250ZXh0LmZpbGxSZWN0KCB4LCB5LCB3LCBoICk7XHRcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcmVuZGVyUmVjdGFuZ2xlQmV0d2Vlbiggb2Zmc2V0MSwgb2Zmc2V0MiApe1xyXG5cdFx0dGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IEFsZXJ0RHJhd2VyLkZJTExfQ09MT1I7XHJcblxyXG5cdFx0Y29uc3QgeCA9IHRoaXMuc2NhbGVYLmxlZnQ7XHJcblx0XHRjb25zdCB3ID0gdGhpcy5zY2FsZVgud2lkdGg7XHJcblxyXG5cdFx0dGhpcy5jb250ZXh0LmZpbGxSZWN0KCB4LCBvZmZzZXQxLFx0dywgb2Zmc2V0MiAtIG9mZnNldDEgKTtcdFxyXG5cdH1cclxufSJdfQ==