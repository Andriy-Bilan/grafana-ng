import { Injectable } from '@angular/core';
import { Moment } from 'common';
import { BaseChartExtension } from '../../base/chart-base-extension';
import { AXIS_X, AXIS_Y_LEFT, TimeRegionColor, TimeRegionDay } from '../../chart.m';
import * as i0 from "@angular/core";
import * as i1 from "../../base/chart.store";
export class TimeRegionsDrawerPlugin extends BaseChartExtension {
    constructor(store) {
        super(store);
    }
    afterDatasetsDraw(chart, _) {
        var _a, _b;
        (_b = (_a = this
            .widget) === null || _a === void 0 ? void 0 : _a.display) === null || _b === void 0 ? void 0 : _b.timeRegions.forEach(t => new TimeRegionDrawer(chart, t).draw());
    }
}
TimeRegionsDrawerPlugin.ɵfac = function TimeRegionsDrawerPlugin_Factory(t) { return new (t || TimeRegionsDrawerPlugin)(i0.ɵɵinject(i1.ChartStore)); };
TimeRegionsDrawerPlugin.ɵprov = i0.ɵɵdefineInjectable({ token: TimeRegionsDrawerPlugin, factory: TimeRegionsDrawerPlugin.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(TimeRegionsDrawerPlugin, [{
        type: Injectable
    }], function () { return [{ type: i1.ChartStore }]; }, null); })();
class TimeRegionDrawer {
    constructor(chart, timeRegion) {
        this.chart = chart;
        this.timeRegion = timeRegion;
    }
    get context() {
        return this.chart.chart.ctx;
    }
    draw() {
        const scaleX = this.chart.scales[AXIS_X];
        const minX = Moment.create(scaleX.min);
        const maxX = Moment.create(scaleX.max);
        this
            .getSpans(minX, maxX)
            .forEach(x => {
            let os = scaleX.getPixelForValue(x.start.toDate());
            let oe = scaleX.getPixelForValue(x.end.toDate());
            if (!(oe < scaleX.left || os > scaleX.right)) {
                os = Math.max(os, scaleX.left);
                oe = Math.min(oe, scaleX.right);
                this.renderRegion(os, oe);
            }
        });
    }
    getSpans(min, max) {
        const borders = this.getSpanBorders(min, max);
        const time = this.getTime();
        return this.isSpecificDayOfWeek() ?
            this.getSpansDayOfWeek(borders, time) :
            this.getSpansAny(borders, time);
    }
    getTime() {
        const isSpecificDayOfWeek = this.isSpecificDayOfWeek();
        let inputFromTime = this.timeRegion.fromTime;
        let inputToTime = this.timeRegion.toTime;
        const timeFormat = "HH:mm";
        let tf = Moment.create(inputFromTime, timeFormat);
        let tt = Moment.create(inputToTime, timeFormat);
        if (!tf.isValid() && !tt.isValid()) {
            if (isSpecificDayOfWeek) {
                const midnight = Moment.create("00:00", timeFormat);
                tf = midnight.clone();
                tt = midnight.clone();
            }
        }
        else if (tf.isValid() && !tt.isValid()) {
            tt = tf.clone();
        }
        else if (!tf.isValid() && tt.isValid()) {
            tf = tt.clone();
        }
        return {
            from: (tf.isValid()) ? tf.toDate() : undefined,
            to: (tt.isValid()) ? tt.toDate() : undefined
        };
    }
    getSpansDayOfWeek(borders, time) {
        const max = borders.to;
        const min = borders.from;
        var current = min.clone();
        var res = [];
        var fromDayName = this.timeRegion.fromDay; //TimeRegionDay[  ]
        var toDayName = this.timeRegion.toDay; //TimeRegionDay[  ];
        while (current < max) {
            var start = current.clone().day(fromDayName);
            var end = start.clone().day(toDayName);
            if (end.isBefore(start)) {
                end.add(1, 'weeks');
            }
            start.set({
                'hour': time.from.getHours(),
                'minute': time.from.getMinutes()
            });
            end.set({
                'hour': time.to.getHours(),
                'minute': time.to.getMinutes()
            });
            res.push({ start, end });
            current.add(1, 'weeks');
        }
        return res;
    }
    getSpansAny(borders, time) {
        const max = borders.to;
        const min = borders.from;
        var current = min.clone();
        var res = [];
        if (!time.from && !time.to) {
            return res;
        }
        while (current < max) {
            var start = current.clone().set({
                'hour': time.from.getHours(),
                'minute': time.from.getMinutes()
            });
            var end = current.clone().set({
                'hour': time.to.getHours(),
                'minute': time.to.getMinutes()
            });
            if (end.isBefore(start)) {
                end.add(1, 'days');
            }
            res.push({ start, end });
            current.add(1, 'days');
        }
        return res;
    }
    getSpanBorders(min, max) {
        const margin = this.isSpecificDayOfWeek() ? 8 : 1;
        const from = min
            .clone()
            .subtract(margin, 'days')
            .startOf('day');
        const to = max
            .clone()
            .add(margin, 'days')
            .endOf('day');
        return { from, to };
    }
    isSpecificDayOfWeek() {
        return (this.timeRegion.fromDay != TimeRegionDay.Any) ||
            (this.timeRegion.toDay != TimeRegionDay.Any);
    }
    renderRegion(offsetStart, offsetEnd) {
        const scaleYA = this.chart.scales[AXIS_Y_LEFT];
        const scaleX = this.chart.scales[AXIS_X];
        const minY = scaleYA.top;
        const maxY = scaleYA.bottom;
        if (this.timeRegion.line) {
            if (scaleX.left != offsetStart) {
                this.renderLine(minY, maxY, offsetStart);
            }
            if (scaleX.right != offsetEnd && offsetEnd != offsetStart) {
                this.renderLine(minY, maxY, offsetEnd);
            }
        }
        if (this.timeRegion.fill && offsetEnd != offsetStart) {
            this.renderRectangle(minY, maxY, offsetStart, offsetEnd);
        }
    }
    renderLine(minY, maxY, offset) {
        const color = this.getColor(false);
        this.context.beginPath();
        this.context.strokeStyle = color + "99";
        this.context.lineWidth = 2;
        this.context.moveTo(offset, minY);
        this.context.lineTo(offset, maxY);
        this.context.stroke();
    }
    renderRectangle(minY, maxY, offsetStart, offsetEnd) {
        const color = this.getColor(true);
        this.context.fillStyle = color + "22";
        const x = offsetStart;
        const w = offsetEnd - offsetStart;
        const y = minY;
        const h = maxY - minY;
        this.context.fillRect(x, y, w, h);
    }
    getColor(fill) {
        switch (this.timeRegion.colorType) {
            case TimeRegionColor.Red:
                return '#ED2E18';
            case TimeRegionColor.Green:
                return '#10a345';
            case TimeRegionColor.Blue:
                return '#1f78c1';
            case TimeRegionColor.Yellow:
                return '#f79520';
            case TimeRegionColor.Gray:
                return '#fce2de';
        }
        const defaultColor = '#ffffff';
        if (fill) {
            return this.timeRegion.fillColor ? this.timeRegion.fillColor : defaultColor;
        }
        return this.timeRegion.lineColor ? this.timeRegion.lineColor : defaultColor;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1yZWdpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vYXBwL3BsdWdpbnMvd2lkZ2V0cy9jaGFydC9zcmMvdmlldy9kcmF3ZXJzL3RpbWUtcmVnaW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDaEMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFckUsT0FBTyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQWMsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBSWhHLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxrQkFBa0I7SUFVOUQsWUFBYSxLQUFpQjtRQUM3QixLQUFLLENBQUUsS0FBSyxDQUFFLENBQUM7SUFDaEIsQ0FBQztJQVZELGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFDOztRQUN6QixZQUFBLElBQUk7YUFDRixNQUFNLDBDQUNMLE9BQU8sMENBQ1AsV0FBVyxDQUNaLE9BQU8sQ0FBRSxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksZ0JBQWdCLENBQUUsS0FBSyxFQUFFLENBQUMsQ0FBRSxDQUFDLElBQUksRUFBRSxFQUFHO0lBQzNELENBQUM7OzhGQVJXLHVCQUF1QjsrREFBdkIsdUJBQXVCLFdBQXZCLHVCQUF1QjtrREFBdkIsdUJBQXVCO2NBRG5DLFVBQVU7O0FBZ0JYLE1BQU0sZ0JBQWdCO0lBTXJCLFlBQXFCLEtBQVUsRUFBVSxVQUFzQjtRQUExQyxVQUFLLEdBQUwsS0FBSyxDQUFLO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUUvRCxDQUFDO0lBTkQsSUFBSSxPQUFPO1FBQ1YsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7SUFDN0IsQ0FBQztJQU1E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Z0JBQ3hCLE9BQU8sU0FBUyxDQUFDO1NBQ2xCO1FBRUQsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDO1FBRS9CLElBQUksSUFBSSxFQUFFO1lBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztTQUM1RTtRQUVELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDN0UsQ0FBQztDQUdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb21lbnQgfSBmcm9tICdjb21tb24nO1xyXG5pbXBvcnQgeyBCYXNlQ2hhcnRFeHRlbnNpb24gfSBmcm9tICcuLi8uLi9iYXNlL2NoYXJ0LWJhc2UtZXh0ZW5zaW9uJztcclxuaW1wb3J0IHsgQ2hhcnRTdG9yZSB9IGZyb20gJy4uLy4uL2Jhc2UvY2hhcnQuc3RvcmUnO1xyXG5pbXBvcnQgeyBBWElTX1gsIEFYSVNfWV9MRUZULCBUaW1lUmVnaW9uLCBUaW1lUmVnaW9uQ29sb3IsIFRpbWVSZWdpb25EYXkgfSBmcm9tICcuLi8uLi9jaGFydC5tJztcclxuaW1wb3J0IHsgT3B0aW9uc1Byb3ZpZGVyIH0gZnJvbSAnLi4vb3B0aW9ucy1wcm92aWRlcic7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBUaW1lUmVnaW9uc0RyYXdlclBsdWdpbiBleHRlbmRzIEJhc2VDaGFydEV4dGVuc2lvbiB7XHJcblxyXG5cdGFmdGVyRGF0YXNldHNEcmF3KGNoYXJ0LCBfKSB7XHJcblx0XHR0aGlzXHJcblx0XHRcdC53aWRnZXRcclxuXHRcdFx0Py5kaXNwbGF5XHJcblx0XHRcdD8udGltZVJlZ2lvbnNcclxuXHRcdFx0LmZvckVhY2goIHQgPT4gbmV3IFRpbWVSZWdpb25EcmF3ZXIoIGNoYXJ0LCB0ICkuZHJhdygpICk7XHJcblx0fVxyXG5cclxuXHRjb25zdHJ1Y3Rvciggc3RvcmU6IENoYXJ0U3RvcmUgKXtcclxuXHRcdHN1cGVyKCBzdG9yZSApO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgVGltZVJlZ2lvbkRyYXdlcntcclxuXHJcblx0Z2V0IGNvbnRleHQoKXtcclxuXHRcdHJldHVybiB0aGlzLmNoYXJ0LmNoYXJ0LmN0eDtcclxuXHR9XHJcblxyXG5cdGNvbnN0cnVjdG9yKCBwcml2YXRlIGNoYXJ0OiBhbnksIHByaXZhdGUgdGltZVJlZ2lvbjogVGltZVJlZ2lvbiApe1xyXG5cdFx0XHJcblx0fVxyXG5cdFxyXG5cdGRyYXcoKXtcclxuXHRcdGNvbnN0IHNjYWxlWCA9IHRoaXMuY2hhcnQuc2NhbGVzWyBBWElTX1ggXTtcclxuXHJcblx0XHRjb25zdCBtaW5YID0gTW9tZW50LmNyZWF0ZSggc2NhbGVYLm1pbiApO1xyXG5cdFx0Y29uc3QgbWF4WCA9IE1vbWVudC5jcmVhdGUgKCBzY2FsZVgubWF4ICk7XHJcblxyXG5cdFx0dGhpc1xyXG5cdFx0XHQuZ2V0U3BhbnMoIG1pblgsIG1heFggKVxyXG5cdFx0XHQuZm9yRWFjaCggeCA9PiB7XHJcblx0XHRcdFx0bGV0IG9zID0gc2NhbGVYLmdldFBpeGVsRm9yVmFsdWUoeC5zdGFydC50b0RhdGUoKSk7XHJcblx0XHRcdFx0bGV0IG9lID0gc2NhbGVYLmdldFBpeGVsRm9yVmFsdWUoeC5lbmQudG9EYXRlKCkpO1xyXG5cclxuXHRcdFx0XHRpZighICggb2UgPCAgc2NhbGVYLmxlZnQgfHwgb3MgPiBzY2FsZVgucmlnaHQgKSApe1xyXG5cdFx0XHRcdFx0b3MgPSBNYXRoLm1heCggb3MsIHNjYWxlWC5sZWZ0ICk7XHJcblx0XHRcdFx0XHRvZSA9IE1hdGgubWluKCBvZSwgc2NhbGVYLnJpZ2h0ICk7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5yZW5kZXJSZWdpb24oIG9zLCBvZSApO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSApXHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldFNwYW5zKCBtaW4sIG1heCApe1xyXG5cdFx0Y29uc3QgYm9yZGVycyA9IHRoaXMuZ2V0U3BhbkJvcmRlcnMoIG1pbiwgbWF4ICk7XHJcblx0XHRjb25zdCB0aW1lID0gdGhpcy5nZXRUaW1lKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuaXNTcGVjaWZpY0RheU9mV2VlaygpID8gXHJcblx0XHRcdHRoaXMuZ2V0U3BhbnNEYXlPZldlZWsoIGJvcmRlcnMsIHRpbWUgKSA6IFxyXG5cdFx0XHR0aGlzLmdldFNwYW5zQW55KCBib3JkZXJzLCB0aW1lIClcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2V0VGltZSgpe1xyXG5cdFx0Y29uc3QgaXNTcGVjaWZpY0RheU9mV2VlayA9IHRoaXMuaXNTcGVjaWZpY0RheU9mV2VlaygpO1xyXG5cclxuXHRcdGxldCBpbnB1dEZyb21UaW1lID0gdGhpcy50aW1lUmVnaW9uLmZyb21UaW1lO1xyXG5cdFx0bGV0IGlucHV0VG9UaW1lID0gdGhpcy50aW1lUmVnaW9uLnRvVGltZTtcclxuXHJcblx0XHRjb25zdCB0aW1lRm9ybWF0ID0gXCJISDptbVwiO1xyXG5cclxuXHRcdGxldCB0ZiA9IE1vbWVudC5jcmVhdGUoaW5wdXRGcm9tVGltZSwgdGltZUZvcm1hdCk7XHJcblx0XHRsZXQgdHQgPSBNb21lbnQuY3JlYXRlKGlucHV0VG9UaW1lLCB0aW1lRm9ybWF0KTtcclxuXHJcblx0XHRpZiggIXRmLmlzVmFsaWQoKSAmJiAhdHQuaXNWYWxpZCgpICl7XHJcblx0XHRcdGlmKCBpc1NwZWNpZmljRGF5T2ZXZWVrICl7XHJcblx0XHRcdFx0Y29uc3QgbWlkbmlnaHQgPSBNb21lbnQuY3JlYXRlKCBcIjAwOjAwXCIsIHRpbWVGb3JtYXQgKTtcclxuXHRcdFx0XHR0ZiA9IG1pZG5pZ2h0LmNsb25lKCk7XHJcblx0XHRcdFx0dHQgPSBtaWRuaWdodC5jbG9uZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYoIHRmLmlzVmFsaWQoKSAmJiAhdHQuaXNWYWxpZCgpICl7XHJcblx0XHRcdHR0ID0gdGYuY2xvbmUoKTtcclxuXHRcdH0gZWxzZSBpZiggIXRmLmlzVmFsaWQoKSAmJiB0dC5pc1ZhbGlkKCkgKXtcclxuXHRcdFx0dGYgPSB0dC5jbG9uZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGZyb206ICggdGYuaXNWYWxpZCgpICkgPyB0Zi50b0RhdGUoKSA6IHVuZGVmaW5lZCxcclxuXHRcdFx0dG86ICggdHQuaXNWYWxpZCgpICkgPyB0dC50b0RhdGUoKSA6IHVuZGVmaW5lZFxyXG5cdFx0fVxyXG5cdH1cclxuXHRwcml2YXRlIGdldFNwYW5zRGF5T2ZXZWVrKCBib3JkZXJzLCB0aW1lICl7XHJcblx0XHRjb25zdCBtYXggPSBib3JkZXJzLnRvO1xyXG5cdFx0Y29uc3QgbWluID0gYm9yZGVycy5mcm9tO1xyXG5cclxuXHRcdHZhciBjdXJyZW50ID0gbWluLmNsb25lKCk7XHJcblx0XHR2YXIgcmVzID0gW107XHJcblxyXG5cdFx0dmFyIGZyb21EYXlOYW1lID0gdGhpcy50aW1lUmVnaW9uLmZyb21EYXk7Ly9UaW1lUmVnaW9uRGF5WyAgXVxyXG5cdFx0dmFyIHRvRGF5TmFtZSA9IHRoaXMudGltZVJlZ2lvbi50b0RheTsvL1RpbWVSZWdpb25EYXlbICBdO1xyXG5cdFx0XHJcblx0XHR3aGlsZSggY3VycmVudCA8IG1heCApe1xyXG5cdFx0XHR2YXIgc3RhcnQgPSBjdXJyZW50LmNsb25lKCkuZGF5KCBmcm9tRGF5TmFtZSApO1xyXG5cdFx0XHR2YXIgZW5kID0gc3RhcnQuY2xvbmUoKS5kYXkoIHRvRGF5TmFtZSApO1xyXG5cdFxyXG5cdFx0XHRpZiggZW5kLmlzQmVmb3JlKCBzdGFydCApICl7XHJcblx0XHRcdFx0ZW5kLmFkZCggMSwgJ3dlZWtzJyApXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHN0YXJ0LnNldCh7XHJcblx0XHRcdFx0J2hvdXInIDogdGltZS5mcm9tLmdldEhvdXJzKCksXHJcblx0XHRcdFx0J21pbnV0ZScgIDogdGltZS5mcm9tLmdldE1pbnV0ZXMoKVxyXG5cdFx0XHQgfSk7XHJcblxyXG5cdFx0XHRlbmQuc2V0KHtcclxuXHRcdFx0XHQnaG91cicgOiB0aW1lLnRvLmdldEhvdXJzKCksXHJcblx0XHRcdFx0J21pbnV0ZScgIDogdGltZS50by5nZXRNaW51dGVzKClcclxuXHRcdFx0IH0pO1xyXG5cclxuXHRcdFx0cmVzLnB1c2goIHsgc3RhcnQsIGVuZCB9IClcclxuXHRcclxuXHRcdFx0Y3VycmVudC5hZGQoIDEsICd3ZWVrcycgKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gcmVzO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBnZXRTcGFuc0FueSggYm9yZGVycywgdGltZSApe1xyXG5cdFx0Y29uc3QgbWF4ID0gYm9yZGVycy50bztcclxuXHRcdGNvbnN0IG1pbiA9IGJvcmRlcnMuZnJvbTtcclxuXHJcblx0XHR2YXIgY3VycmVudCA9IG1pbi5jbG9uZSgpO1xyXG5cdFx0dmFyIHJlcyA9IFtdO1xyXG5cclxuXHRcdGlmKCAhdGltZS5mcm9tICYmICF0aW1lLnRvICl7XHJcblx0XHRcdHJldHVybiByZXM7XHJcblx0XHR9XHJcblxyXG5cdFx0d2hpbGUoIGN1cnJlbnQgPCBtYXggKXtcclxuXHRcdFx0dmFyIHN0YXJ0ID0gY3VycmVudC5jbG9uZSgpLnNldCh7XHJcblx0XHRcdFx0J2hvdXInIDogdGltZS5mcm9tLmdldEhvdXJzKCksXHJcblx0XHRcdFx0J21pbnV0ZScgIDogdGltZS5mcm9tLmdldE1pbnV0ZXMoKVxyXG5cdFx0XHQgfSk7XHJcblx0XHJcblx0XHRcdHZhciBlbmQgPSBjdXJyZW50LmNsb25lKCkuc2V0KHtcclxuXHRcdFx0XHQnaG91cicgOiB0aW1lLnRvLmdldEhvdXJzKCksXHJcblx0XHRcdFx0J21pbnV0ZScgIDogdGltZS50by5nZXRNaW51dGVzKClcclxuXHRcdFx0IH0pO1xyXG5cclxuXHRcdFx0aWYoIGVuZC5pc0JlZm9yZSggc3RhcnQgKSApe1xyXG5cdFx0XHRcdGVuZC5hZGQoIDEsICdkYXlzJyApO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZXMucHVzaCggeyBzdGFydCwgZW5kIH0gKVxyXG5cdFxyXG5cdFx0XHRjdXJyZW50LmFkZCggMSwgJ2RheXMnICk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJlcztcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2V0U3BhbkJvcmRlcnMoIG1pbiwgbWF4ICl7XHJcblx0XHRjb25zdCBtYXJnaW4gPSB0aGlzLmlzU3BlY2lmaWNEYXlPZldlZWsoKSA/IDggOiAxO1xyXG5cclxuXHRcdGNvbnN0IGZyb20gPSBtaW5cclxuXHRcdFx0LmNsb25lKClcclxuXHRcdFx0LnN1YnRyYWN0KCBtYXJnaW4sICdkYXlzJyApXHJcblx0XHRcdC5zdGFydE9mKCAnZGF5JyApO1xyXG5cclxuXHRcdGNvbnN0IHRvID0gbWF4XHJcblx0XHRcdC5jbG9uZSgpXHJcblx0XHRcdC5hZGQoIG1hcmdpbiwgJ2RheXMnIClcclxuXHRcdFx0LmVuZE9mKCAnZGF5JyApO1xyXG5cclxuXHRcdHJldHVybiB7IGZyb20sIHRvIH1cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgaXNTcGVjaWZpY0RheU9mV2Vlaygpe1xyXG5cdFx0cmV0dXJuICggdGhpcy50aW1lUmVnaW9uLmZyb21EYXkgIT0gVGltZVJlZ2lvbkRheS5BbnkgKSB8fFxyXG5cdFx0XHQoIHRoaXMudGltZVJlZ2lvbi50b0RheSAhPSBUaW1lUmVnaW9uRGF5LkFueSApO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSByZW5kZXJSZWdpb24oIG9mZnNldFN0YXJ0LCBvZmZzZXRFbmQpe1xyXG5cclxuXHRcdGNvbnN0IHNjYWxlWUEgPSB0aGlzLmNoYXJ0LnNjYWxlc1sgQVhJU19ZX0xFRlQgXTtcclxuXHRcdGNvbnN0IHNjYWxlWCA9IHRoaXMuY2hhcnQuc2NhbGVzWyBBWElTX1ggXTtcclxuXHJcblx0XHRjb25zdCBtaW5ZID0gc2NhbGVZQS50b3A7XHJcblx0XHRjb25zdCBtYXhZID0gc2NhbGVZQS5ib3R0b207XHJcblxyXG5cdFx0aWYoIHRoaXMudGltZVJlZ2lvbi5saW5lICl7XHJcblx0XHRcdGlmKCBzY2FsZVgubGVmdCAhPSBvZmZzZXRTdGFydCApe1xyXG5cdFx0XHRcdHRoaXMucmVuZGVyTGluZSggbWluWSwgbWF4WSwgb2Zmc2V0U3RhcnQgKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0aWYoIHNjYWxlWC5yaWdodCAhPSBvZmZzZXRFbmQgJiYgb2Zmc2V0RW5kICE9IG9mZnNldFN0YXJ0KXtcclxuXHRcdFx0XHR0aGlzLnJlbmRlckxpbmUoIG1pblksIG1heFksIG9mZnNldEVuZCApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYoIHRoaXMudGltZVJlZ2lvbi5maWxsICYmIG9mZnNldEVuZCAhPSBvZmZzZXRTdGFydCAgKXtcclxuXHRcdFx0dGhpcy5yZW5kZXJSZWN0YW5nbGUoIG1pblksIG1heFksIG9mZnNldFN0YXJ0LCBvZmZzZXRFbmQgKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcmVuZGVyTGluZSggbWluWSwgbWF4WSwgb2Zmc2V0ICl7XHJcblx0XHRjb25zdCBjb2xvciA9IHRoaXMuZ2V0Q29sb3IoIGZhbHNlICk7XHJcblxyXG5cdFx0dGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xyXG5cdFx0dGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gY29sb3IgKyBcIjk5XCI7XHJcblx0XHR0aGlzLmNvbnRleHQubGluZVdpZHRoID0gMjtcclxuXHRcdHRoaXMuY29udGV4dC5tb3ZlVG8oIG9mZnNldCwgbWluWSApO1xyXG5cdFx0dGhpcy5jb250ZXh0LmxpbmVUbyggb2Zmc2V0LCBtYXhZICk7XHJcblx0XHR0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlclJlY3RhbmdsZSggbWluWSwgbWF4WSwgb2Zmc2V0U3RhcnQsIG9mZnNldEVuZCAgKXtcclxuXHRcdGNvbnN0IGNvbG9yID0gdGhpcy5nZXRDb2xvciggdHJ1ZSApO1xyXG5cdFx0XHJcblx0XHR0aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gY29sb3IgKyBcIjIyXCJcclxuXHJcblx0XHRjb25zdCB4ID0gb2Zmc2V0U3RhcnQ7XHJcblx0XHRjb25zdCB3ID0gb2Zmc2V0RW5kIC0gb2Zmc2V0U3RhcnQ7XHJcblxyXG5cdFx0Y29uc3QgeSA9IG1pblk7XHJcblx0XHRjb25zdCBoID0gbWF4WSAtIG1pblk7XHJcblxyXG5cdFx0dGhpcy5jb250ZXh0LmZpbGxSZWN0KCB4LCB5LFx0dywgaCApO1x0XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldENvbG9yKCBmaWxsKXtcclxuXHRcdHN3aXRjaCggdGhpcy50aW1lUmVnaW9uLmNvbG9yVHlwZSApe1xyXG5cdFx0XHRjYXNlIFRpbWVSZWdpb25Db2xvci5SZWQ6XHJcblx0XHRcdFx0cmV0dXJuICcjRUQyRTE4JztcclxuXHJcblx0XHRcdGNhc2UgVGltZVJlZ2lvbkNvbG9yLkdyZWVuOlxyXG5cdFx0XHRcdHJldHVybiAnIzEwYTM0NSc7XHJcblxyXG5cdFx0XHRjYXNlIFRpbWVSZWdpb25Db2xvci5CbHVlOlxyXG5cdFx0XHRcdHJldHVybiAnIzFmNzhjMSc7XHJcblxyXG5cdFx0XHRjYXNlIFRpbWVSZWdpb25Db2xvci5ZZWxsb3c6XHJcblx0XHRcdFx0cmV0dXJuICcjZjc5NTIwJztcclxuXHJcblx0XHRcdGNhc2UgVGltZVJlZ2lvbkNvbG9yLkdyYXk6XHJcblx0XHRcdFx0cmV0dXJuICcjZmNlMmRlJztcclxuXHRcdH1cclxuXHJcblx0XHRjb25zdCBkZWZhdWx0Q29sb3IgPSAnI2ZmZmZmZic7XHJcblxyXG5cdFx0aWYoIGZpbGwgKXtcclxuXHRcdFx0cmV0dXJuIHRoaXMudGltZVJlZ2lvbi5maWxsQ29sb3IgPyB0aGlzLnRpbWVSZWdpb24uZmlsbENvbG9yIDogZGVmYXVsdENvbG9yO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0aGlzLnRpbWVSZWdpb24ubGluZUNvbG9yID8gdGhpcy50aW1lUmVnaW9uLmxpbmVDb2xvciA6IGRlZmF1bHRDb2xvcjtcclxuXHR9XHJcblxyXG5cclxufVxyXG4iXX0=