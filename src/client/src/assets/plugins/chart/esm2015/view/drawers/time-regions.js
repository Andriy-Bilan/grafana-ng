import { Injectable } from '@angular/core';
import { Moment } from 'common';
import { BaseChartExtension } from '../../base/chart-base-extension';
import { AXIS_X, AXIS_Y_LEFT, TimeRegionColor, TimeRegionDay } from '../../chart.m';
import * as i0 from "@angular/core";
import * as i1 from "../../base/chart.store";
export class TimeRegionsDrawerPlugin extends BaseChartExtension {
    constructor(store) {
        super(store);
    }
    afterDatasetsDraw(chart, _) {
        var _a, _b;
        (_b = (_a = this
            .widget) === null || _a === void 0 ? void 0 : _a.display) === null || _b === void 0 ? void 0 : _b.timeRegions.forEach(t => new TimeRegionDrawer(chart, t).draw());
    }
}
TimeRegionsDrawerPlugin.ɵfac = function TimeRegionsDrawerPlugin_Factory(t) { return new (t || TimeRegionsDrawerPlugin)(i0.ɵɵinject(i1.ChartStore)); };
TimeRegionsDrawerPlugin.ɵprov = i0.ɵɵdefineInjectable({ token: TimeRegionsDrawerPlugin, factory: TimeRegionsDrawerPlugin.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(TimeRegionsDrawerPlugin, [{
        type: Injectable
    }], function () { return [{ type: i1.ChartStore }]; }, null); })();
class TimeRegionDrawer {
    constructor(chart, timeRegion) {
        this.chart = chart;
        this.timeRegion = timeRegion;
    }
    get context() {
        return this.chart.chart.ctx;
    }
    draw() {
        const scaleX = this.chart.scales[AXIS_X];
        const minX = Moment.create(scaleX.min);
        const maxX = Moment.create(scaleX.max);
        this
            .getSpans(minX, maxX)
            .forEach(x => {
            let os = scaleX.getPixelForValue(x.start.toDate());
            let oe = scaleX.getPixelForValue(x.end.toDate());
            if (!(oe < scaleX.left || os > scaleX.right)) {
                os = Math.max(os, scaleX.left);
                oe = Math.min(oe, scaleX.right);
                this.renderRegion(os, oe);
            }
        });
    }
    getSpans(min, max) {
        const borders = this.getSpanBorders(min, max);
        const time = this.getTime();
        return this.isSpecificDayOfWeek() ?
            this.getSpansDayOfWeek(borders, time) :
            this.getSpansAny(borders, time);
    }
    getTime() {
        const isSpecificDayOfWeek = this.isSpecificDayOfWeek();
        let inputFromTime = this.timeRegion.fromTime;
        let inputToTime = this.timeRegion.toTime;
        const timeFormat = "HH:mm";
        let tf = Moment.create(inputFromTime, timeFormat);
        let tt = Moment.create(inputToTime, timeFormat);
        if (!tf.isValid() && !tt.isValid()) {
            if (isSpecificDayOfWeek) {
                const midnight = Moment.create("00:00", timeFormat);
                tf = midnight.clone();
                tt = midnight.clone();
            }
        }
        else if (tf.isValid() && !tt.isValid()) {
            tt = tf.clone();
        }
        else if (!tf.isValid() && tt.isValid()) {
            tf = tt.clone();
        }
        return {
            from: (tf.isValid()) ? tf.toDate() : undefined,
            to: (tt.isValid()) ? tt.toDate() : undefined
        };
    }
    getSpansDayOfWeek(borders, time) {
        const max = borders.to;
        const min = borders.from;
        var current = min.clone();
        var res = [];
        var fromDayName = this.timeRegion.fromDay; //TimeRegionDay[  ]
        var toDayName = this.timeRegion.toDay; //TimeRegionDay[  ];
        while (current < max) {
            var start = current.clone().day(fromDayName);
            var end = start.clone().day(toDayName);
            if (end.isBefore(start)) {
                end.add(1, 'weeks');
            }
            start.set({
                'hour': time.from.getHours(),
                'minute': time.from.getMinutes()
            });
            end.set({
                'hour': time.to.getHours(),
                'minute': time.to.getMinutes()
            });
            res.push({ start, end });
            current.add(1, 'weeks');
        }
        return res;
    }
    getSpansAny(borders, time) {
        const max = borders.to;
        const min = borders.from;
        var current = min.clone();
        var res = [];
        if (!time.from && !time.to) {
            return res;
        }
        while (current < max) {
            var start = current.clone().set({
                'hour': time.from.getHours(),
                'minute': time.from.getMinutes()
            });
            var end = current.clone().set({
                'hour': time.to.getHours(),
                'minute': time.to.getMinutes()
            });
            if (end.isBefore(start)) {
                end.add(1, 'days');
            }
            res.push({ start, end });
            current.add(1, 'days');
        }
        return res;
    }
    getSpanBorders(min, max) {
        const margin = this.isSpecificDayOfWeek() ? 8 : 1;
        const from = min
            .clone()
            .subtract(margin, 'days')
            .startOf('day');
        const to = max
            .clone()
            .add(margin, 'days')
            .endOf('day');
        return { from, to };
    }
    isSpecificDayOfWeek() {
        return (this.timeRegion.fromDay != TimeRegionDay.Any) ||
            (this.timeRegion.toDay != TimeRegionDay.Any);
    }
    renderRegion(offsetStart, offsetEnd) {
        const scaleYA = this.chart.scales[AXIS_Y_LEFT];
        const scaleX = this.chart.scales[AXIS_X];
        const minY = scaleYA.top;
        const maxY = scaleYA.bottom;
        if (this.timeRegion.line) {
            if (scaleX.left != offsetStart) {
                this.renderLine(minY, maxY, offsetStart);
            }
            if (scaleX.right != offsetEnd && offsetEnd != offsetStart) {
                this.renderLine(minY, maxY, offsetEnd);
            }
        }
        if (this.timeRegion.fill && offsetEnd != offsetStart) {
            this.renderRectangle(minY, maxY, offsetStart, offsetEnd);
        }
    }
    renderLine(minY, maxY, offset) {
        const color = this.getColor(false);
        this.context.beginPath();
        this.context.strokeStyle = color + "99";
        this.context.lineWidth = 2;
        this.context.moveTo(offset, minY);
        this.context.lineTo(offset, maxY);
        this.context.stroke();
    }
    renderRectangle(minY, maxY, offsetStart, offsetEnd) {
        const color = this.getColor(true);
        this.context.fillStyle = color + "22";
        const x = offsetStart;
        const w = offsetEnd - offsetStart;
        const y = minY;
        const h = maxY - minY;
        this.context.fillRect(x, y, w, h);
    }
    getColor(fill) {
        switch (this.timeRegion.colorType) {
            case TimeRegionColor.Red:
                return '#ED2E18';
            case TimeRegionColor.Green:
                return '#10a345';
            case TimeRegionColor.Blue:
                return '#1f78c1';
            case TimeRegionColor.Yellow:
                return '#f79520';
            case TimeRegionColor.Gray:
                return '#fce2de';
        }
        const defaultColor = '#ffffff';
        if (fill) {
            return this.timeRegion.fillColor ? this.timeRegion.fillColor : defaultColor;
        }
        return this.timeRegion.lineColor ? this.timeRegion.lineColor : defaultColor;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1yZWdpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vYXBwL3BsdWdpbnMvd2lkZ2V0cy9jaGFydC9zcmMvdmlldy9kcmF3ZXJzL3RpbWUtcmVnaW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDaEMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFckUsT0FBTyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQWMsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBR2hHLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxrQkFBa0I7SUFFOUQsWUFBYSxLQUFpQjtRQUM3QixLQUFLLENBQUUsS0FBSyxDQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVELGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFDOztRQUN6QixZQUFBLElBQUk7YUFDRixNQUFNLDBDQUNMLE9BQU8sMENBQ1AsV0FBVyxDQUNaLE9BQU8sQ0FBRSxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksZ0JBQWdCLENBQUUsS0FBSyxFQUFFLENBQUMsQ0FBRSxDQUFDLElBQUksRUFBRSxFQUFHO0lBQzNELENBQUM7OzhGQVpXLHVCQUF1QjsrREFBdkIsdUJBQXVCLFdBQXZCLHVCQUF1QjtrREFBdkIsdUJBQXVCO2NBRG5DLFVBQVU7O0FBZ0JYLE1BQU0sZ0JBQWdCO0lBTXJCLFlBQXFCLEtBQVUsRUFBVSxVQUFzQjtRQUExQyxVQUFLLEdBQUwsS0FBSyxDQUFLO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUUvRCxDQUFDO0lBTkQsSUFBSSxPQUFPO1FBQ1YsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7SUFDN0IsQ0FBQztJQU1E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Z0JBQ3hCLE9BQU8sU0FBUyxDQUFDO1NBQ2xCO1FBRUQsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDO1FBRS9CLElBQUksSUFBSSxFQUFFO1lBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztTQUM1RTtRQUVELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDN0UsQ0FBQztDQUdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb21lbnQgfSBmcm9tICdjb21tb24nO1xyXG5pbXBvcnQgeyBCYXNlQ2hhcnRFeHRlbnNpb24gfSBmcm9tICcuLi8uLi9iYXNlL2NoYXJ0LWJhc2UtZXh0ZW5zaW9uJztcclxuaW1wb3J0IHsgQ2hhcnRTdG9yZSB9IGZyb20gJy4uLy4uL2Jhc2UvY2hhcnQuc3RvcmUnO1xyXG5pbXBvcnQgeyBBWElTX1gsIEFYSVNfWV9MRUZULCBUaW1lUmVnaW9uLCBUaW1lUmVnaW9uQ29sb3IsIFRpbWVSZWdpb25EYXkgfSBmcm9tICcuLi8uLi9jaGFydC5tJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRpbWVSZWdpb25zRHJhd2VyUGx1Z2luIGV4dGVuZHMgQmFzZUNoYXJ0RXh0ZW5zaW9uIHtcclxuXHRcclxuXHRjb25zdHJ1Y3Rvciggc3RvcmU6IENoYXJ0U3RvcmUgKXtcclxuXHRcdHN1cGVyKCBzdG9yZSApO1xyXG5cdH1cclxuXHJcblx0YWZ0ZXJEYXRhc2V0c0RyYXcoY2hhcnQsIF8pIHtcclxuXHRcdHRoaXNcclxuXHRcdFx0LndpZGdldFxyXG5cdFx0XHQ/LmRpc3BsYXlcclxuXHRcdFx0Py50aW1lUmVnaW9uc1xyXG5cdFx0XHQuZm9yRWFjaCggdCA9PiBuZXcgVGltZVJlZ2lvbkRyYXdlciggY2hhcnQsIHQgKS5kcmF3KCkgKTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFRpbWVSZWdpb25EcmF3ZXJ7XHJcblxyXG5cdGdldCBjb250ZXh0KCl7XHJcblx0XHRyZXR1cm4gdGhpcy5jaGFydC5jaGFydC5jdHg7XHJcblx0fVxyXG5cclxuXHRjb25zdHJ1Y3RvciggcHJpdmF0ZSBjaGFydDogYW55LCBwcml2YXRlIHRpbWVSZWdpb246IFRpbWVSZWdpb24gKXtcclxuXHRcdFxyXG5cdH1cclxuXHRcclxuXHRkcmF3KCl7XHJcblx0XHRjb25zdCBzY2FsZVggPSB0aGlzLmNoYXJ0LnNjYWxlc1sgQVhJU19YIF07XHJcblxyXG5cdFx0Y29uc3QgbWluWCA9IE1vbWVudC5jcmVhdGUoIHNjYWxlWC5taW4gKTtcclxuXHRcdGNvbnN0IG1heFggPSBNb21lbnQuY3JlYXRlICggc2NhbGVYLm1heCApO1xyXG5cclxuXHRcdHRoaXNcclxuXHRcdFx0LmdldFNwYW5zKCBtaW5YLCBtYXhYIClcclxuXHRcdFx0LmZvckVhY2goIHggPT4ge1xyXG5cdFx0XHRcdGxldCBvcyA9IHNjYWxlWC5nZXRQaXhlbEZvclZhbHVlKHguc3RhcnQudG9EYXRlKCkpO1xyXG5cdFx0XHRcdGxldCBvZSA9IHNjYWxlWC5nZXRQaXhlbEZvclZhbHVlKHguZW5kLnRvRGF0ZSgpKTtcclxuXHJcblx0XHRcdFx0aWYoISAoIG9lIDwgIHNjYWxlWC5sZWZ0IHx8IG9zID4gc2NhbGVYLnJpZ2h0ICkgKXtcclxuXHRcdFx0XHRcdG9zID0gTWF0aC5tYXgoIG9zLCBzY2FsZVgubGVmdCApO1xyXG5cdFx0XHRcdFx0b2UgPSBNYXRoLm1pbiggb2UsIHNjYWxlWC5yaWdodCApO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMucmVuZGVyUmVnaW9uKCBvcywgb2UgKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gKVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBnZXRTcGFucyggbWluLCBtYXggKXtcclxuXHRcdGNvbnN0IGJvcmRlcnMgPSB0aGlzLmdldFNwYW5Cb3JkZXJzKCBtaW4sIG1heCApO1xyXG5cdFx0Y29uc3QgdGltZSA9IHRoaXMuZ2V0VGltZSgpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLmlzU3BlY2lmaWNEYXlPZldlZWsoKSA/IFxyXG5cdFx0XHR0aGlzLmdldFNwYW5zRGF5T2ZXZWVrKCBib3JkZXJzLCB0aW1lICkgOiBcclxuXHRcdFx0dGhpcy5nZXRTcGFuc0FueSggYm9yZGVycywgdGltZSApXHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldFRpbWUoKXtcclxuXHRcdGNvbnN0IGlzU3BlY2lmaWNEYXlPZldlZWsgPSB0aGlzLmlzU3BlY2lmaWNEYXlPZldlZWsoKTtcclxuXHJcblx0XHRsZXQgaW5wdXRGcm9tVGltZSA9IHRoaXMudGltZVJlZ2lvbi5mcm9tVGltZTtcclxuXHRcdGxldCBpbnB1dFRvVGltZSA9IHRoaXMudGltZVJlZ2lvbi50b1RpbWU7XHJcblxyXG5cdFx0Y29uc3QgdGltZUZvcm1hdCA9IFwiSEg6bW1cIjtcclxuXHJcblx0XHRsZXQgdGYgPSBNb21lbnQuY3JlYXRlKGlucHV0RnJvbVRpbWUsIHRpbWVGb3JtYXQpO1xyXG5cdFx0bGV0IHR0ID0gTW9tZW50LmNyZWF0ZShpbnB1dFRvVGltZSwgdGltZUZvcm1hdCk7XHJcblxyXG5cdFx0aWYoICF0Zi5pc1ZhbGlkKCkgJiYgIXR0LmlzVmFsaWQoKSApe1xyXG5cdFx0XHRpZiggaXNTcGVjaWZpY0RheU9mV2VlayApe1xyXG5cdFx0XHRcdGNvbnN0IG1pZG5pZ2h0ID0gTW9tZW50LmNyZWF0ZSggXCIwMDowMFwiLCB0aW1lRm9ybWF0ICk7XHJcblx0XHRcdFx0dGYgPSBtaWRuaWdodC5jbG9uZSgpO1xyXG5cdFx0XHRcdHR0ID0gbWlkbmlnaHQuY2xvbmUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIGlmKCB0Zi5pc1ZhbGlkKCkgJiYgIXR0LmlzVmFsaWQoKSApe1xyXG5cdFx0XHR0dCA9IHRmLmNsb25lKCk7XHJcblx0XHR9IGVsc2UgaWYoICF0Zi5pc1ZhbGlkKCkgJiYgdHQuaXNWYWxpZCgpICl7XHJcblx0XHRcdHRmID0gdHQuY2xvbmUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRmcm9tOiAoIHRmLmlzVmFsaWQoKSApID8gdGYudG9EYXRlKCkgOiB1bmRlZmluZWQsXHJcblx0XHRcdHRvOiAoIHR0LmlzVmFsaWQoKSApID8gdHQudG9EYXRlKCkgOiB1bmRlZmluZWRcclxuXHRcdH1cclxuXHR9XHJcblx0cHJpdmF0ZSBnZXRTcGFuc0RheU9mV2VlayggYm9yZGVycywgdGltZSApe1xyXG5cdFx0Y29uc3QgbWF4ID0gYm9yZGVycy50bztcclxuXHRcdGNvbnN0IG1pbiA9IGJvcmRlcnMuZnJvbTtcclxuXHJcblx0XHR2YXIgY3VycmVudCA9IG1pbi5jbG9uZSgpO1xyXG5cdFx0dmFyIHJlcyA9IFtdO1xyXG5cclxuXHRcdHZhciBmcm9tRGF5TmFtZSA9IHRoaXMudGltZVJlZ2lvbi5mcm9tRGF5Oy8vVGltZVJlZ2lvbkRheVsgIF1cclxuXHRcdHZhciB0b0RheU5hbWUgPSB0aGlzLnRpbWVSZWdpb24udG9EYXk7Ly9UaW1lUmVnaW9uRGF5WyAgXTtcclxuXHRcdFxyXG5cdFx0d2hpbGUoIGN1cnJlbnQgPCBtYXggKXtcclxuXHRcdFx0dmFyIHN0YXJ0ID0gY3VycmVudC5jbG9uZSgpLmRheSggZnJvbURheU5hbWUgKTtcclxuXHRcdFx0dmFyIGVuZCA9IHN0YXJ0LmNsb25lKCkuZGF5KCB0b0RheU5hbWUgKTtcclxuXHRcclxuXHRcdFx0aWYoIGVuZC5pc0JlZm9yZSggc3RhcnQgKSApe1xyXG5cdFx0XHRcdGVuZC5hZGQoIDEsICd3ZWVrcycgKVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzdGFydC5zZXQoe1xyXG5cdFx0XHRcdCdob3VyJyA6IHRpbWUuZnJvbS5nZXRIb3VycygpLFxyXG5cdFx0XHRcdCdtaW51dGUnICA6IHRpbWUuZnJvbS5nZXRNaW51dGVzKClcclxuXHRcdFx0IH0pO1xyXG5cclxuXHRcdFx0ZW5kLnNldCh7XHJcblx0XHRcdFx0J2hvdXInIDogdGltZS50by5nZXRIb3VycygpLFxyXG5cdFx0XHRcdCdtaW51dGUnICA6IHRpbWUudG8uZ2V0TWludXRlcygpXHJcblx0XHRcdCB9KTtcclxuXHJcblx0XHRcdHJlcy5wdXNoKCB7IHN0YXJ0LCBlbmQgfSApXHJcblx0XHJcblx0XHRcdGN1cnJlbnQuYWRkKCAxLCAnd2Vla3MnICk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJlcztcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2V0U3BhbnNBbnkoIGJvcmRlcnMsIHRpbWUgKXtcclxuXHRcdGNvbnN0IG1heCA9IGJvcmRlcnMudG87XHJcblx0XHRjb25zdCBtaW4gPSBib3JkZXJzLmZyb207XHJcblxyXG5cdFx0dmFyIGN1cnJlbnQgPSBtaW4uY2xvbmUoKTtcclxuXHRcdHZhciByZXMgPSBbXTtcclxuXHJcblx0XHRpZiggIXRpbWUuZnJvbSAmJiAhdGltZS50byApe1xyXG5cdFx0XHRyZXR1cm4gcmVzO1xyXG5cdFx0fVxyXG5cclxuXHRcdHdoaWxlKCBjdXJyZW50IDwgbWF4ICl7XHJcblx0XHRcdHZhciBzdGFydCA9IGN1cnJlbnQuY2xvbmUoKS5zZXQoe1xyXG5cdFx0XHRcdCdob3VyJyA6IHRpbWUuZnJvbS5nZXRIb3VycygpLFxyXG5cdFx0XHRcdCdtaW51dGUnICA6IHRpbWUuZnJvbS5nZXRNaW51dGVzKClcclxuXHRcdFx0IH0pO1xyXG5cdFxyXG5cdFx0XHR2YXIgZW5kID0gY3VycmVudC5jbG9uZSgpLnNldCh7XHJcblx0XHRcdFx0J2hvdXInIDogdGltZS50by5nZXRIb3VycygpLFxyXG5cdFx0XHRcdCdtaW51dGUnICA6IHRpbWUudG8uZ2V0TWludXRlcygpXHJcblx0XHRcdCB9KTtcclxuXHJcblx0XHRcdGlmKCBlbmQuaXNCZWZvcmUoIHN0YXJ0ICkgKXtcclxuXHRcdFx0XHRlbmQuYWRkKCAxLCAnZGF5cycgKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmVzLnB1c2goIHsgc3RhcnQsIGVuZCB9IClcclxuXHRcclxuXHRcdFx0Y3VycmVudC5hZGQoIDEsICdkYXlzJyApO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiByZXM7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldFNwYW5Cb3JkZXJzKCBtaW4sIG1heCApe1xyXG5cdFx0Y29uc3QgbWFyZ2luID0gdGhpcy5pc1NwZWNpZmljRGF5T2ZXZWVrKCkgPyA4IDogMTtcclxuXHJcblx0XHRjb25zdCBmcm9tID0gbWluXHJcblx0XHRcdC5jbG9uZSgpXHJcblx0XHRcdC5zdWJ0cmFjdCggbWFyZ2luLCAnZGF5cycgKVxyXG5cdFx0XHQuc3RhcnRPZiggJ2RheScgKTtcclxuXHJcblx0XHRjb25zdCB0byA9IG1heFxyXG5cdFx0XHQuY2xvbmUoKVxyXG5cdFx0XHQuYWRkKCBtYXJnaW4sICdkYXlzJyApXHJcblx0XHRcdC5lbmRPZiggJ2RheScgKTtcclxuXHJcblx0XHRyZXR1cm4geyBmcm9tLCB0byB9XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGlzU3BlY2lmaWNEYXlPZldlZWsoKXtcclxuXHRcdHJldHVybiAoIHRoaXMudGltZVJlZ2lvbi5mcm9tRGF5ICE9IFRpbWVSZWdpb25EYXkuQW55ICkgfHxcclxuXHRcdFx0KCB0aGlzLnRpbWVSZWdpb24udG9EYXkgIT0gVGltZVJlZ2lvbkRheS5BbnkgKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcmVuZGVyUmVnaW9uKCBvZmZzZXRTdGFydCwgb2Zmc2V0RW5kKXtcclxuXHJcblx0XHRjb25zdCBzY2FsZVlBID0gdGhpcy5jaGFydC5zY2FsZXNbIEFYSVNfWV9MRUZUIF07XHJcblx0XHRjb25zdCBzY2FsZVggPSB0aGlzLmNoYXJ0LnNjYWxlc1sgQVhJU19YIF07XHJcblxyXG5cdFx0Y29uc3QgbWluWSA9IHNjYWxlWUEudG9wO1xyXG5cdFx0Y29uc3QgbWF4WSA9IHNjYWxlWUEuYm90dG9tO1xyXG5cclxuXHRcdGlmKCB0aGlzLnRpbWVSZWdpb24ubGluZSApe1xyXG5cdFx0XHRpZiggc2NhbGVYLmxlZnQgIT0gb2Zmc2V0U3RhcnQgKXtcclxuXHRcdFx0XHR0aGlzLnJlbmRlckxpbmUoIG1pblksIG1heFksIG9mZnNldFN0YXJ0ICk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdGlmKCBzY2FsZVgucmlnaHQgIT0gb2Zmc2V0RW5kICYmIG9mZnNldEVuZCAhPSBvZmZzZXRTdGFydCl7XHJcblx0XHRcdFx0dGhpcy5yZW5kZXJMaW5lKCBtaW5ZLCBtYXhZLCBvZmZzZXRFbmQgKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmKCB0aGlzLnRpbWVSZWdpb24uZmlsbCAmJiBvZmZzZXRFbmQgIT0gb2Zmc2V0U3RhcnQgICl7XHJcblx0XHRcdHRoaXMucmVuZGVyUmVjdGFuZ2xlKCBtaW5ZLCBtYXhZLCBvZmZzZXRTdGFydCwgb2Zmc2V0RW5kICk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlckxpbmUoIG1pblksIG1heFksIG9mZnNldCApe1xyXG5cdFx0Y29uc3QgY29sb3IgPSB0aGlzLmdldENvbG9yKCBmYWxzZSApO1xyXG5cclxuXHRcdHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcclxuXHRcdHRoaXMuY29udGV4dC5zdHJva2VTdHlsZSA9IGNvbG9yICsgXCI5OVwiO1xyXG5cdFx0dGhpcy5jb250ZXh0LmxpbmVXaWR0aCA9IDI7XHJcblx0XHR0aGlzLmNvbnRleHQubW92ZVRvKCBvZmZzZXQsIG1pblkgKTtcclxuXHRcdHRoaXMuY29udGV4dC5saW5lVG8oIG9mZnNldCwgbWF4WSApO1xyXG5cdFx0dGhpcy5jb250ZXh0LnN0cm9rZSgpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSByZW5kZXJSZWN0YW5nbGUoIG1pblksIG1heFksIG9mZnNldFN0YXJ0LCBvZmZzZXRFbmQgICl7XHJcblx0XHRjb25zdCBjb2xvciA9IHRoaXMuZ2V0Q29sb3IoIHRydWUgKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IGNvbG9yICsgXCIyMlwiXHJcblxyXG5cdFx0Y29uc3QgeCA9IG9mZnNldFN0YXJ0O1xyXG5cdFx0Y29uc3QgdyA9IG9mZnNldEVuZCAtIG9mZnNldFN0YXJ0O1xyXG5cclxuXHRcdGNvbnN0IHkgPSBtaW5ZO1xyXG5cdFx0Y29uc3QgaCA9IG1heFkgLSBtaW5ZO1xyXG5cclxuXHRcdHRoaXMuY29udGV4dC5maWxsUmVjdCggeCwgeSxcdHcsIGggKTtcdFxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBnZXRDb2xvciggZmlsbCl7XHJcblx0XHRzd2l0Y2goIHRoaXMudGltZVJlZ2lvbi5jb2xvclR5cGUgKXtcclxuXHRcdFx0Y2FzZSBUaW1lUmVnaW9uQ29sb3IuUmVkOlxyXG5cdFx0XHRcdHJldHVybiAnI0VEMkUxOCc7XHJcblxyXG5cdFx0XHRjYXNlIFRpbWVSZWdpb25Db2xvci5HcmVlbjpcclxuXHRcdFx0XHRyZXR1cm4gJyMxMGEzNDUnO1xyXG5cclxuXHRcdFx0Y2FzZSBUaW1lUmVnaW9uQ29sb3IuQmx1ZTpcclxuXHRcdFx0XHRyZXR1cm4gJyMxZjc4YzEnO1xyXG5cclxuXHRcdFx0Y2FzZSBUaW1lUmVnaW9uQ29sb3IuWWVsbG93OlxyXG5cdFx0XHRcdHJldHVybiAnI2Y3OTUyMCc7XHJcblxyXG5cdFx0XHRjYXNlIFRpbWVSZWdpb25Db2xvci5HcmF5OlxyXG5cdFx0XHRcdHJldHVybiAnI2ZjZTJkZSc7XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgZGVmYXVsdENvbG9yID0gJyNmZmZmZmYnO1xyXG5cclxuXHRcdGlmKCBmaWxsICl7XHJcblx0XHRcdHJldHVybiB0aGlzLnRpbWVSZWdpb24uZmlsbENvbG9yID8gdGhpcy50aW1lUmVnaW9uLmZpbGxDb2xvciA6IGRlZmF1bHRDb2xvcjtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gdGhpcy50aW1lUmVnaW9uLmxpbmVDb2xvciA/IHRoaXMudGltZVJlZ2lvbi5saW5lQ29sb3IgOiBkZWZhdWx0Q29sb3I7XHJcblx0fVxyXG5cclxuXHJcbn1cclxuIl19