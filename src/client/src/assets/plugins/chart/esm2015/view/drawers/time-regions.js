import { Injectable } from '@angular/core';
import { Moment } from 'common';
import { BaseDrawer, ChartJsExtension } from '../../base/chart-base-extension';
import { AXIS_X, AXIS_Y_LEFT, TimeRegionColor, TimeRegionDay } from '../../chart.m';
import * as i0 from "@angular/core";
import * as i1 from "../../base/chart.store";
export class TimeRegionsDrawerPlugin extends ChartJsExtension {
    constructor(store) {
        super(store);
    }
    afterDatasetsDraw(chart, _) {
        var _a, _b, _c;
        (_c = (_b = (_a = this
            .widget) === null || _a === void 0 ? void 0 : _a.display) === null || _b === void 0 ? void 0 : _b.timeRegions) === null || _c === void 0 ? void 0 : _c.forEach(t => new TimeRegionDrawer(chart, t).draw());
    }
}
TimeRegionsDrawerPlugin.ɵfac = function TimeRegionsDrawerPlugin_Factory(t) { return new (t || TimeRegionsDrawerPlugin)(i0.ɵɵinject(i1.ChartStore)); };
TimeRegionsDrawerPlugin.ɵprov = i0.ɵɵdefineInjectable({ token: TimeRegionsDrawerPlugin, factory: TimeRegionsDrawerPlugin.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(TimeRegionsDrawerPlugin, [{
        type: Injectable
    }], function () { return [{ type: i1.ChartStore }]; }, null); })();
class TimeRegionDrawer extends BaseDrawer {
    constructor(chart, timeRegion) {
        super(chart);
        this.timeRegion = timeRegion;
    }
    draw() {
        const scaleX = this.chart.scales[AXIS_X];
        const minX = Moment.create(scaleX.min);
        const maxX = Moment.create(scaleX.max);
        this
            .getSpans(minX, maxX)
            .forEach(x => {
            let os = scaleX.getPixelForValue(x.start.toDate());
            let oe = scaleX.getPixelForValue(x.end.toDate());
            if (!(oe < scaleX.left || os > scaleX.right)) {
                os = Math.max(os, scaleX.left);
                oe = Math.min(oe, scaleX.right);
                this.renderRegion(os, oe);
            }
        });
    }
    getSpans(min, max) {
        const borders = this.getSpanBorders(min, max);
        const time = this.getTime();
        return this.isSpecificDayOfWeek() ?
            this.getSpansDayOfWeek(borders, time) :
            this.getSpansAny(borders, time);
    }
    getTime() {
        const isSpecificDayOfWeek = this.isSpecificDayOfWeek();
        let inputFromTime = this.timeRegion.fromTime;
        let inputToTime = this.timeRegion.toTime;
        const timeFormat = "HH:mm";
        let tf = Moment.create(inputFromTime, timeFormat);
        let tt = Moment.create(inputToTime, timeFormat);
        if (!tf.isValid() && !tt.isValid()) {
            if (isSpecificDayOfWeek) {
                const midnight = Moment.create("00:00", timeFormat);
                tf = midnight.clone();
                tt = midnight.clone();
            }
        }
        else if (tf.isValid() && !tt.isValid()) {
            tt = tf.clone();
        }
        else if (!tf.isValid() && tt.isValid()) {
            tf = tt.clone();
        }
        return {
            from: (tf.isValid()) ? tf.toDate() : undefined,
            to: (tt.isValid()) ? tt.toDate() : undefined
        };
    }
    getSpansDayOfWeek(borders, time) {
        const max = borders.to;
        const min = borders.from;
        var current = min.clone();
        var res = [];
        var fromDayName = this.timeRegion.fromDay; //TimeRegionDay[  ]
        var toDayName = this.timeRegion.toDay; //TimeRegionDay[  ];
        while (current < max) {
            var start = current.clone().day(fromDayName);
            var end = start.clone().day(toDayName);
            if (end.isBefore(start)) {
                end.add(1, 'weeks');
            }
            start.set({
                'hour': time.from.getHours(),
                'minute': time.from.getMinutes()
            });
            end.set({
                'hour': time.to.getHours(),
                'minute': time.to.getMinutes()
            });
            res.push({ start, end });
            current.add(1, 'weeks');
        }
        return res;
    }
    getSpansAny(borders, time) {
        const max = borders.to;
        const min = borders.from;
        var current = min.clone();
        var res = [];
        if (!time.from && !time.to) {
            return res;
        }
        while (current < max) {
            var start = current.clone().set({
                'hour': time.from.getHours(),
                'minute': time.from.getMinutes()
            });
            var end = current.clone().set({
                'hour': time.to.getHours(),
                'minute': time.to.getMinutes()
            });
            if (end.isBefore(start)) {
                end.add(1, 'days');
            }
            res.push({ start, end });
            current.add(1, 'days');
        }
        return res;
    }
    getSpanBorders(min, max) {
        const margin = this.isSpecificDayOfWeek() ? 8 : 1;
        const from = min
            .clone()
            .subtract(margin, 'days')
            .startOf('day');
        const to = max
            .clone()
            .add(margin, 'days')
            .endOf('day');
        return { from, to };
    }
    isSpecificDayOfWeek() {
        return (this.timeRegion.fromDay != TimeRegionDay.Any) ||
            (this.timeRegion.toDay != TimeRegionDay.Any);
    }
    renderRegion(offsetStart, offsetEnd) {
        const scaleYA = this.chart.scales[AXIS_Y_LEFT];
        const scaleX = this.chart.scales[AXIS_X];
        const minY = scaleYA.top;
        const maxY = scaleYA.bottom;
        if (this.timeRegion.line) {
            if (scaleX.left != offsetStart) {
                this.renderLine(minY, maxY, offsetStart);
            }
            if (scaleX.right != offsetEnd && offsetEnd != offsetStart) {
                this.renderLine(minY, maxY, offsetEnd);
            }
        }
        if (this.timeRegion.fill && offsetEnd != offsetStart) {
            this.renderRectangle(minY, maxY, offsetStart, offsetEnd);
        }
    }
    renderLine(minY, maxY, offset) {
        const color = this.getColor(false);
        this.context.beginPath();
        this.context.strokeStyle = color + "99";
        this.context.lineWidth = 2;
        this.context.moveTo(offset, minY);
        this.context.lineTo(offset, maxY);
        this.context.stroke();
    }
    renderRectangle(minY, maxY, offsetStart, offsetEnd) {
        const color = this.getColor(true);
        this.context.fillStyle = color + "22";
        const x = offsetStart;
        const w = offsetEnd - offsetStart;
        const y = minY;
        const h = maxY - minY;
        this.context.fillRect(x, y, w, h);
    }
    getColor(fill) {
        switch (this.timeRegion.colorType) {
            case TimeRegionColor.Red:
                return '#ED2E18';
            case TimeRegionColor.Green:
                return '#10a345';
            case TimeRegionColor.Blue:
                return '#1f78c1';
            case TimeRegionColor.Yellow:
                return '#f79520';
            case TimeRegionColor.Gray:
                return '#fce2de';
        }
        const defaultColor = '#ffffff';
        if (fill) {
            return this.timeRegion.fillColor ? this.timeRegion.fillColor : defaultColor;
        }
        return this.timeRegion.lineColor ? this.timeRegion.lineColor : defaultColor;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1yZWdpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vYXBwL3BsdWdpbnMvd2lkZ2V0cy9jaGFydC9zcmMvdmlldy9kcmF3ZXJzL3RpbWUtcmVnaW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDaEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBRS9FLE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFjLGVBQWUsRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUM7OztBQUdoRyxNQUFNLE9BQU8sdUJBQXdCLFNBQVEsZ0JBQWdCO0lBRTVELFlBQWEsS0FBaUI7UUFDN0IsS0FBSyxDQUFFLEtBQUssQ0FBRSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7UUFDekIsa0JBQUEsSUFBSTthQUNGLE1BQU0sMENBQ0wsT0FBTywwQ0FDUCxXQUFXLDBDQUNYLE9BQU8sQ0FBRSxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksZ0JBQWdCLENBQUUsS0FBSyxFQUFFLENBQUMsQ0FBRSxDQUFDLElBQUksRUFBRSxFQUFHO0lBQzVELENBQUM7OzhGQVpXLHVCQUF1QjsrREFBdkIsdUJBQXVCLFdBQXZCLHVCQUF1QjtrREFBdkIsdUJBQXVCO2NBRG5DLFVBQVU7O0FBZ0JYLE1BQU0sZ0JBQWlCLFNBQVEsVUFBVTtJQUV4QyxZQUFhLEtBQVUsRUFBVSxVQUFzQjtRQUN0RCxLQUFLLENBQUUsS0FBSyxDQUFFLENBQUM7UUFEaUIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUV2RCxDQUFDO0lBRUQsSUFBSTtRQUNILE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFB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QUFTLENBQUM7UUFFL0IsSUFBSSxJQUFJLEVBQUU7WUFDVCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1NBQzVFO1FBRUQsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztJQUM3RSxDQUFDO0NBR0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1vbWVudCB9IGZyb20gJ2NvbW1vbic7XHJcbmltcG9ydCB7IEJhc2VEcmF3ZXIsIENoYXJ0SnNFeHRlbnNpb24gfSBmcm9tICcuLi8uLi9iYXNlL2NoYXJ0LWJhc2UtZXh0ZW5zaW9uJztcclxuaW1wb3J0IHsgQ2hhcnRTdG9yZSB9IGZyb20gJy4uLy4uL2Jhc2UvY2hhcnQuc3RvcmUnO1xyXG5pbXBvcnQgeyBBWElTX1gsIEFYSVNfWV9MRUZULCBUaW1lUmVnaW9uLCBUaW1lUmVnaW9uQ29sb3IsIFRpbWVSZWdpb25EYXkgfSBmcm9tICcuLi8uLi9jaGFydC5tJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRpbWVSZWdpb25zRHJhd2VyUGx1Z2luIGV4dGVuZHMgQ2hhcnRKc0V4dGVuc2lvbiB7XHJcblx0XHJcblx0Y29uc3RydWN0b3IoIHN0b3JlOiBDaGFydFN0b3JlICl7XHJcblx0XHRzdXBlciggc3RvcmUgKTtcclxuXHR9XHJcblxyXG5cdGFmdGVyRGF0YXNldHNEcmF3KGNoYXJ0LCBfKSB7XHJcblx0XHR0aGlzXHJcblx0XHRcdC53aWRnZXRcclxuXHRcdFx0Py5kaXNwbGF5XHJcblx0XHRcdD8udGltZVJlZ2lvbnNcclxuXHRcdFx0Py5mb3JFYWNoKCB0ID0+IG5ldyBUaW1lUmVnaW9uRHJhd2VyKCBjaGFydCwgdCApLmRyYXcoKSApO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgVGltZVJlZ2lvbkRyYXdlciBleHRlbmRzIEJhc2VEcmF3ZXJ7XHJcblxyXG5cdGNvbnN0cnVjdG9yKCBjaGFydDogYW55LCBwcml2YXRlIHRpbWVSZWdpb246IFRpbWVSZWdpb24gKXtcclxuXHRcdHN1cGVyKCBjaGFydCApO1x0XHRcclxuXHR9XHJcblx0XHJcblx0ZHJhdygpe1xyXG5cdFx0Y29uc3Qgc2NhbGVYID0gdGhpcy5jaGFydC5zY2FsZXNbIEFYSVNfWCBdO1xyXG5cclxuXHRcdGNvbnN0IG1pblggPSBNb21lbnQuY3JlYXRlKCBzY2FsZVgubWluICk7XHJcblx0XHRjb25zdCBtYXhYID0gTW9tZW50LmNyZWF0ZSAoIHNjYWxlWC5tYXggKTtcclxuXHJcblx0XHR0aGlzXHJcblx0XHRcdC5nZXRTcGFucyggbWluWCwgbWF4WCApXHJcblx0XHRcdC5mb3JFYWNoKCB4ID0+IHtcclxuXHRcdFx0XHRsZXQgb3MgPSBzY2FsZVguZ2V0UGl4ZWxGb3JWYWx1ZSh4LnN0YXJ0LnRvRGF0ZSgpKTtcclxuXHRcdFx0XHRsZXQgb2UgPSBzY2FsZVguZ2V0UGl4ZWxGb3JWYWx1ZSh4LmVuZC50b0RhdGUoKSk7XHJcblxyXG5cdFx0XHRcdGlmKCEgKCBvZSA8ICBzY2FsZVgubGVmdCB8fCBvcyA+IHNjYWxlWC5yaWdodCApICl7XHJcblx0XHRcdFx0XHRvcyA9IE1hdGgubWF4KCBvcywgc2NhbGVYLmxlZnQgKTtcclxuXHRcdFx0XHRcdG9lID0gTWF0aC5taW4oIG9lLCBzY2FsZVgucmlnaHQgKTtcclxuXHJcblx0XHRcdFx0XHR0aGlzLnJlbmRlclJlZ2lvbiggb3MsIG9lICk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IClcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2V0U3BhbnMoIG1pbiwgbWF4ICl7XHJcblx0XHRjb25zdCBib3JkZXJzID0gdGhpcy5nZXRTcGFuQm9yZGVycyggbWluLCBtYXggKTtcclxuXHRcdGNvbnN0IHRpbWUgPSB0aGlzLmdldFRpbWUoKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5pc1NwZWNpZmljRGF5T2ZXZWVrKCkgPyBcclxuXHRcdFx0dGhpcy5nZXRTcGFuc0RheU9mV2VlayggYm9yZGVycywgdGltZSApIDogXHJcblx0XHRcdHRoaXMuZ2V0U3BhbnNBbnkoIGJvcmRlcnMsIHRpbWUgKVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBnZXRUaW1lKCl7XHJcblx0XHRjb25zdCBpc1NwZWNpZmljRGF5T2ZXZWVrID0gdGhpcy5pc1NwZWNpZmljRGF5T2ZXZWVrKCk7XHJcblxyXG5cdFx0bGV0IGlucHV0RnJvbVRpbWUgPSB0aGlzLnRpbWVSZWdpb24uZnJvbVRpbWU7XHJcblx0XHRsZXQgaW5wdXRUb1RpbWUgPSB0aGlzLnRpbWVSZWdpb24udG9UaW1lO1xyXG5cclxuXHRcdGNvbnN0IHRpbWVGb3JtYXQgPSBcIkhIOm1tXCI7XHJcblxyXG5cdFx0bGV0IHRmID0gTW9tZW50LmNyZWF0ZShpbnB1dEZyb21UaW1lLCB0aW1lRm9ybWF0KTtcclxuXHRcdGxldCB0dCA9IE1vbWVudC5jcmVhdGUoaW5wdXRUb1RpbWUsIHRpbWVGb3JtYXQpO1xyXG5cclxuXHRcdGlmKCAhdGYuaXNWYWxpZCgpICYmICF0dC5pc1ZhbGlkKCkgKXtcclxuXHRcdFx0aWYoIGlzU3BlY2lmaWNEYXlPZldlZWsgKXtcclxuXHRcdFx0XHRjb25zdCBtaWRuaWdodCA9IE1vbWVudC5jcmVhdGUoIFwiMDA6MDBcIiwgdGltZUZvcm1hdCApO1xyXG5cdFx0XHRcdHRmID0gbWlkbmlnaHQuY2xvbmUoKTtcclxuXHRcdFx0XHR0dCA9IG1pZG5pZ2h0LmNsb25lKCk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSBpZiggdGYuaXNWYWxpZCgpICYmICF0dC5pc1ZhbGlkKCkgKXtcclxuXHRcdFx0dHQgPSB0Zi5jbG9uZSgpO1xyXG5cdFx0fSBlbHNlIGlmKCAhdGYuaXNWYWxpZCgpICYmIHR0LmlzVmFsaWQoKSApe1xyXG5cdFx0XHR0ZiA9IHR0LmNsb25lKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0ZnJvbTogKCB0Zi5pc1ZhbGlkKCkgKSA/IHRmLnRvRGF0ZSgpIDogdW5kZWZpbmVkLFxyXG5cdFx0XHR0bzogKCB0dC5pc1ZhbGlkKCkgKSA/IHR0LnRvRGF0ZSgpIDogdW5kZWZpbmVkXHJcblx0XHR9XHJcblx0fVxyXG5cdHByaXZhdGUgZ2V0U3BhbnNEYXlPZldlZWsoIGJvcmRlcnMsIHRpbWUgKXtcclxuXHRcdGNvbnN0IG1heCA9IGJvcmRlcnMudG87XHJcblx0XHRjb25zdCBtaW4gPSBib3JkZXJzLmZyb207XHJcblxyXG5cdFx0dmFyIGN1cnJlbnQgPSBtaW4uY2xvbmUoKTtcclxuXHRcdHZhciByZXMgPSBbXTtcclxuXHJcblx0XHR2YXIgZnJvbURheU5hbWUgPSB0aGlzLnRpbWVSZWdpb24uZnJvbURheTsvL1RpbWVSZWdpb25EYXlbICBdXHJcblx0XHR2YXIgdG9EYXlOYW1lID0gdGhpcy50aW1lUmVnaW9uLnRvRGF5Oy8vVGltZVJlZ2lvbkRheVsgIF07XHJcblx0XHRcclxuXHRcdHdoaWxlKCBjdXJyZW50IDwgbWF4ICl7XHJcblx0XHRcdHZhciBzdGFydCA9IGN1cnJlbnQuY2xvbmUoKS5kYXkoIGZyb21EYXlOYW1lICk7XHJcblx0XHRcdHZhciBlbmQgPSBzdGFydC5jbG9uZSgpLmRheSggdG9EYXlOYW1lICk7XHJcblx0XHJcblx0XHRcdGlmKCBlbmQuaXNCZWZvcmUoIHN0YXJ0ICkgKXtcclxuXHRcdFx0XHRlbmQuYWRkKCAxLCAnd2Vla3MnIClcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0c3RhcnQuc2V0KHtcclxuXHRcdFx0XHQnaG91cicgOiB0aW1lLmZyb20uZ2V0SG91cnMoKSxcclxuXHRcdFx0XHQnbWludXRlJyAgOiB0aW1lLmZyb20uZ2V0TWludXRlcygpXHJcblx0XHRcdCB9KTtcclxuXHJcblx0XHRcdGVuZC5zZXQoe1xyXG5cdFx0XHRcdCdob3VyJyA6IHRpbWUudG8uZ2V0SG91cnMoKSxcclxuXHRcdFx0XHQnbWludXRlJyAgOiB0aW1lLnRvLmdldE1pbnV0ZXMoKVxyXG5cdFx0XHQgfSk7XHJcblxyXG5cdFx0XHRyZXMucHVzaCggeyBzdGFydCwgZW5kIH0gKVxyXG5cdFxyXG5cdFx0XHRjdXJyZW50LmFkZCggMSwgJ3dlZWtzJyApO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiByZXM7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGdldFNwYW5zQW55KCBib3JkZXJzLCB0aW1lICl7XHJcblx0XHRjb25zdCBtYXggPSBib3JkZXJzLnRvO1xyXG5cdFx0Y29uc3QgbWluID0gYm9yZGVycy5mcm9tO1xyXG5cclxuXHRcdHZhciBjdXJyZW50ID0gbWluLmNsb25lKCk7XHJcblx0XHR2YXIgcmVzID0gW107XHJcblxyXG5cdFx0aWYoICF0aW1lLmZyb20gJiYgIXRpbWUudG8gKXtcclxuXHRcdFx0cmV0dXJuIHJlcztcclxuXHRcdH1cclxuXHJcblx0XHR3aGlsZSggY3VycmVudCA8IG1heCApe1xyXG5cdFx0XHR2YXIgc3RhcnQgPSBjdXJyZW50LmNsb25lKCkuc2V0KHtcclxuXHRcdFx0XHQnaG91cicgOiB0aW1lLmZyb20uZ2V0SG91cnMoKSxcclxuXHRcdFx0XHQnbWludXRlJyAgOiB0aW1lLmZyb20uZ2V0TWludXRlcygpXHJcblx0XHRcdCB9KTtcclxuXHRcclxuXHRcdFx0dmFyIGVuZCA9IGN1cnJlbnQuY2xvbmUoKS5zZXQoe1xyXG5cdFx0XHRcdCdob3VyJyA6IHRpbWUudG8uZ2V0SG91cnMoKSxcclxuXHRcdFx0XHQnbWludXRlJyAgOiB0aW1lLnRvLmdldE1pbnV0ZXMoKVxyXG5cdFx0XHQgfSk7XHJcblxyXG5cdFx0XHRpZiggZW5kLmlzQmVmb3JlKCBzdGFydCApICl7XHJcblx0XHRcdFx0ZW5kLmFkZCggMSwgJ2RheXMnICk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJlcy5wdXNoKCB7IHN0YXJ0LCBlbmQgfSApXHJcblx0XHJcblx0XHRcdGN1cnJlbnQuYWRkKCAxLCAnZGF5cycgKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gcmVzO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBnZXRTcGFuQm9yZGVycyggbWluLCBtYXggKXtcclxuXHRcdGNvbnN0IG1hcmdpbiA9IHRoaXMuaXNTcGVjaWZpY0RheU9mV2VlaygpID8gOCA6IDE7XHJcblxyXG5cdFx0Y29uc3QgZnJvbSA9IG1pblxyXG5cdFx0XHQuY2xvbmUoKVxyXG5cdFx0XHQuc3VidHJhY3QoIG1hcmdpbiwgJ2RheXMnIClcclxuXHRcdFx0LnN0YXJ0T2YoICdkYXknICk7XHJcblxyXG5cdFx0Y29uc3QgdG8gPSBtYXhcclxuXHRcdFx0LmNsb25lKClcclxuXHRcdFx0LmFkZCggbWFyZ2luLCAnZGF5cycgKVxyXG5cdFx0XHQuZW5kT2YoICdkYXknICk7XHJcblxyXG5cdFx0cmV0dXJuIHsgZnJvbSwgdG8gfVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBpc1NwZWNpZmljRGF5T2ZXZWVrKCl7XHJcblx0XHRyZXR1cm4gKCB0aGlzLnRpbWVSZWdpb24uZnJvbURheSAhPSBUaW1lUmVnaW9uRGF5LkFueSApIHx8XHJcblx0XHRcdCggdGhpcy50aW1lUmVnaW9uLnRvRGF5ICE9IFRpbWVSZWdpb25EYXkuQW55ICk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlclJlZ2lvbiggb2Zmc2V0U3RhcnQsIG9mZnNldEVuZCl7XHJcblxyXG5cdFx0Y29uc3Qgc2NhbGVZQSA9IHRoaXMuY2hhcnQuc2NhbGVzWyBBWElTX1lfTEVGVCBdO1xyXG5cdFx0Y29uc3Qgc2NhbGVYID0gdGhpcy5jaGFydC5zY2FsZXNbIEFYSVNfWCBdO1xyXG5cclxuXHRcdGNvbnN0IG1pblkgPSBzY2FsZVlBLnRvcDtcclxuXHRcdGNvbnN0IG1heFkgPSBzY2FsZVlBLmJvdHRvbTtcclxuXHJcblx0XHRpZiggdGhpcy50aW1lUmVnaW9uLmxpbmUgKXtcclxuXHRcdFx0aWYoIHNjYWxlWC5sZWZ0ICE9IG9mZnNldFN0YXJ0ICl7XHJcblx0XHRcdFx0dGhpcy5yZW5kZXJMaW5lKCBtaW5ZLCBtYXhZLCBvZmZzZXRTdGFydCApO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRpZiggc2NhbGVYLnJpZ2h0ICE9IG9mZnNldEVuZCAmJiBvZmZzZXRFbmQgIT0gb2Zmc2V0U3RhcnQpe1xyXG5cdFx0XHRcdHRoaXMucmVuZGVyTGluZSggbWluWSwgbWF4WSwgb2Zmc2V0RW5kICk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiggdGhpcy50aW1lUmVnaW9uLmZpbGwgJiYgb2Zmc2V0RW5kICE9IG9mZnNldFN0YXJ0ICApe1xyXG5cdFx0XHR0aGlzLnJlbmRlclJlY3RhbmdsZSggbWluWSwgbWF4WSwgb2Zmc2V0U3RhcnQsIG9mZnNldEVuZCApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSByZW5kZXJMaW5lKCBtaW5ZLCBtYXhZLCBvZmZzZXQgKXtcclxuXHRcdGNvbnN0IGNvbG9yID0gdGhpcy5nZXRDb2xvciggZmFsc2UgKTtcclxuXHJcblx0XHR0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XHJcblx0XHR0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSBjb2xvciArIFwiOTlcIjtcclxuXHRcdHRoaXMuY29udGV4dC5saW5lV2lkdGggPSAyO1xyXG5cdFx0dGhpcy5jb250ZXh0Lm1vdmVUbyggb2Zmc2V0LCBtaW5ZICk7XHJcblx0XHR0aGlzLmNvbnRleHQubGluZVRvKCBvZmZzZXQsIG1heFkgKTtcclxuXHRcdHRoaXMuY29udGV4dC5zdHJva2UoKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcmVuZGVyUmVjdGFuZ2xlKCBtaW5ZLCBtYXhZLCBvZmZzZXRTdGFydCwgb2Zmc2V0RW5kICApe1xyXG5cdFx0Y29uc3QgY29sb3IgPSB0aGlzLmdldENvbG9yKCB0cnVlICk7XHJcblx0XHRcclxuXHRcdHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSBjb2xvciArIFwiMjJcIlxyXG5cclxuXHRcdGNvbnN0IHggPSBvZmZzZXRTdGFydDtcclxuXHRcdGNvbnN0IHcgPSBvZmZzZXRFbmQgLSBvZmZzZXRTdGFydDtcclxuXHJcblx0XHRjb25zdCB5ID0gbWluWTtcclxuXHRcdGNvbnN0IGggPSBtYXhZIC0gbWluWTtcclxuXHJcblx0XHR0aGlzLmNvbnRleHQuZmlsbFJlY3QoIHgsIHksXHR3LCBoICk7XHRcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2V0Q29sb3IoIGZpbGwpe1xyXG5cdFx0c3dpdGNoKCB0aGlzLnRpbWVSZWdpb24uY29sb3JUeXBlICl7XHJcblx0XHRcdGNhc2UgVGltZVJlZ2lvbkNvbG9yLlJlZDpcclxuXHRcdFx0XHRyZXR1cm4gJyNFRDJFMTgnO1xyXG5cclxuXHRcdFx0Y2FzZSBUaW1lUmVnaW9uQ29sb3IuR3JlZW46XHJcblx0XHRcdFx0cmV0dXJuICcjMTBhMzQ1JztcclxuXHJcblx0XHRcdGNhc2UgVGltZVJlZ2lvbkNvbG9yLkJsdWU6XHJcblx0XHRcdFx0cmV0dXJuICcjMWY3OGMxJztcclxuXHJcblx0XHRcdGNhc2UgVGltZVJlZ2lvbkNvbG9yLlllbGxvdzpcclxuXHRcdFx0XHRyZXR1cm4gJyNmNzk1MjAnO1xyXG5cclxuXHRcdFx0Y2FzZSBUaW1lUmVnaW9uQ29sb3IuR3JheTpcclxuXHRcdFx0XHRyZXR1cm4gJyNmY2UyZGUnO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IGRlZmF1bHRDb2xvciA9ICcjZmZmZmZmJztcclxuXHJcblx0XHRpZiggZmlsbCApe1xyXG5cdFx0XHRyZXR1cm4gdGhpcy50aW1lUmVnaW9uLmZpbGxDb2xvciA/IHRoaXMudGltZVJlZ2lvbi5maWxsQ29sb3IgOiBkZWZhdWx0Q29sb3I7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMudGltZVJlZ2lvbi5saW5lQ29sb3IgPyB0aGlzLnRpbWVSZWdpb24ubGluZUNvbG9yIDogZGVmYXVsdENvbG9yO1xyXG5cdH1cclxuXHJcblxyXG59XHJcbiJdfQ==