!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("uilib"),require("@angular/common"),require("common"),require("lodash"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("influx",["exports","@angular/core","@angular/forms","uilib","@angular/common","common","lodash","rxjs","rxjs/operators"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).influx={},e.ng.core,e.ng.forms,e.i2,e.ng.common,e.i1,e._,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r,i,o,a,l,u){"use strict";function s(e,n){1&e&&t.ɵɵtext(0," please enter url ")}function c(e,n){1&e&&t.ɵɵtemplate(0,s,1,0,"ng-template",16)}var m=function(){function e(){this.form=new n.FormGroup({url:new n.FormControl(null,n.Validators.required),whitelistedCookies:new n.FormControl(null),basicAuthentication:new n.FormControl(!1),withCredentials:new n.FormControl(!1),tlsClientAuth:new n.FormControl(!1),withCaCert:new n.FormControl(!1),skipTlsVerification:new n.FormControl(!1),database:new n.FormControl(null,n.Validators.required),user:new n.FormControl(null),password:new n.FormControl(null),minTimeInterval:new n.FormControl(null)})}return Object.defineProperty(e.prototype,"url",{get:function(){return this.form.get("url")},enumerable:!1,configurable:!0}),e}();m.ɵfac=function(e){return new(e||m)},m.ɵcmp=t.ɵɵdefineComponent({type:m,selectors:[["ds-settings-editor"]],decls:41,vars:14,consts:[[3,"formGroup"],[1,"page-heading"],[1,"gf-form-group"],["label","URL","labelWidth","10","hint","Specify a complete HTTP URL (for example http://your_server:8080)","formControlName","url"],[4,"ngIf"],["label","Whitelisted Cookies","labelWidth","10","formControlName","whitelistedCookies"],[1,"gf-form-inline"],["labelWidth","10","label","Basic Auth","formControlName","basicAuthentication"],["labelWidth","10","label","With Credentials","hint","Whether credentials such as cookies or auth headers should be sent with cross-site requests.","formControlName","withCredentials"],["labelWidth","10","label","TLS Client Auth","formControlName","tlsClientAuth"],["labelWidth","10","label","With CA Cert","hint","Needed for verifing self-signed TLS Certs","formControlName","withCaCert"],["labelWidth","10","label","Skip TLS Verify","formControlName","skipTlsVerification"],["formControlName","database",3,"label","labelWidth"],["formControlName","user",3,"label","labelWidth","width"],["type","password","formControlName","password",3,"label","labelWidth","width"],["hint","'A lower limit for the auto group by time interval. Recommended to be set to write frequency,\n\t\t\t\tfor example 1m if your data is written every minute.'","type","password","formControlName","minTimeInterval",3,"label","labelWidth","width","placeholder"],["edValidationTemplate",""]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"h3",1),t.ɵɵtext(2,"HTTP"),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"div",2),t.ɵɵelementStart(4,"ed-textbox",3),t.ɵɵtemplate(5,c,1,0,void 0,4),t.ɵɵelementEnd(),t.ɵɵelement(6,"ed-textbox",5),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"h3",1),t.ɵɵtext(8,"Auth"),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"div",2),t.ɵɵelementStart(10,"div",6),t.ɵɵelement(11,"ed-checkbox",7),t.ɵɵelement(12,"ed-checkbox",8),t.ɵɵelementEnd(),t.ɵɵelementStart(13,"div",6),t.ɵɵelement(14,"ed-checkbox",9),t.ɵɵelement(15,"ed-checkbox",10),t.ɵɵelementEnd(),t.ɵɵelementStart(16,"div",6),t.ɵɵelement(17,"ed-checkbox",11),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(18,"h3",1),t.ɵɵtext(19,"InfluxDB Details"),t.ɵɵelementEnd(),t.ɵɵelementStart(20,"div",2),t.ɵɵelement(21,"ed-textbox",12),t.ɵɵelementStart(22,"div",6),t.ɵɵelement(23,"ed-textbox",13),t.ɵɵelement(24,"ed-textbox",14),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(25,"div",2),t.ɵɵelementStart(26,"ed-info-box"),t.ɵɵelementStart(27,"h5"),t.ɵɵtext(28,"Database Access"),t.ɵɵelementEnd(),t.ɵɵelementStart(29,"p"),t.ɵɵtext(30," Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example: "),t.ɵɵelementStart(31,"code"),t.ɵɵtext(32,"SHOW MEASUREMENTS ON _internal"),t.ɵɵelementEnd(),t.ɵɵtext(33," or "),t.ɵɵelementStart(34,"code"),t.ɵɵtext(35,'SELECT * FROM "_internal".."database" LIMIT 10'),t.ɵɵelementEnd(),t.ɵɵelement(36,"br"),t.ɵɵelement(37,"br"),t.ɵɵtext(38," To support data isolation and security, make sure appropriate permissions are configured in InfluxDB. "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(39,"div",2),t.ɵɵelement(40,"ed-textbox",15),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("formGroup",n.form),t.ɵɵadvance(5),t.ɵɵproperty("ngIf",n.url.hasError("required")&&n.url.touched),t.ɵɵadvance(16),t.ɵɵproperty("label","Database")("labelWidth",10),t.ɵɵadvance(2),t.ɵɵproperty("label","User")("labelWidth",10)("width",5),t.ɵɵadvance(1),t.ɵɵproperty("label","Password")("labelWidth",10)("width",5),t.ɵɵadvance(16),t.ɵɵproperty("label","Min time interval")("labelWidth",11)("width",5)("placeholder","10s"))},directives:[n.NgControlStatusGroup,n.FormGroupDirective,r.TextBoxComponent,n.NgControlStatus,n.FormControlName,i.NgIf,r.CheckBoxComponent,r.InfoBoxComponent,r.TextBoxValidationTemplate],encapsulation:2});var d,p,f=function(){this.measurement="",this.policy="",this.refId="",this.tags=new Array,this.fields=new Array,this.limit=void 0,this.slimit=void 0,this.order=e.OrderByTime.Asc,this.alias="",this.groupBy=new Array},g=function(){},v=function(){};(d=e.AggrFunc||(e.AggrFunc={})).Count="count",d.Distinct="distinct",d.Integral="integral",d.Mean="mean",d.Median="median",d.Mode="mode",d.Sum="sum",d.Bottom="bottom",d.First="first",d.Last="last",d.Max="max",d.Min="min",d.Percentile="percentile",d.Top="top",d.Derivative="derivative",d.Spread="spread",d.NonNegativeDerivative="non_negative_derivative",d.Difference="difference",d.NonNegativeDifference="non_negative_difference",d.MovingAverage="moving_average",d.CumulativeSum="cumulative_sum",d.Stddev="stddev",d.Elapsed="elapsed",d.HoltWinters="holt_winters",d.HoltWintersWithFit="holt_winters_with_fit",d.Math="math",d.Alias="alias",(p=e.AggrFuncGroup||(e.AggrFuncGroup={}))[p.Aggregations=0]="Aggregations",p[p.Selectors=1]="Selectors",p[p.Transformations=2]="Transformations",p[p.Predictors=3]="Predictors",p[p.Math=4]="Math",p[p.Alias=5]="Alias";var h,y,b,x,E=function(){function t(){}return t.getGroup=function(t){switch(t){case e.AggrFunc.Count:case e.AggrFunc.Distinct:case e.AggrFunc.Integral:case e.AggrFunc.Mean:case e.AggrFunc.Median:case e.AggrFunc.Mode:case e.AggrFunc.Sum:return e.AggrFuncGroup.Aggregations;case e.AggrFunc.Bottom:case e.AggrFunc.First:case e.AggrFunc.Last:case e.AggrFunc.Max:case e.AggrFunc.Min:case e.AggrFunc.Percentile:case e.AggrFunc.Top:return e.AggrFuncGroup.Selectors;case e.AggrFunc.Derivative:case e.AggrFunc.Spread:case e.AggrFunc.NonNegativeDerivative:case e.AggrFunc.Difference:case e.AggrFunc.NonNegativeDifference:case e.AggrFunc.MovingAverage:case e.AggrFunc.CumulativeSum:case e.AggrFunc.Stddev:case e.AggrFunc.Elapsed:return e.AggrFuncGroup.Transformations;case e.AggrFunc.HoltWinters:case e.AggrFunc.HoltWintersWithFit:return e.AggrFuncGroup.Predictors;case e.AggrFunc.Math:return e.AggrFuncGroup.Math;case e.AggrFunc.Alias:return e.AggrFuncGroup.Alias}},t}(),S=function(e,t){void 0===t&&(t=[]),this.type=e,this.params=t};(h=e.GroupByOption||(e.GroupByOption={}))[h.Time=0]="Time",h[h.Fill=1]="Fill",h[h.Tag=2]="Tag",(y=e.GroupByTimeOptions||(e.GroupByTimeOptions={})).Dynamic="$__interval",y.S1="1s",y.S10="10s",y.M1="1m",y.M5="5m",y.M10="10m",y.M15="15m",y.H1="1h",(b=e.GroupByFillOptions||(e.GroupByFillOptions={})).None="none",b.Null="null",b.Zero="0",b.Prev="previous",b.Linear="linear",(x=e.OrderByTime||(e.OrderByTime={})).Asc="asc",x.Desc="desc";var w=function(){};w.TIME_FILTER="$timeFilter",w.TIME_INTERVAL="$__interval";var C,F,O=function(){this.key="",this.value="",this.operator=e.TagOperator.Eq,this.condition=e.TagCondition.And};(C=e.TagOperator||(e.TagOperator={})).Eq="=",C.Neq="<>",C.Less="<",C.Greater=">",C.RegExEq="=~",C.RegExNeq="!~",(F=e.TagCondition||(e.TagCondition={})).And="AND",F.Or="OR";var M=function(){function e(e){void 0===e&&(e=void 0),this.time=e}return e.prototype.build=function(e,t){var n=this,r=[];e.targets.forEach((function(e){var i=new A(n.time,e,t);i.invalid||e.virgin||r.push(i.text)}));var i=r.join(";");return l.of(i)},e}();M.ɵfac=function(e){return new(e||M)(t.ɵɵdirectiveInject(o.TimeRangeStore))},M.ɵcmp=t.ɵɵdefineComponent({type:M,selectors:[["metrics-builder"]],decls:0,vars:0,template:function(e,t){},encapsulation:2});var A=function(){function t(e,t,n){this.time=e,this.target=t,this.range=n}return Object.defineProperty(t.prototype,"invalid",{get:function(){return!this.target||!this.target.fields||0===this.target.fields.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return"SELECT "+this.getFieldsText()+" FROM "+this.getMeasurementText()},enumerable:!1,configurable:!0}),t.prototype.getFieldsText=function(){var e=this,t="";return this.target.fields?(this.target.fields.forEach((function(n){t.length>0&&(t+=", "),t+=e.getFieldText(n)})),t):t},t.prototype.getFieldText=function(t){var n="",r=t.key?t.key:"field",i=t.functions.find((function(t){return E.getGroup(t.name)==e.AggrFuncGroup.Aggregations||E.getGroup(t.name)==e.AggrFuncGroup.Selectors}));i?n+=i.name+(i.param&&i.param.value?'("'+r+'", '+i.param.value+")":'("'+r+'")'):n='"'+r+'"',t.functions.filter((function(t){return E.getGroup(t.name)===e.AggrFuncGroup.Transformations})).forEach((function(e){var t=e.param&&e.param.value?", "+e.param.value:"";n=e.name+"("+n+t+")"}));var o=t.functions.find((function(t){return E.getGroup(t.name)===e.AggrFuncGroup.Math}));o&&(n=n+" "+o.param.value);var a=t.functions.find((function(t){return E.getGroup(t.name)===e.AggrFuncGroup.Alias}));return a&&(n=n+' AS "'+a.param.value+'"'),n},t.prototype.getMeasurementText=function(){var t=this.target.measurement?this.target.measurement:"measurement",n=(this.target.policy&&this.target.policy.length>0&&"default"!==this.target.policy?'"'+this.target.policy+'".':"")+'"'+t+'"',r="",i=0;this.target.tags&&this.target.tags.filter((function(e){return e.key&&e.value})).forEach((function(e){i>0&&(r+=" "+e.condition+" "),r+=' "'+e.key+'" '+e.operator+" '"+e.value+"'",++i}));var o=this.range?this.getTimeFilter():w.TIME_FILTER;n=r.length>0?n+" WHERE ("+r+") and "+o:n+" WHERE "+o;var a=this.target.groupBy,l=a.find((function(t){return t.type==e.GroupByOption.Time})),u=a.find((function(t){return t.type==e.GroupByOption.Fill})),s=a.filter((function(t){return t.type==e.GroupByOption.Tag}));if(l){var c=this.range&&l.params[0]==w.TIME_INTERVAL?this.getOptimalAutoGroupBy():l.params[0];n=n+" GROUP BY time("+c+")"}return s.length>0&&(n=l?n+",":n+" GROUP BY",s.forEach((function(e,t){n=n+(t>0?", ":" ")+' "'+e.params[0]+'"'}))),u&&(n=n+" FILL("+u.params[0]+")"),this.target.order!=e.OrderByTime.Asc&&(n+=" ORDER BY time DESC"),this.target.limit>0&&(n=n+" LIMIT "+this.target.limit),this.target.slimit>0&&(n=n+" SLIMIT "+this.target.slimit),n},t.prototype.getOptimalAutoGroupBy=function(){var e=o.TimeRangeParser.toDateTime(this.range.from,!1),t=o.TimeRangeParser.toDateTime(this.range.to,!0);return 5>+t.diff(e,"minutes")?"200ms":15>+t.diff(e,"minutes")?"1s":30>t.diff(e,"minutes")?"2s":1>t.diff(e,"hours")?"5s":3>t.diff(e,"hours")?"10s":6>t.diff(e,"hours")?"20s":12>t.diff(e,"hours")?"1m":24>t.diff(e,"hours")?"2m":7>t.diff(e,"days")?"10m":31>t.diff(e,"days")?"1h":365>t.diff(e,"days")?"12h":"24h"},t.prototype.getTimeFilter=function(){var e=this.range,t=this.time.converter.timezone,n=this.getInfluxTime(e.from,!1,t),r=this.getInfluxTime(e.to,!0,t),i="ms"===n[n.length-1];return"now()"!==r||i?"time >= "+n+" and time <= "+r:"time >= "+n},t.prototype.getInfluxTime=function(e,t,n){if(a.isString(e)){if("now"===e)return"now()";var r=/^now-(\d+)([dhms])$/.exec(e);if(r)return"now() - "+parseInt(r[1],10)+r[2];e=o.TimeRangeParser.toDateTime(e,t,n)}return e.valueOf()+"ms"},t}(),T=function(e,t){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function I(e,t){function n(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function k(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function q(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(k(arguments[t]));return e}var V=function(){function e(e,n){this.panel=e,this.dsService=n,this.REMOVE="--remove--",this.ADD="--add--",this.change=new t.EventEmitter,this.rebuild=new t.EventEmitter}return Object.defineProperty(e.prototype,"metrics",{get:function(){return this.panel.widget.metrics},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataSourceId",{get:function(){return this.metrics.dataSource},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tags",{get:function(){return this.query.tags},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fields",{get:function(){return this.query.fields},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupBy",{get:function(){return this.query.groupBy},enumerable:!1,configurable:!0}),e.prototype.proxy=function(e){return this.dsService.proxy(this.dataSourceId,e)},e.prototype.needRebuild=function(){this.rebuild.emit()},e.prototype.build=function(e){var t=this;void 0===e&&(e=!0),(new M).build({targets:[this.query],dataSource:0}).subscribe((function(n){t.queryAsString=n,e&&t.onRebuild()}))},e.prototype.onRebuild=function(){},e}();function R(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"ed-autocomplete-picker",13),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().$implicit.operator=e}))("pick",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext(2).needRebuild()})),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext().$implicit,o=t.ɵɵnextContext();t.ɵɵproperty("ngModel",i.operator)("request",o.tagOperators$(i))}}function N(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"ed-autocomplete-picker",14),t.ɵɵlistener("pick",(function(e){t.ɵɵrestoreView(r);var n=t.ɵɵnextContext().$implicit,i=t.ɵɵnextContext();return i.onTagValuePick(n,e),i.needRebuild()})),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext().$implicit,o=t.ɵɵnextContext();t.ɵɵproperty("value",i.value)("request",o.tagValues$(i))}}function P(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"ed-autocomplete-picker",9),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),n.$implicit.condition=e}))("pick",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().needRebuild()})),t.ɵɵelementEnd(),t.ɵɵelementStart(2,"ed-autocomplete-picker",10),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),n.$implicit.key=e}))("pick",(function(e){t.ɵɵrestoreView(r);var i=n.$implicit,o=t.ɵɵnextContext();return o.onTagKeyPick(i,e),o.needRebuild()})),t.ɵɵelementEnd(),t.ɵɵtemplate(3,R,1,2,"ed-autocomplete-picker",11),t.ɵɵtemplate(4,N,1,2,"ed-autocomplete-picker",12),t.ɵɵelementContainerEnd()}if(2&e){var i=n.$implicit,o=n.index,a=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("hidden",!(o>0&&i.key))("ngModel",i.condition)("request",a.conditions$),t.ɵɵadvance(1),t.ɵɵproperty("ngModel",i.key)("request",a.tagKeys$),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.key),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.key)}}V.ɵfac=function(e){return new(e||V)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.DataSourceService))},V.ɵdir=t.ɵɵdefineDirective({type:V,inputs:{query:"query"},outputs:{change:"change",rebuild:"rebuild"}});var D=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.dsService=n,r.DEFAULT_POLICY="default",r}return I(n,t),Object.defineProperty(n.prototype,"retentionPolicies$",{get:function(){return this.proxy("SHOW RETENTION POLICIES").pipe(u.map((function(e){return q(["default"],e[0].values.map((function(e){return e[0]})))})))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"measurements$",{get:function(){return this.proxy("SHOW MEASUREMENTS").pipe(u.map((function(e){return q(e[0].values).reduce((function(e,t){return e.concat(t)}),[])})))},enumerable:!1,configurable:!0}),n.prototype.tagOperators$=function(t){var n=this.isRegex(t.value),r=Object.values(e.TagOperator),i=n?r.slice(4,6):r.slice(0,4);return l.of(i)},Object.defineProperty(n.prototype,"tagKeys$",{get:function(){var e=this,t=this.query.measurement?"SHOW TAG KEYS from "+this.query.measurement:"SHOW TAG KEYS";return this.proxy(t).pipe(u.map((function(t){return q(t[0].values.reduce((function(e,t){return e.concat(t)}),[]),[e.REMOVE])})))},enumerable:!1,configurable:!0}),n.prototype.tagValues$=function(e){var t="SHOW TAG VALUES  WITH KEY="+e.key;return this.proxy(t).pipe(u.map((function(e){return e[0].values.map((function(e){return e[1]}))})))},Object.defineProperty(n.prototype,"conditions$",{get:function(){return l.of(Object.values(e.TagCondition))},enumerable:!1,configurable:!0}),n.prototype.ngOnInit=function(){var e;(null===(e=this.tags)||void 0===e?void 0:e.length)||this.tags.push(new O),this.query.policy||(this.query.policy=this.DEFAULT_POLICY)},n.prototype.isRegex=function(e){var t=!0;try{new RegExp(e),t=e.startsWith("/")&&e.endsWith("/")}catch(e){t=!1}return t},n.prototype.resetTags=function(){this.query.tags=[],this.tags.push(new O)},n.prototype.onTagKeyPick=function(e,t){var n=this.tags.indexOf(e);if(null==t?void 0:t.startsWith(this.REMOVE))this.query.tags=this.tags.filter((function(t){return t!=e})),0===this.tags.length&&this.resetTags();else{var r=this.tags.length;n===r-2&&0===this.tags[r-1].key.length&&this.tags.pop()}},n.prototype.onTagValuePick=function(t,n){var r=this.isRegex(t.value);t.value=n;var i=this.isRegex(t.value);if(r!=i&&(t.operator=i?e.TagOperator.RegExEq:e.TagOperator.Eq),this.tags.indexOf(t)===this.tags.length-1){var o=new O;this.tags.push(o)}},n}(V);D.ɵfac=function(e){return new(e||D)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.DataSourceService))},D.ɵcmp=t.ɵɵdefineComponent({type:D,selectors:[["measurement-editor"]],features:[t.ɵɵInheritDefinitionFeature],decls:12,vars:5,consts:[[1,"gf-form-inline"],[1,"gf-form"],[1,"gf-form-label","query-keyword","width-7"],[3,"ngModel","request","ngModelChange","pick"],["placeholder","select measurement",3,"ngModel","request","ngModelChange","pick"],[1,"gf-form-label","query-keyword"],[4,"ngFor","ngForOf"],[1,"gf-form","gf-form--grow"],[1,"gf-form-label","gf-form-label--grow"],["valueClass","query-keyword",3,"hidden","ngModel","request","ngModelChange","pick"],["placeholder","fa fa-plus",3,"ngModel","request","ngModelChange","pick"],["valueClass","query-segment-operator",3,"ngModel","request","ngModelChange","pick",4,"ngIf"],["placeholder","select tag value",3,"value","request","pick",4,"ngIf"],["valueClass","query-segment-operator",3,"ngModel","request","ngModelChange","pick"],["placeholder","select tag value",3,"value","request","pick"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵelementStart(2,"label",2),t.ɵɵtext(3," FROM "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"ed-autocomplete-picker",3),t.ɵɵlistener("ngModelChange",(function(e){return n.query.policy=e}))("pick",(function(){return n.needRebuild()})),t.ɵɵelementEnd(),t.ɵɵelementStart(5,"ed-autocomplete-picker",4),t.ɵɵlistener("ngModelChange",(function(e){return n.query.measurement=e}))("pick",(function(){return n.resetTags(),n.needRebuild()})),t.ɵɵelementEnd(),t.ɵɵelementStart(6,"div",1),t.ɵɵelementStart(7,"label",5),t.ɵɵtext(8," WHERE "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(9,P,5,7,"ng-container",6),t.ɵɵelementStart(10,"div",7),t.ɵɵelement(11,"div",8),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(4),t.ɵɵproperty("ngModel",n.query.policy)("request",n.retentionPolicies$),t.ɵɵadvance(1),t.ɵɵproperty("ngModel",n.query.measurement)("request",n.measurements$),t.ɵɵadvance(4),t.ɵɵproperty("ngForOf",n.query.tags))},directives:[r.AutoCompletePickerComponent,n.NgControlStatus,n.NgModel,i.NgForOf,i.NgIf],encapsulation:2});var B=["1s","10s","1m","5m","10m","15m","1h"],G=[{label:e.AggrFuncGroup[0],items:[{label:e.AggrFunc.Count},{label:e.AggrFunc.Distinct},{label:e.AggrFunc.Integral},{label:e.AggrFunc.Mean},{label:e.AggrFunc.Median},{label:e.AggrFunc.Mode},{label:e.AggrFunc.Sum}]},{label:e.AggrFuncGroup[1],items:[{label:e.AggrFunc.Bottom,param:{value:"3"}},{label:e.AggrFunc.First},{label:e.AggrFunc.Last},{label:e.AggrFunc.Max},{label:e.AggrFunc.Min},{label:e.AggrFunc.Percentile,param:{value:"95"}},{label:e.AggrFunc.Top,param:{value:"3"}}]},{label:e.AggrFuncGroup[2],items:[{label:e.AggrFunc.Derivative,param:{value:B[1],suggestions:q(B)}},{label:e.AggrFunc.Spread},{label:e.AggrFunc.NonNegativeDerivative,param:{value:B[1],suggestions:q(B)}},{label:e.AggrFunc.Difference},{label:e.AggrFunc.NonNegativeDifference},{label:e.AggrFunc.MovingAverage,param:{value:"10",suggestions:["5","10","20","30","40"]}},{label:e.AggrFunc.CumulativeSum},{label:e.AggrFunc.Stddev},{label:e.AggrFunc.Elapsed,param:{value:B[1],suggestions:q(B)}}]},{label:e.AggrFuncGroup[4],items:[{label:e.AggrFunc.Math,param:{value:" / 100"}}]},{label:e.AggrFuncGroup[5],items:[{label:e.AggrFunc.Alias,param:{value:"alias"}}]},{label:"Field",items:[{label:"field"}]}],j=function(){function e(){this.items=a.cloneDeep(G),this.pick=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;r.ContextMenuComponent.wrapItems(this.items,(function(t){return e.pick.emit(t.item)}))},e}();j.ɵfac=function(e){return new(e||j)},j.ɵcmp=t.ɵɵdefineComponent({type:j,selectors:[["field-function-picker"]],outputs:{pick:"pick"},decls:5,vars:1,consts:[[1,"gf-form"],[1,"gf-form-label","pointer",3,"click"],[1,"fa","fa-plus"],[3,"items"],["cm",""]],template:function(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"a",1),t.ɵɵlistener("click",(function(e){return t.ɵɵrestoreView(r),t.ɵɵreference(4).show(e)})),t.ɵɵelement(2,"i",2),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelement(3,"ed-context-menu",3,4)}2&e&&(t.ɵɵadvance(3),t.ɵɵproperty("items",n.items))},directives:[r.ContextMenuComponent],encapsulation:2});var _=["editor"],L=["suggestions"];function $(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a"),t.ɵɵelementStart(1,"span",9),t.ɵɵlistener("click",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onShowEditor(e)})),t.ɵɵtext(2),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("hidden",i.isEditorVisible),t.ɵɵadvance(1),t.ɵɵtextInterpolate(i.paramValue)}}var W=function(e){return{width:e}};function U(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"input",10,11),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().textValue=e}))("focusout",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onEditorFocusOut()}))("keydown",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onEditorKeyDown()}))("keyup.enter",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onEditorKeyUpEnter()}))("keyup.escape",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onEditorKeyUpEnter()})),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵproperty("ngStyle",t.ɵɵpureFunction1(2,W,8*(i.textValue.length+1)+"px"))("ngModel",i.textValue)}}var H=function(e){return[e]},K=function(){function e(){var e=this;this.remove=new t.EventEmitter,this.rebuild=new t.EventEmitter,this.isEditorVisible=!1,this.isSuggestionsMenuOpen=!1,this.suggestionItems=[],this.deleteMenuItem={label:"Remove",command:function(t){return e.remove.emit()}}}return Object.defineProperty(e.prototype,"param",{get:function(){return this.func.param},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paramValue",{get:function(){return this.param.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuggestions",{get:function(){return this.param&&this.param.suggestions},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.param&&(this.textValue=this.paramValue),this.hasSuggestions&&this.param.suggestions.forEach((function(t){return e.suggestionItems.push({label:t,command:function(t){e.paramValue==t.item.label||(e.param.value=e.textValue=t.item.label,e.isEditorVisible=!1,e.rebuild.emit())}})}))},e.prototype.onShowEditor=function(e){var t=this;this.param&&(this.hasSuggestions&&(this.isSuggestionsMenuOpen=!0,this.suggestions.show(e)),setTimeout((function(){t.isEditorVisible=!0,setTimeout((function(){return t.editorElement.nativeElement.focus()}),0)}),0))},e.prototype.onEditorFocusOut=function(){this.isSuggestionsMenuOpen||(this.isEditorVisible=!1,this.paramValue==this.textValue||(this.param.value=this.textValue,this.rebuild.emit()))},e.prototype.onEditorKeyDown=function(){this.isSuggestionsMenuOpen=!1,this.suggestions.hide()},e.prototype.onEditorKeyUpEnter=function(){this.isEditorVisible=!1,this.paramValue==this.textValue||(this.param.value=this.textValue,this.rebuild.emit())},e}();function Y(e,n){1&e&&(t.ɵɵelementStart(0,"span"),t.ɵɵtext(1,"SELECT"),t.ɵɵelementEnd())}function Q(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"field-function-editor",9),t.ɵɵlistener("remove",(function(){t.ɵɵrestoreView(r);var e=n.$implicit,i=t.ɵɵnextContext();return i.onFuncRemove(e),i.needRebuild()}))("rebuild",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().needRebuild()})),t.ɵɵelementEnd()}if(2&e){var i=n.$implicit;t.ɵɵproperty("func",i)}}K.ɵfac=function(e){return new(e||K)},K.ɵcmp=t.ɵɵdefineComponent({type:K,selectors:[["field-function-editor"]],viewQuery:function(e,n){var r;(1&e&&(t.ɵɵviewQuery(_,!0),t.ɵɵviewQuery(L,!0)),2&e)&&(t.ɵɵqueryRefresh(r=t.ɵɵloadQuery())&&(n.editorElement=r.first),t.ɵɵqueryRefresh(r=t.ɵɵloadQuery())&&(n.suggestions=r.first))},inputs:{func:"func"},outputs:{remove:"remove",rebuild:"rebuild"},decls:12,vars:7,consts:[[1,"gf-form"],[1,"gf-form-label"],[1,"pointer",3,"click"],[4,"ngIf"],["type","text","class","ff__editor ","spellcheck","false",3,"ngStyle","ngModel","ngModelChange","focusout","keydown","keyup.enter","keyup.escape",4,"ngIf"],[3,"click"],[3,"items"],["cmRemove",""],["suggestions",""],[3,"hidden","click"],["type","text","spellcheck","false",1,"ff__editor",3,"ngStyle","ngModel","ngModelChange","focusout","keydown","keyup.enter","keyup.escape"],["editor",""]],template:function(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"label",1),t.ɵɵelementStart(2,"a",2),t.ɵɵlistener("click",(function(e){return t.ɵɵrestoreView(r),t.ɵɵreference(9).show(e)})),t.ɵɵtext(3),t.ɵɵelementEnd(),t.ɵɵtemplate(4,$,3,2,"a",3),t.ɵɵtemplate(5,U,2,4,"input",4),t.ɵɵelementStart(6,"a",5),t.ɵɵlistener("click",(function(e){return n.onShowEditor(e)})),t.ɵɵtext(7,")"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelement(8,"ed-context-menu",6,7),t.ɵɵelement(10,"ed-context-menu",6,8)}2&e&&(t.ɵɵadvance(3),t.ɵɵtextInterpolate1("",n.func.name," ("),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.param),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.isEditorVisible),t.ɵɵadvance(3),t.ɵɵproperty("items",t.ɵɵpureFunction1(5,H,n.deleteMenuItem)),t.ɵɵadvance(2),t.ɵɵproperty("items",n.suggestionItems))},directives:[i.NgIf,r.ContextMenuComponent,n.DefaultValueAccessor,i.NgStyle,n.NgControlStatus,n.NgModel],styles:[".ff__editor[_ngcontent-%COMP%]{background:transparent;border:none;color:#d8d9da;font-family:Roboto,Helvetica,Arial,sans-serif;font-size:12px;font-weight:400;margin:0;padding:0;width:24px}.ff__editor[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:focus{-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;outline:none!important;outline-width:0!important}"]});var z=function(n){function r(e,r){var i=n.call(this,e,r)||this;return i.dsService=r,i.fieldFuncItems=G,i.remove=new t.EventEmitter,i.add=new t.EventEmitter,i}return I(r,n),Object.defineProperty(r.prototype,"functions",{get:function(){return this.field.functions},enumerable:!1,configurable:!0}),r.prototype.ngOnInit=function(){this.index=this.query.fields.indexOf(this.field);var e=this.fieldFuncItems.map((function(e){return e.items})).reduce((function(e,t){return e.concat(t)}));this.field.functions.forEach((function(t){if(t.param){var n=e.find((function(e){return e.text===t.name}));n&&n.param&&n.param.suggestions&&(t.param.suggestions=q(n.param.suggestions))}}))},Object.defineProperty(r.prototype,"fields$",{get:function(){var e=this;return this.proxy('SHOW FIELD KEYS FROM "'+this.query.measurement+'"').pipe(u.map((function(t){if(!t||0==t.length)return null;var n=q(t[0].values.map((function(e){return e[0]})));return e.query.fields.length>1?q([e.REMOVE],n):n})))},enumerable:!1,configurable:!0}),r.prototype.onFieldPick=function(e){e===this.REMOVE?this.remove.emit():this.field.key=e},r.prototype.onFuncPick=function(t){var n=new v;if(n.name=t.label,"field"!=t.label){t.param&&(n.param=a.cloneDeep(t.param));var r=this.functions.find((function(t){return E.getGroup(t.name)==e.AggrFuncGroup.Alias})),i=this.functions.find((function(t){return E.getGroup(t.name)==e.AggrFuncGroup.Math})),o=this.functions.length,l=this.functions;switch(E.getGroup(t.label)){case e.AggrFuncGroup.Aggregations:case e.AggrFuncGroup.Selectors:this.field.functions.find((function(t){return E.getGroup(t.name)==e.AggrFuncGroup.Aggregations||E.getGroup(t.name)==e.AggrFuncGroup.Selectors}))?l[0]=n:l.splice(0,0,n);break;case e.AggrFuncGroup.Transformations:r?l.splice(o-1,0,n):l.push(n);break;case e.AggrFuncGroup.Math:i&&!r?l[o-1]=n:!i&&r?l.splice(o-1,0,n):l.push(n);break;case e.AggrFuncGroup.Alias:r?this.functions[o-1]=n:this.functions.push(n)}}else this.add.emit()},r.prototype.onFuncRemove=function(e){var t=this.functions.indexOf(e);-1!==t&&this.functions.splice(t,1)},r}(V);function J(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"field-editor",1),t.ɵɵlistener("remove",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().onRemove(e)}))("add",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onAdd()}))("rebuild",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().needRebuild()})),t.ɵɵelementEnd()}if(2&e){var i=n.$implicit,o=t.ɵɵnextContext();t.ɵɵproperty("query",o.query)("field",i)}}z.ɵfac=function(e){return new(e||z)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.DataSourceService))},z.ɵcmp=t.ɵɵdefineComponent({type:z,selectors:[["field-editor"]],inputs:{field:"field"},outputs:{remove:"remove",add:"add"},features:[t.ɵɵInheritDefinitionFeature],decls:10,vars:4,consts:[[1,"gf-form-inline"],[1,"gf-form"],[1,"gf-form-label","query-keyword","width-7"],[4,"ngIf"],["placeholder","field(value)","formatString","field({0})",3,"ngModel","request","ngModelChange","pick"],[3,"func","remove","rebuild",4,"ngFor","ngForOf"],[3,"pick"],[1,"gf-form","gf-form--grow"],[1,"gf-form-label","gf-form-label--grow"],[3,"func","remove","rebuild"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵelementStart(2,"label",2),t.ɵɵtemplate(3,Y,2,0,"span",3),t.ɵɵtext(4,"  "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(5,"ed-autocomplete-picker",4),t.ɵɵlistener("ngModelChange",(function(e){return n.field.key=e}))("pick",(function(e){return n.onFieldPick(e),n.needRebuild()})),t.ɵɵelementEnd(),t.ɵɵtemplate(6,Q,1,1,"field-function-editor",5),t.ɵɵelementStart(7,"field-function-picker",6),t.ɵɵlistener("pick",(function(e){return n.onFuncPick(e),n.needRebuild()})),t.ɵɵelementEnd(),t.ɵɵelementStart(8,"div",7),t.ɵɵelement(9,"div",8),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(3),t.ɵɵproperty("ngIf",0===n.index),t.ɵɵadvance(2),t.ɵɵproperty("ngModel",n.field.key)("request",n.fields$),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",n.field.functions))},directives:[i.NgIf,r.AutoCompletePickerComponent,n.NgControlStatus,n.NgModel,i.NgForOf,j,K],encapsulation:2});var Z=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.dsService=n,r}return I(n,t),n.prototype.ngOnInit=function(){var e;(null===(e=this.fields)||void 0===e?void 0:e.length)||(this.query.fields=[this.createEmpyField()])},n.prototype.onRemove=function(e){var t=this.query.fields;if(1<t.length){var n=t.indexOf(e);-1!==n&&this.query.fields.splice(n,1)}},n.prototype.onAdd=function(){this.query.fields.push(this.createEmpyField())},n.prototype.createEmpyField=function(){var t=new v;t.name=e.AggrFunc.Mean;var n=new g;return n.functions=[t],n},n}(V);Z.ɵfac=function(e){return new(e||Z)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.DataSourceService))},Z.ɵcmp=t.ɵɵdefineComponent({type:Z,selectors:[["fields-editor"]],features:[t.ɵɵInheritDefinitionFeature],decls:1,vars:1,consts:[[3,"query","field","remove","add","rebuild",4,"ngFor","ngForOf"],[3,"query","field","remove","add","rebuild"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,J,1,2,"field-editor",0),2&e&&t.ɵɵproperty("ngForOf",n.query.fields)},directives:[i.NgForOf,z],encapsulation:2});var X=function(e){return[e]},ee=function(){var e=this;this.removed=new t.EventEmitter,this.deleteMenuItem={label:"Remove",command:function(t){return e.removed.emit(e.value)}}};function te(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"ed-autocomplete-picker",11),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().timeValue=e})),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵproperty("ngModel",i.timeValue)("request",i.timeOptions$)}}function ne(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",12),t.ɵɵlistener("removed",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().onRemoveTag(e)})),t.ɵɵelementEnd()}if(2&e){var i=n.$implicit;t.ɵɵproperty("value",i.params[0])}}function re(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵelementStart(2,"label",2),t.ɵɵtext(3," ORDER BY "),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"label",13),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext();return e.query.order=e.OrderByTimeRef.Asc,e.needRebuild()})),t.ɵɵtext(5," time "),t.ɵɵelementStart(6,"span",14),t.ɵɵtext(7,"DESC"),t.ɵɵelementEnd(),t.ɵɵelement(8,"i",15),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"div",6),t.ɵɵelement(10,"div",7),t.ɵɵelementEnd(),t.ɵɵelementEnd()}}function ie(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵelementStart(2,"label",2),t.ɵɵtext(3,"LIMIT"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"input",16),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().limit=e}))("change",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().needRebuild()})),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(5,"div",6),t.ɵɵelement(6,"div",7),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(4),t.ɵɵproperty("ngModel",i.limit)}}function oe(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵelementStart(2,"label",2),t.ɵɵtext(3,"SLIMIT"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"input",16),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().slimit=e}))("change",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().needRebuild()})),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(5,"div",6),t.ɵɵelement(6,"div",7),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(4),t.ɵɵproperty("ngModel",i.slimit)}}ee.ɵfac=function(e){return new(e||ee)},ee.ɵcmp=t.ɵɵdefineComponent({type:ee,selectors:[["","tag-label",""]],inputs:{value:"value"},outputs:{removed:"removed"},attrs:["tag-label",""],decls:4,vars:4,consts:[[1,"gf-form-label",3,"click"],[3,"items"],["cm",""]],template:function(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"span",0),t.ɵɵlistener("click",(function(e){return t.ɵɵrestoreView(r),t.ɵɵreference(3).show(e)})),t.ɵɵtext(1),t.ɵɵelementEnd(),t.ɵɵelement(2,"ed-context-menu",1,2)}2&e&&(t.ɵɵadvance(1),t.ɵɵtextInterpolate1("tag(",n.value,")"),t.ɵɵadvance(1),t.ɵɵproperty("items",t.ɵɵpureFunction1(2,X,n.deleteMenuItem)))},directives:[r.ContextMenuComponent],encapsulation:2});var ae=function(t){function n(n,r){var i=t.call(this,n,r)||this;return i.dsService=r,i.OrderByTimeRef=e.OrderByTime,i.selectedCommands=[],i.availableCommands=[new ue(le.Fill,"fill(null)","null"),new ue(le.Time,"time($interval)","$__interval"),new ue(le.Limit,"LIMIT",10),new ue(le.SLimit,"SLIMIT",10),new ue(le.OrderBy,"ORDER BY time DESC")],i}return I(n,t),Object.defineProperty(n.prototype,"limit",{get:function(){return this.query.limit},set:function(e){this.query.limit=e,e||this.needRebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"slimit",{get:function(){return this.query.slimit},set:function(e){this.query.slimit=e,e||this.needRebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return this.groupBy.find((function(t){return t.type==e.GroupByOption.Time}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"timeValue",{get:function(){return this.time.params[0]},set:function(t){if(t==this.REMOVE){var n=this.groupBy.findIndex((function(t){return t.type==e.GroupByOption.Time}));-1!==n&&this.groupBy.splice(n,1)}else this.time.params=[t];this.needRebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"groupByTags",{get:function(){return this.query.groupBy.filter((function(t){return t.type==e.GroupByOption.Tag}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fill",{get:function(){return this.groupBy.find((function(t){return t.type==e.GroupByOption.Fill}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fillValue",{get:function(){return this.fill.params[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"showFill",{get:function(){return null!=this.fill},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"timeOptions$",{get:function(){return l.of(q([this.REMOVE],Object.values(e.GroupByTimeOptions)))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fillOptions",{get:function(){return l.of(q([this.REMOVE],Object.values(e.GroupByFillOptions)))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"groupByOptions$",{get:function(){var t=this,n=[];this.selectedCommands.find((function(e){return e.type==le.Fill}))||n.push(this.availableCommands[0].text),this.time||n.push(this.availableCommands[1].text),this.query.limit||n.push(this.availableCommands[2].text),this.query.slimit||n.push(this.availableCommands[3].text),this.query.order!=e.OrderByTime.Desc&&n.push(this.availableCommands[4].text);var r=this.query.measurement?"SHOW TAG KEYS from "+this.query.measurement:"SHOW TAG KEYS";return this.proxy(r).pipe(u.map((function(e){var r=e[0].values.reduce((function(e,t){return e.concat(t)}),[]);t.availableCommands=t.availableCommands.filter((function(e){return e.type!=le.Tag})),r.forEach((function(e){return t.availableCommands.push(new ue(le.Tag,"tag("+e+")",e))}));var i=t.availableCommands.filter((function(e){return e.type==le.Tag})).filter((function(e){return!t.query.groupBy.find((function(t){return t.type==le.Tag&&t.params[0]==e.value}))})).map((function(e){return e.text}));return q(n,i)})))},enumerable:!1,configurable:!0}),n.prototype.onOptionPick=function(t){var n=this.availableCommands.find((function(e){return e.text==t}));if(n){switch(this.selectedCommands.push(n),n.type){case le.Time:this.groupBy.push(new S(e.GroupByOption.Time,[n.value]));break;case le.Fill:this.groupBy.push(new S(e.GroupByOption.Fill,[n.value]));break;case le.Limit:this.query.limit=n.value;break;case le.SLimit:this.query.slimit=n.value;break;case le.OrderBy:this.query.order=e.OrderByTime.Desc;break;case le.Tag:this.groupBy.push(new S(e.GroupByOption.Tag,[n.value]))}this.needRebuild()}},n.prototype.onRemoveTag=function(t){this.query.groupBy=this.groupBy.filter((function(n){return!(n.type==e.GroupByOption.Tag&&n.params[0]==t)})),this.needRebuild()},n}(V);ae.ɵfac=function(e){return new(e||ae)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.DataSourceService))},ae.ɵcmp=t.ɵɵdefineComponent({type:ae,selectors:[["group-by-editor"]],features:[t.ɵɵInheritDefinitionFeature],decls:20,vars:7,consts:[[1,"gf-form-inline"],[1,"gf-form"],[1,"gf-form-label","query-keyword","width-7"],["formatString","time({0})",3,"ngModel","request","ngModelChange",4,"ngIf"],["tag-label","","class","gf-form pointer",3,"value","removed",4,"ngFor","ngForOf"],["placeholder","fa fa-plus","readonly","true",3,"request","pick"],[1,"gf-form","gf-form--grow"],[1,"gf-form-label","gf-form-label--grow"],["class","gf-form-inline",4,"ngIf"],[1,"gf-form","max-width-30"],["type","text","spellcheck","false","placeholder","Naming pattern",1,"gf-form-input",3,"ngModel","ngModelChange"],["formatString","time({0})",3,"ngModel","request","ngModelChange"],["tag-label","",1,"gf-form","pointer",3,"value","removed"],[1,"gf-form-label","pointer",3,"click"],[1,"query-keyword"],[1,"fa","fa-remove","ml-1"],["type","text","spellcheck","false","placeholder","No Limit",1,"gf-form-input","width-9",3,"ngModel","ngModelChange","change"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵelementStart(2,"label",2),t.ɵɵelementStart(3,"span"),t.ɵɵtext(4,"GROUP BY"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(5,te,1,2,"ed-autocomplete-picker",3),t.ɵɵtemplate(6,ne,1,1,"div",4),t.ɵɵelementStart(7,"ed-autocomplete-picker",5),t.ɵɵlistener("pick",(function(e){return n.onOptionPick(e)})),t.ɵɵelementEnd(),t.ɵɵelementStart(8,"div",6),t.ɵɵelement(9,"div",7),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(10,re,11,0,"div",8),t.ɵɵtemplate(11,ie,7,1,"div",8),t.ɵɵtemplate(12,oe,7,1,"div",8),t.ɵɵelementStart(13,"div",0),t.ɵɵelementStart(14,"div",9),t.ɵɵelementStart(15,"label",2),t.ɵɵtext(16,"ALIAS BY"),t.ɵɵelementEnd(),t.ɵɵelementStart(17,"input",10),t.ɵɵlistener("ngModelChange",(function(e){return n.query.alias=e})),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(18,"div",6),t.ɵɵelement(19,"div",7),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(5),t.ɵɵproperty("ngIf",n.time),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",n.groupByTags),t.ɵɵadvance(1),t.ɵɵproperty("request",n.groupByOptions$),t.ɵɵadvance(3),t.ɵɵproperty("ngIf",n.query.order==n.OrderByTimeRef.Desc),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.query.limit),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.query.slimit),t.ɵɵadvance(5),t.ɵɵproperty("ngModel",n.query.alias))},directives:[i.NgIf,i.NgForOf,r.AutoCompletePickerComponent,n.DefaultValueAccessor,n.NgControlStatus,n.NgModel,ee],encapsulation:2});var le,ue=function(e,t,n){void 0===n&&(n=void 0),this.type=e,this.text=t,this.value=n};function se(e,n){1&e&&t.ɵɵelement(0,"i",20)}function ce(e,n){1&e&&t.ɵɵelement(0,"i",21)}function me(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",22),t.ɵɵelementStart(1,"div",23),t.ɵɵelementStart(2,"label",24),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext();return e.opened=!e.opened})),t.ɵɵtext(3),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(3),t.ɵɵtextInterpolate1(" ",i.queryAsString," ")}}function de(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",25),t.ɵɵelementStart(1,"measurement-editor",26),t.ɵɵlistener("rebuild",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().build()})),t.ɵɵelementEnd(),t.ɵɵelementStart(2,"fields-editor",26),t.ɵɵlistener("rebuild",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().build()})),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"group-by-editor",26),t.ɵɵlistener("rebuild",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().build()})),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("query",i.query),t.ɵɵadvance(1),t.ɵɵproperty("query",i.query),t.ɵɵadvance(1),t.ɵɵproperty("query",i.query)}}!function(e){e[e.Fill=0]="Fill",e[e.Time=1]="Time",e[e.Tag=2]="Tag",e[e.Limit=3]="Limit",e[e.SLimit=4]="SLimit",e[e.OrderBy=5]="OrderBy"}(le||(le={}));var pe=function(e){function n(n,r,i){var o=e.call(this,n,r)||this;return o.dsService=r,o.time=i,o.contextMenuItems=[],o.opened=!0,o.editMode=!1,o.remove=new t.EventEmitter,o.moveUp=new t.EventEmitter,o.moveDown=new t.EventEmitter,o.duplicate=new t.EventEmitter,o}return I(n,e),n.prototype.ngOnInit=function(){var e=this;this.contextMenuItems=[{label:"Toggle edit mode",command:function(t){return e.editMode!=e.editMode}},{label:"Duplicate",command:function(t){return e.duplicate.emit()}},{label:"Move up",command:function(t){return e.moveUp.emit()}},{label:"Move down",command:function(t){return e.moveDown.emit()}}],this.build(!1)},n.prototype.onRebuild=function(){this.rebuild.emit()},n}(V);function fe(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"query-editor",1),t.ɵɵlistener("remove",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().onRemove(e)}))("duplicate",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().onDuplicate(e)}))("moveUp",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().onMoveUp(e)}))("moveDown",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().onMoveDown(e)}))("rebuild",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().rebuild()})),t.ɵɵelementEnd()}if(2&e){var i=n.$implicit;t.ɵɵproperty("query",i)}}pe.ɵfac=function(e){return new(e||pe)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.DataSourceService),t.ɵɵdirectiveInject(o.TimeRangeStore))},pe.ɵcmp=t.ɵɵdefineComponent({type:pe,selectors:[["query-editor"]],outputs:{remove:"remove",moveUp:"moveUp",moveDown:"moveDown",duplicate:"duplicate"},features:[t.ɵɵInheritDefinitionFeature],decls:23,vars:6,consts:[[1,"gf-form-query"],[1,"gf-form","gf-form-query-letter-cell",3,"click"],[1,"gf-form-label"],["tabindex","1",1,"pointer"],["ng-class","{muted: !ctrl.canCollapse}",1,"gf-form-query-letter-cell-carret"],["class","fa fa-caret-down",4,"ngIf"],["class","fa fa-caret-right",4,"ngIf"],[1,"gf-form-query-letter-cell-letter"],["class","gf-form-query-content gf-form-query-content--collapsed mr-1",4,"ngIf"],["class","gf-form-query-content",4,"ngIf"],[1,"gf-form","ed"],[1,"gf-form-label",3,"click"],["data-toggle","dropdown","tabindex","1",1,"pointer","dropdown-toggle"],[1,"fa","fa-bars"],["ng-click","ctrl.toggleHideQuery()","role","menuitem"],[1,"fa","fa-eye"],["tabindex","1",1,"pointer",3,"click"],[1,"fa","fa-trash"],[3,"items"],["cm",""],[1,"fa","fa-caret-down"],[1,"fa","fa-caret-right"],[1,"gf-form-query-content","gf-form-query-content--collapsed","mr-1"],[1,"gf-form"],[1,"gf-form-label","pointer","gf-form-label--grow",3,"click"],[1,"gf-form-query-content"],[3,"query","rebuild"]],template:function(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1),t.ɵɵlistener("click",(function(){return n.opened=!n.opened})),t.ɵɵelementStart(2,"label",2),t.ɵɵelementStart(3,"a",3),t.ɵɵelementStart(4,"span",4),t.ɵɵtemplate(5,se,1,0,"i",5),t.ɵɵtemplate(6,ce,1,0,"i",6),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"span",7),t.ɵɵtext(8),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(9,me,4,1,"div",8),t.ɵɵtemplate(10,de,4,3,"div",9),t.ɵɵelementStart(11,"div",10),t.ɵɵelementStart(12,"label",11),t.ɵɵlistener("click",(function(e){return t.ɵɵrestoreView(r),t.ɵɵreference(22).show(e)})),t.ɵɵelementStart(13,"a",12),t.ɵɵelement(14,"i",13),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(15,"label",2),t.ɵɵelementStart(16,"a",14),t.ɵɵelement(17,"i",15),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(18,"label",2),t.ɵɵelementStart(19,"a",16),t.ɵɵlistener("click",(function(){return n.remove.emit()})),t.ɵɵelement(20,"i",17),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelement(21,"ed-context-menu",18,19)}2&e&&(t.ɵɵadvance(5),t.ɵɵproperty("ngIf",n.opened),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!n.opened),t.ɵɵadvance(2),t.ɵɵtextInterpolate(n.query.refId),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!n.opened),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.opened),t.ɵɵadvance(11),t.ɵɵproperty("items",n.contextMenuItems))},directives:[i.NgIf,r.ContextMenuComponent,D,Z,ae],encapsulation:2});var ge=function(){function e(e,t){this.panel=e,this.time=t}return Object.defineProperty(e.prototype,"metrics",{get:function(){return this.panel.widget.metrics},enumerable:!1,configurable:!0}),e.prototype.onRemove=function(e){var t=this.metrics.targets.indexOf(e);-1!==t&&(this.metrics.targets.splice(t,1),this.rebuild())},e.prototype.onMoveUp=function(e){},e.prototype.onMoveDown=function(e){console.log("onMoveDown")},e.prototype.onDuplicate=function(e){this.metrics.targets.push(a.cloneDeep(e))},e.prototype.rebuild=function(){this.time.tick()},e}();ge.ɵfac=function(e){return new(e||ge)(t.ɵɵdirectiveInject(o.PANEL_TOKEN),t.ɵɵdirectiveInject(o.TimeRangeStore))},ge.ɵcmp=t.ɵɵdefineComponent({type:ge,selectors:[["metrics-designer"]],decls:1,vars:1,consts:[[3,"query","remove","duplicate","moveUp","moveDown","rebuild",4,"ngFor","ngForOf"],[3,"query","remove","duplicate","moveUp","moveDown","rebuild"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,fe,1,1,"query-editor",0),2&e&&t.ɵɵproperty("ngForOf",n.metrics.targets)},directives:[i.NgForOf,pe],encapsulation:2});var ve=function(){};ve.ɵmod=t.ɵɵdefineNgModule({type:ve}),ve.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||ve)},imports:[[i.CommonModule,n.FormsModule,n.ReactiveFormsModule,o.EdCommonModule,r.EdUilibModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(ve,{declarations:[m,M,ge,pe,D,Z,z,K,j,ae,ee],imports:[i.CommonModule,n.FormsModule,n.ReactiveFormsModule,o.EdCommonModule,r.EdUilibModule],exports:[m,M,ge]}),e.AggrFuncHelper=E,e.Field=g,e.FuncObject=v,e.GroupByObject=S,e.InfluxMetricsBuilder=M,e.InfluxMetricsDesignerComponent=ge,e.InfluxModule=ve,e.InfluxQuery=f,e.InfluxSettingsEditorComponent=m,e.MetricVars=w,e.Tag=O,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=influx.umd.min.js.map