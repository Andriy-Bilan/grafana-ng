!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("uilib"),require("@angular/common"),require("common"),require("lodash"),require("rxjs")):"function"==typeof define&&define.amd?define("influx",["exports","@angular/core","@angular/forms","uilib","@angular/common","common","lodash","rxjs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).influx={},e.ng.core,e.ng.forms,e.i2,e.ng.common,e.i1$1,e._,e.rxjs)}(this,(function(e,t,r,n,i,o,a,l){"use strict";function s(e,r){1&e&&t.ɵɵtext(0," please enter url ")}function u(e,r){1&e&&t.ɵɵtemplate(0,s,1,0,"ng-template",16)}var m=function(){function e(){this.form=new r.FormGroup({url:new r.FormControl(null,r.Validators.required),whitelistedCookies:new r.FormControl(null),basicAuthentication:new r.FormControl(!1),withCredentials:new r.FormControl(!1),tlsClientAuth:new r.FormControl(!1),withCaCert:new r.FormControl(!1),skipTlsVerification:new r.FormControl(!1),database:new r.FormControl(null,r.Validators.required),user:new r.FormControl(null),password:new r.FormControl(null),minTimeInterval:new r.FormControl(null)})}return Object.defineProperty(e.prototype,"url",{get:function(){return this.form.get("url")},enumerable:!1,configurable:!0}),e}();m.ɵfac=function(e){return new(e||m)},m.ɵcmp=t.ɵɵdefineComponent({type:m,selectors:[["ds-settings-editor"]],decls:41,vars:15,consts:[[3,"formGroup"],[1,"page-heading"],[1,"gf-form-group"],["label","URL","labelWidth","10","tooltip","Specify a complete HTTP URL (for example http://your_server:8080)","formControlName","url"],[4,"ngIf"],["label","Whitelisted Cookies","labelWidth","10","formControlName","whitelistedCookies"],[1,"gf-form-inline"],["labelWidth","10","label","Basic Auth","formControlName","basicAuthentication"],["labelWidth","10","label","With Credentials","tooltip","Whether credentials such as cookies or auth headers should be sent with cross-site requests.","formControlName","withCredentials"],["labelWidth","10","label","TLS Client Auth","formControlName","tlsClientAuth"],["labelWidth","10","label","With CA Cert","tooltip","Needed for verifing self-signed TLS Certs","formControlName","withCaCert"],["labelWidth","10","label","Skip TLS Verify","formControlName","skipTlsVerification"],["formControlName","database",3,"label","labelWidth"],["formControlName","user",3,"label","labelWidth","width"],["type","password","formControlName","password",3,"label","labelWidth","width"],["type","password","formControlName","minTimeInterval",3,"label","labelWidth","width","placeholder","tooltip"],["edValidationTemplate",""]],template:function(e,r){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"h3",1),t.ɵɵtext(2,"HTTP"),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"div",2),t.ɵɵelementStart(4,"ed-textbox",3),t.ɵɵtemplate(5,u,1,0,void 0,4),t.ɵɵelementEnd(),t.ɵɵelement(6,"ed-textbox",5),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"h3",1),t.ɵɵtext(8,"Auth"),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"div",2),t.ɵɵelementStart(10,"div",6),t.ɵɵelement(11,"ed-checkbox",7),t.ɵɵelement(12,"ed-checkbox",8),t.ɵɵelementEnd(),t.ɵɵelementStart(13,"div",6),t.ɵɵelement(14,"ed-checkbox",9),t.ɵɵelement(15,"ed-checkbox",10),t.ɵɵelementEnd(),t.ɵɵelementStart(16,"div",6),t.ɵɵelement(17,"ed-checkbox",11),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(18,"h3",1),t.ɵɵtext(19,"InfluxDB Details"),t.ɵɵelementEnd(),t.ɵɵelementStart(20,"div",2),t.ɵɵelement(21,"ed-textbox",12),t.ɵɵelementStart(22,"div",6),t.ɵɵelement(23,"ed-textbox",13),t.ɵɵelement(24,"ed-textbox",14),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(25,"div",2),t.ɵɵelementStart(26,"ed-info-box"),t.ɵɵelementStart(27,"h5"),t.ɵɵtext(28,"Database Access"),t.ɵɵelementEnd(),t.ɵɵelementStart(29,"p"),t.ɵɵtext(30," Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example: "),t.ɵɵelementStart(31,"code"),t.ɵɵtext(32,"SHOW MEASUREMENTS ON _internal"),t.ɵɵelementEnd(),t.ɵɵtext(33," or "),t.ɵɵelementStart(34,"code"),t.ɵɵtext(35,'SELECT * FROM "_internal".."database" LIMIT 10'),t.ɵɵelementEnd(),t.ɵɵelement(36,"br"),t.ɵɵelement(37,"br"),t.ɵɵtext(38," To support data isolation and security, make sure appropriate permissions are configured in InfluxDB. "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(39,"div",2),t.ɵɵelement(40,"ed-textbox",15),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("formGroup",r.form),t.ɵɵadvance(5),t.ɵɵproperty("ngIf",r.url.hasError("required")&&r.url.touched),t.ɵɵadvance(16),t.ɵɵproperty("label","Database")("labelWidth",10),t.ɵɵadvance(2),t.ɵɵproperty("label","User")("labelWidth",10)("width",5),t.ɵɵadvance(1),t.ɵɵproperty("label","Password")("labelWidth",10)("width",5),t.ɵɵadvance(16),t.ɵɵproperty("label","Min time interval")("labelWidth",11)("width",5)("placeholder","10s")("tooltip","A lower limit for the auto group by time interval. Recommended to be set to write frequency,\n\t\t\t\tfor example 1m if your data is written every minute."))},directives:[r.NgControlStatusGroup,r.FormGroupDirective,n.TextBoxComponent,r.NgControlStatus,r.FormControlName,i.NgIf,n.CheckBoxComponent,n.InfoBoxComponent,n.TextBoxValidationTemplate],encapsulation:2});var c,d,g=function(){this.measurement="",this.policy="",this.refId="",this.fields=new Array};(c=e.AggrFunc||(e.AggrFunc={})).Count="count",c.Distinct="distinct",c.Integral="integral",c.Mean="mean",c.Median="median",c.Mode="mode",c.Sum="sum",c.Bottom="bottom",c.First="first",c.Last="last",c.Max="max",c.Min="min",c.Percentile="percentile",c.Top="top",c.Derivative="derivative",c.Spread="spread",c.NonNegativeDerivative="non_negative_derivative",c.Difference="difference",c.NonNegativeDifference="non_negative_difference",c.MovingAverage="moving_average",c.CumulativeSum="cumulative_sum",c.Stddev="stddev",c.Elapsed="elapsed",c.HoltWinters="holt_winters",c.HoltWintersWithFit="holt_winters_with_fit",c.Math="math",c.Alias="alias",(d=e.AggrFuncGroup||(e.AggrFuncGroup={}))[d.Aggregations=0]="Aggregations",d[d.Selectors=1]="Selectors",d[d.Transformations=2]="Transformations",d[d.Predictors=3]="Predictors",d[d.Math=4]="Math",d[d.Alias=5]="Alias";var f,p,h,v,F=function(){function t(){}return t.getGroup=function(t){switch(t){case e.AggrFunc.Count:case e.AggrFunc.Distinct:case e.AggrFunc.Integral:case e.AggrFunc.Mean:case e.AggrFunc.Median:case e.AggrFunc.Mode:case e.AggrFunc.Sum:return e.AggrFuncGroup.Aggregations;case e.AggrFunc.Bottom:case e.AggrFunc.First:case e.AggrFunc.Last:case e.AggrFunc.Max:case e.AggrFunc.Min:case e.AggrFunc.Percentile:case e.AggrFunc.Top:return e.AggrFuncGroup.Selectors;case e.AggrFunc.Derivative:case e.AggrFunc.Spread:case e.AggrFunc.NonNegativeDerivative:case e.AggrFunc.Difference:case e.AggrFunc.NonNegativeDifference:case e.AggrFunc.MovingAverage:case e.AggrFunc.CumulativeSum:case e.AggrFunc.Stddev:case e.AggrFunc.Elapsed:return e.AggrFuncGroup.Transformations;case e.AggrFunc.HoltWinters:case e.AggrFunc.HoltWintersWithFit:return e.AggrFuncGroup.Predictors;case e.AggrFunc.Math:return e.AggrFuncGroup.Math;case e.AggrFunc.Alias:return e.AggrFuncGroup.Alias}},t}();(f=e.GroupByOption||(e.GroupByOption={}))[f.Time=0]="Time",f[f.Fill=1]="Fill",f[f.Tag=2]="Tag",(p=e.GroupByTimeOptions||(e.GroupByTimeOptions={})).Dynamic="$__interval",p.S1="1s",p.S10="10s",p.M1="1m",p.M5="5m",p.M10="10m",p.M15="15m",p.H1="1h",(h=e.GroupByFillOptions||(e.GroupByFillOptions={})).None="none",h.Null="null",h.Zero="0",h.Prev="previous",h.Linear="linear",(v=e.OrderByTime||(e.OrderByTime={}))[v.Asc=0]="Asc",v[v.Desc=1]="Desc";var y=function(){};y.TIME_FILTER="$timeFilter",y.TIME_INTERVAL="$__interval";var b=function(){function e(e){this.time=e}return e.prototype.compile=function(e,t){var r=this,n=[];e.targets.forEach((function(e){var i=new A(r.time,e,t);i.invalid||e.virgin||n.push(i.text)}));var i=n.join(";");return l.of(i)},e}();b.ɵfac=function(e){return new(e||b)(t.ɵɵdirectiveInject(o.TimeRangeStore))},b.ɵcmp=t.ɵɵdefineComponent({type:b,selectors:[["query-compiler"]],decls:0,vars:0,template:function(e,t){},encapsulation:2});var A=function(){function t(e,t,r){this.time=e,this.target=t,this.range=r}return Object.defineProperty(t.prototype,"invalid",{get:function(){return!this.target||!this.target.fields||0===this.target.fields.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return"SELECT "+this.getFieldsText()+" FROM "+this.getMeasurementText()},enumerable:!1,configurable:!0}),t.prototype.getFieldsText=function(){var e=this,t="";return this.target.fields?(this.target.fields.forEach((function(r){t.length>0&&(t+=", "),t+=e.getFieldText(r)})),t):t},t.prototype.getFieldText=function(t){var r="",n=t.key?t.key:"field",i=t.functions.find((function(t){return F.getGroup(t.name)==e.AggrFuncGroup.Aggregations||F.getGroup(t.name)==e.AggrFuncGroup.Selectors}));i?r+=i.name+(i.param&&i.param.value?'("'+n+'", '+i.param.value+")":'("'+n+'")'):r='"'+n+'"',t.functions.filter((function(t){return F.getGroup(t.name)===e.AggrFuncGroup.Transformations})).forEach((function(e){var t=e.param&&e.param.value?", "+e.param.value:"";r=e.name+"("+r+t+")"}));var o=t.functions.find((function(t){return F.getGroup(t.name)===e.AggrFuncGroup.Math}));o&&(r=r+" "+o.param.value);var a=t.functions.find((function(t){return F.getGroup(t.name)===e.AggrFuncGroup.Alias}));return a&&(r=r+' AS "'+a.param.value+'"'),r},t.prototype.getMeasurementText=function(){var t=this.target.measurement?this.target.measurement:"measurement",r=(this.target.policy&&this.target.policy.length>0&&"default"!==this.target.policy?'"'+this.target.policy+'".':"")+'"'+t+'"',n="",i=0;this.target.tags&&this.target.tags.filter((function(e){return e.key&&e.value})).forEach((function(e){i>0&&(n+=" "+e.condition+" "),n+=' "'+e.key+'" '+e.operator+" '"+e.value+"'",++i}));var o=this.range?this.getTimeFilter():y.TIME_FILTER;r=n.length>0?r+" WHERE ("+n+") and "+o:r+" WHERE "+o;var a=this.target.groupBy,l=a.find((function(t){return t.type==e.GroupByOption.Time})),s=a.find((function(t){return t.type==e.GroupByOption.Fill})),u=a.filter((function(t){return t.type==e.GroupByOption.Tag}));if(l){var m=this.range?this.getOptimalAutoGroupBy():l.params[0];r=r+" GROUP BY time("+m+")"}return u.length>0&&(r=l?r+",":r+" GROUP BY",u.forEach((function(e,t){r=r+(t>0?", ":" ")+' "'+e.params[0]+'"'}))),s&&(r=r+" FILL("+s.params[0]+")"),this.target.order!=e.OrderByTime.Asc&&(r+=" ORDER BY time DESC"),this.target.limit>0&&(r=r+" LIMIT "+this.target.limit),this.target.slimit>0&&(r=r+" SLIMIT "+this.target.slimit),r},t.prototype.getOptimalAutoGroupBy=function(){var e=o.TimeRangeParser.toDateTime(this.range.from,!1),t=o.TimeRangeParser.toDateTime(this.range.to,!0);return 5>+t.diff(e,"minutes")?"200ms":15>+t.diff(e,"minutes")?"1s":30>t.diff(e,"minutes")?"2s":1>t.diff(e,"hours")?"5s":3>t.diff(e,"hours")?"10s":6>t.diff(e,"hours")?"20s":12>t.diff(e,"hours")?"1m":24>t.diff(e,"hours")?"2m":7>t.diff(e,"days")?"10m":31>t.diff(e,"days")?"1h":365>t.diff(e,"days")?"12h":"24h"},t.prototype.getTimeFilter=function(){var e=this.range,t=this.time.converter.timezone,r=this.getInfluxTime(e.from,!1,t),n=this.getInfluxTime(e.to,!0,t),i="ms"===r[r.length-1];return"now()"!==n||i?"time >= "+r+" and time <= "+n:"time >= "+r},t.prototype.getInfluxTime=function(e,t,r){if(a.isString(e)){if("now"===e)return"now()";var n=/^now-(\d+)([dhms])$/.exec(e);if(n)return"now() - "+parseInt(n[1],10)+n[2];e=o.TimeRangeParser.toDateTime(e,t,r)}return e.valueOf()+"ms"},t}(),x=function(){};x.ɵmod=t.ɵɵdefineNgModule({type:x}),x.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||x)},imports:[[i.CommonModule,r.FormsModule,r.ReactiveFormsModule,o.EdCommonModule,n.EdUilibModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(x,{declarations:[m,b],imports:[i.CommonModule,r.FormsModule,r.ReactiveFormsModule,o.EdCommonModule,n.EdUilibModule],exports:[m,b]}),e.AggrFuncHelper=F,e.InfluxModule=x,e.InfluxQuery=g,e.InfluxQueryCompiler=b,e.InfluxSettingsEditorComponent=m,e.MetricVars=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=influx.umd.min.js.map